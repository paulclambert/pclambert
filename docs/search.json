[
  {
    "objectID": "software/stpm3/scale_option.html",
    "href": "software/stpm3/scale_option.html",
    "title": "Change to the scale() option",
    "section": "",
    "text": "The scale() option has changed\nIn stpm2 the choice of options when using the scale() option included hazard and odds. These really meant log cumulative hazard and log odds respectively.\nIn stpm3 you need to refer to these models as scale(lncumhazard) or scale(lnodds). This is because stpm3 allows models to be fitted on the log hazard scale (scale(lnhazard)) and thus there is a need to distinguish between models on the log cumulative hazard and log hazard scales.\nWe first load the example Rotterdam breast cancer data (rott3.dta) and then use stset to declare the survival time and event indicator.\n. use https://www.pclambert.net/data/rott2b, clear\n(Rotterdam breast cancer data (augmented with cause of death))\n\n. stset os, f(osi==1) scale(12) exit(time 120)\n\nSurvival-time data settings\n\n         Failure event: osi==1\nObserved time interval: (0, os]\n     Exit on or before: time 120\n     Time for analysis: time/12\n\n--------------------------------------------------------------------------\n      2,982  total observations\n          0  exclusions\n--------------------------------------------------------------------------\n      2,982  observations remaining, representing\n      1,171  failures in single-record/single-failure data\n 20,002.424  total analysis time at risk and under observation\n                                                At risk from t =         0\n                                     Earliest observed entry t =         0\n                                          Last observed exit t =        10\nThe scale(12) option converts the times recorded in months to years.\nTo fit an stpm2 model we would use,\n. stpm2 hormon, scale(hazard) df(5) \n\nIteration 0:  Log likelihood = -2929.2995  \nIteration 1:  Log likelihood = -2928.2998  \nIteration 2:  Log likelihood = -2928.2966  \nIteration 3:  Log likelihood = -2928.2966  \n\nLog likelihood = -2928.2966                              Number of obs = 2,982\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |   .4321954   .0861189     5.02   0.000     .2634054    .6009854\n       _rcs1 |    .914158   .0273548    33.42   0.000     .8605436    .9677725\n       _rcs2 |   .1672938   .0273886     6.11   0.000     .1136131    .2209746\n       _rcs3 |   .0360402   .0154393     2.33   0.020     .0057797    .0663006\n       _rcs4 |  -.0113638    .007644    -1.49   0.137    -.0263459    .0036182\n       _rcs5 |   .0058281   .0049328     1.18   0.237    -.0038401    .0154963\n       _cons |  -1.225443   .0332548   -36.85   0.000    -1.290622   -1.160265\n------------------------------------------------------------------------------\nThe equivalent model in stpm3 is,\n. stpm3 hormon, scale(lncumhazard) df(5) \n\nIteration 0:  Log likelihood = -2929.2995  \nIteration 1:  Log likelihood = -2928.2998  \nIteration 2:  Log likelihood = -2928.2966  \nIteration 3:  Log likelihood = -2928.2966  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(1)  =  25.19\nLog likelihood = -2928.2966                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |   .4321954   .0861189     5.02   0.000     .2634054    .6009854\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |   -23.9834    1.92113   -12.48   0.000    -27.74874   -20.21805\n        _ns2 |   6.695765   1.027919     6.51   0.000     4.681082    8.710449\n        _ns3 |  -1.214676   .0497438   -24.42   0.000    -1.312172    -1.11718\n        _ns4 |  -.8095755   .0387379   -20.90   0.000    -.8855004   -.7336505\n        _ns5 |  -.4994385   .0418591   -11.93   0.000    -.5814808   -.4173963\n       _cons |  -.5713643   .0332128   -17.20   0.000    -.6364603   -.5062684\n------------------------------------------------------------------------------\nNote the log-likelihoods are identical as are the coefficients/standard errors for hormon. Note that different basis functions are used, so the coefficients for the spline terms are different. However, predicted values for the same covariate pattern will not differ.\nTo fit a model on the log hazard scale use scale(lnhazard),\n. stpm3 hormon, scale(lnhazard) df(5) \n\nIteration 0:  Log likelihood = -15102.783  \nIteration 1:  Log likelihood = -3027.1718  \nIteration 2:  Log likelihood = -2947.4369  \nIteration 3:  Log likelihood = -2932.3794  \nIteration 4:  Log likelihood =  -2930.192  \nIteration 5:  Log likelihood = -2930.1318  \nIteration 6:  Log likelihood = -2930.1318  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(1)  =  25.25\nLog likelihood = -2930.1318                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |    .432754   .0861241     5.02   0.000     .2639539    .6015541\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |  -8.918703   1.582022    -5.64   0.000    -12.01941   -5.817997\n        _ns2 |     4.3015   .9609478     4.48   0.000     2.418077    6.184923\n        _ns3 |   .3920384    .185592     2.11   0.035     .0282847     .755792\n        _ns4 |   .1022445   .1620363     0.63   0.528    -.2153409    .4198298\n        _ns5 |   .0909831   .3382751     0.27   0.788     -.572024    .7539901\n       _cons |  -2.913227   .1465419   -19.88   0.000    -3.200443    -2.62601\n------------------------------------------------------------------------------\nQuadrature method: tanh-sinh with 30 nodes.\nAnalytical integration before first and after last knot."
  },
  {
    "objectID": "software/stpm3/factor_variables.html",
    "href": "software/stpm3/factor_variables.html",
    "title": "Factor Variables",
    "section": "",
    "text": "stpm3 fully supports factor variables\nIn stpm3 there is now full support for factor variables including for time-dependent effects. This makes predictions much easier. In addition, standsurv has been updated to be compatible with stpm3 making marginal predictions also much easier.\nWe first load the Rotterdam breast cancer data and then use stset to declare the survival time and event indicator.\n. use https://www.pclambert.net/data/rott3, clear\n(Rotterdam breast cancer data (augmented with cause of death))\n\n. stset os, f(osi==1) scale(12) exit(time 120)\n\nSurvival-time data settings\n\n         Failure event: osi==1\nObserved time interval: (0, os]\n     Exit on or before: time 120\n     Time for analysis: time/12\n\n--------------------------------------------------------------------------\n      2,982  total observations\n          0  exclusions\n--------------------------------------------------------------------------\n      2,982  observations remaining, representing\n      1,171  failures in single-record/single-failure data\n 20,002.424  total analysis time at risk and under observation\n                                                At risk from t =         0\n                                     Earliest observed entry t =         0\n                                          Last observed exit t =        10\nThe scale(12) option converts the times recorded in months to years.\nTo fit an stpm3 model with a binary covariate we could use,\n. stpm3 hormon, scale(lncumhazard) df(5) \n\nIteration 0:  Log likelihood = -2929.2995  \nIteration 1:  Log likelihood = -2928.2998  \nIteration 2:  Log likelihood = -2928.2966  \nIteration 3:  Log likelihood = -2928.2966  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(1)  =  25.19\nLog likelihood = -2928.2966                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |   .4321954   .0861189     5.02   0.000     .2634054    .6009854\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |   -23.9834    1.92113   -12.48   0.000    -27.74874   -20.21805\n        _ns2 |   6.695765   1.027919     6.51   0.000     4.681082    8.710449\n        _ns3 |  -1.214676   .0497438   -24.42   0.000    -1.312172    -1.11718\n        _ns4 |  -.8095755   .0387379   -20.90   0.000    -.8855004   -.7336505\n        _ns5 |  -.4994385   .0418591   -11.93   0.000    -.5814808   -.4173963\n       _cons |  -.5713643   .0332128   -17.20   0.000    -.6364603   -.5062684\n------------------------------------------------------------------------------\nThe equivalent model using factor variables is,\n. stpm3 i.hormon, scale(lncumhazard) df(5) \n\nIteration 0:  Log likelihood = -2929.2995  \nIteration 1:  Log likelihood = -2928.2998  \nIteration 2:  Log likelihood = -2928.2966  \nIteration 3:  Log likelihood = -2928.2966  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(1)  =  25.19\nLog likelihood = -2928.2966                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |\n        yes  |   .4321954   .0861189     5.02   0.000     .2634054    .6009854\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |   -23.9834    1.92113   -12.48   0.000    -27.74874   -20.21805\n        _ns2 |   6.695765   1.027919     6.51   0.000     4.681082    8.710449\n        _ns3 |  -1.214676   .0497438   -24.42   0.000    -1.312172    -1.11718\n        _ns4 |  -.8095755   .0387379   -20.90   0.000    -.8855004   -.7336505\n        _ns5 |  -.4994385   .0418591   -11.93   0.000    -.5814808   -.4173963\n       _cons |  -.5713643   .0332128   -17.20   0.000    -.6364603   -.5062684\n------------------------------------------------------------------------------\nYou can also include factor variables as a time-dependent effect.\n. stpm3 i.hormon, scale(lncumhazard) df(5) ///\n&gt;                 tvc(i.hormon) dftvc(3)\n\nIteration 0:  Log likelihood = -2928.8322  \nIteration 1:  Log likelihood = -2926.8607  \nIteration 2:  Log likelihood = -2926.8409  \nIteration 3:  Log likelihood = -2926.8409  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(1)  =  20.88\nLog likelihood = -2926.8409                             Prob &gt; chi2   = 0.0000\n\n-----------------------------------------------------------------------------------\n                  | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n------------------+----------------------------------------------------------------\nxb                |\n           hormon |\n             yes  |   .4766542   .1043107     4.57   0.000     .2722089    .6810995\n------------------+----------------------------------------------------------------\ntime              |\n             _ns1 |  -25.11479   2.156221   -11.65   0.000     -29.3409   -20.88867\n             _ns2 |   7.297905    1.13577     6.43   0.000     5.071836    9.523974\n             _ns3 |  -1.195295   .0516705   -23.13   0.000    -1.296567   -1.094023\n             _ns4 |  -.7997134   .0402802   -19.85   0.000    -.8786612   -.7207657\n             _ns5 |  -.4954146   .0427173   -11.60   0.000    -.5791388   -.4116903\n                  |\nhormon#c._ns_tvc1 |\n             yes  |   4.943174   3.778547     1.31   0.191    -2.462642    12.34899\n                  |\nhormon#c._ns_tvc2 |\n             yes  |  -2.952286   1.995084    -1.48   0.139    -6.862579    .9580062\n                  |\nhormon#c._ns_tvc3 |\n             yes  |  -.0773513   .1778044    -0.44   0.664    -.4258415    .2711389\n                  |\n            _cons |  -.5740705   .0333738   -17.20   0.000    -.6394819   -.5086591\n-----------------------------------------------------------------------------------\nYou can incorporate interactions into both the main effect and interactions with time using tvc().\n. stpm3 i.hormon##i.grade, scale(lncumhazard) df(5) ///\n&gt;                 tvc(i.hormon##i.grade) dftvc(3) baselevels\n\nIteration 0:  Log likelihood = -2901.3265  \nIteration 1:  Log likelihood = -2895.1769  \nIteration 2:  Log likelihood = -2895.0066  \nIteration 3:  Log likelihood = -2895.0059  \nIteration 4:  Log likelihood = -2895.0059  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(3)  =  60.61\nLog likelihood = -2895.0059                             Prob &gt; chi2   = 0.0000\n\n-----------------------------------------------------------------------------------------\n                        | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n------------------------+----------------------------------------------------------------\nxb                      |\n                 hormon |\n                    no  |          0  (base)\n                   yes  |   .4135919   .2951852     1.40   0.161    -.1649605    .9921443\n                        |\n                  grade |\n                     2  |          0  (base)\n                     3  |    .483797   .0805037     6.01   0.000     .3260126    .6415814\n                        |\n           hormon#grade |\n                 yes#3  |   .0284316    .315761     0.09   0.928    -.5904485    .6473117\n------------------------+----------------------------------------------------------------\ntime                    |\n                   _ns1 |  -27.62422   5.730659    -4.82   0.000    -38.85611   -16.39234\n                   _ns2 |   7.583979   2.721378     2.79   0.005     2.250176    12.91778\n                   _ns3 |  -1.385614   .1121938   -12.35   0.000     -1.60551   -1.165718\n                   _ns4 |  -.8489422   .0796837   -10.65   0.000    -1.005119   -.6927651\n                   _ns5 |  -.4786468   .0735986    -6.50   0.000    -.6228974   -.3343963\n                        |\n      hormon#c._ns_tvc1 |\n                   yes  |  -2.771489   16.45089    -0.17   0.866    -35.01463    29.47165\n                        |\n      hormon#c._ns_tvc2 |\n                   yes  |   2.425308   8.628728     0.28   0.779    -14.48669     19.3373\n                        |\n      hormon#c._ns_tvc3 |\n                   yes  |  -.7069334    .573263    -1.23   0.218    -1.830508    .4166415\n                        |\n       grade#c._ns_tvc1 |\n                     3  |   2.757887   5.847325     0.47   0.637    -8.702659    14.21843\n                        |\n       grade#c._ns_tvc2 |\n                     3  |   -.285027   3.030253    -0.09   0.925    -6.224213    5.654159\n                        |\n       grade#c._ns_tvc3 |\n                     3  |  -.0467859   .1288623    -0.36   0.717    -.2993512    .2057795\n                        |\nhormon#grade#c._ns_tvc1 |\n                 yes#3  |   8.162556   16.89039     0.48   0.629      -24.942    41.26711\n                        |\nhormon#grade#c._ns_tvc2 |\n                 yes#3  |  -5.885373   8.860398    -0.66   0.507    -23.25143    11.48069\n                        |\nhormon#grade#c._ns_tvc3 |\n                 yes#3  |   .7162528   .6030515     1.19   0.235    -.4657065    1.898212\n                        |\n                  _cons |  -.9320134   .0710511   -13.12   0.000    -1.071271   -.7927559\n-----------------------------------------------------------------------------------------\nI strongly recommend using factor variables. When the model becomes complex, with interactions, time-dependent effects etc, then predictions usinff predict or standsurv become much simpler."
  },
  {
    "objectID": "software.html",
    "href": "software.html",
    "title": "Software",
    "section": "",
    "text": "I have developed a number of Stata commands. I have added some examples/tutorials. I occasionally add to these."
  },
  {
    "objectID": "software.html#my-main-stata-commands.",
    "href": "software.html#my-main-stata-commands.",
    "title": "Software",
    "section": "My main Stata commands.",
    "text": "My main Stata commands.\n\nstpm3 - flexible parametric survival models\nstandsurv - standardized survival curves and more after fitting various types of survival models.\nmrsprep - prepare data to directly fit marginal relative survival models.\nstpp - Non-parametric marginal relative (net) survival using Pohar Perme estimator\nmlad - Maximum likelIhood estimation with automatic differentiation using Python\nstcrprep - data-preparation command to fit a range of competing risks models.\ngensplines - obtain basis functions for various types of splines."
  },
  {
    "objectID": "software.html#older-and-less-used-now",
    "href": "software.html#older-and-less-used-now",
    "title": "Software",
    "section": "Older (and less used now)",
    "text": "Older (and less used now)\n\nstpm2 - flexible parametric survival models\nstpm2_standsurv - standardized survival curves after fitting an stpm2 model\nrcsgen - generate restricted cubic splines\nstrcs - flexible parametric models on log hazard scale\nstpm2cif - cause-specific cumulative incidence function after fitting a stpm2 competing risks model\npartpred - partial predictions\n\nI have worked with Paul Dickman, who has written some excellent Stata tutorials, many of which use my commands."
  },
  {
    "objectID": "publications.html",
    "href": "publications.html",
    "title": "Publications",
    "section": "",
    "text": "I have written a book with Patrick Royston titled Flexible parametric survival models using Stata: Beyond the Cox model.\n\nYou can download the datasets and code used in the book.\nA review of the book can be found here.\nWe are writing a second addition of the book with Mark Rutherford included as an additional author."
  },
  {
    "objectID": "publications.html#flexible-parametric-survival-models-using-stata-beyond-the-cox-model",
    "href": "publications.html#flexible-parametric-survival-models-using-stata-beyond-the-cox-model",
    "title": "Publications",
    "section": "",
    "text": "I have written a book with Patrick Royston titled Flexible parametric survival models using Stata: Beyond the Cox model.\n\nYou can download the datasets and code used in the book.\nA review of the book can be found here.\nWe are writing a second addition of the book with Mark Rutherford included as an additional author."
  },
  {
    "objectID": "publications.html#my-publications",
    "href": "publications.html#my-publications",
    "title": "Publications",
    "section": "My publications",
    "text": "My publications\nJohansson ALV, Kønig SM, Larønningen S, Engholm G, Kroman N, Seppä K, Malila N, Steig BÁ, Gudmundsdóttir EM, Ólafsdóttir EJ, Lundberg FE, Andersson TM-L, Lambert PC, Lambe M, Pettersson D, Aagnes B, Friis S, Storm H. Have the recent advancements in cancer therapy and survival benefitted patients of all age groups across the Nordic countries? NORDCAN survival analyses 2002-2021. Acta Oncologica 2024;63:179–91. https://doi.org/10.2340/1651-226X.2024.35094.\nLundberg FE, Birgisson H, Engholm G, Ólafsdóttir EJ, Mørch LS, Johannesen TB, Pettersson D, Lambe M, Seppä K, Lambert PC, Johansson ALV, Hölmich LR, Andersson TM-L. Survival trends for patients diagnosed with cutaneous malignant melanoma in the Nordic countries 1990-2016: The NORDCAN survival studies. European Journal of Cancer 2024;202:113980. https://doi.org/10.1016/j.ejca.2024.113980.\nHall M, Smith L, Wu J, Hayward C, Batty JA, Lambert PC, Hemingway H, Gale CP. Health outcomes after myocardial infarction: A population study of 56 million people in England. PLoS Medicine 2024;21:e1004343. https://doi.org/10.1371/journal.pmed.1004343.\nLee S, Lambert PC, Sweeting MJ, Latimer NR, Rutherford MJ. Evaluation of flexible parametric relative survival approaches for enforcing long-term constraints when extrapolating all-cause survival. Value in Health 2024;27:51–60. https://doi.org/10.1016/j.jval.2023.10.003.\nJennings AC, Rutherford MJ, Latimer NR, Sweeting MJ, Lambert PC. Perils of randomized controlled trial survival extrapolation assuming treatment effect waning: Why the distinction between marginal and conditional estimates matters. Value in Health 2023. https://doi.org/10.1016/j.jval.2023.12.008.\nLeontyeva Y, Lambe M, Bower H, Lambert PC, Andersson TM-L. Including uncertainty of the expected mortality rates in the prediction of loss in life expectancy. BMC Medical Research Methodology 2023;23:291. https://doi.org/10.1186/s12874-023-02118-w.\nWaterhouse JV, Welch CA, Battisti NML, Sweeting MJ, Paley L, Lambert PC, Deanfield J, Belder M de, Peake MD, Adlam D, Ring A. Geographical variation in underlying social deprivation, cardiovascular and other comorbidities in patients with potentially curable cancers in England: Results from a national registry dataset analysis. Clinical Oncology 2023;35:e709–19. https://doi.org/10.1016/j.clon.2023.08.009.\nBooth S, Mozumder SI, Archer L, Ensor J, Riley RD, Lambert PC, Rutherford MJ. Using temporal recalibration to improve the calibration of risk prediction models in competing risk settings when there are trends in survival over time. Statistics in Medicine 2023;30:5007–24. https://doi.org/10.1002/sim.9898.\nTyrer F, Chudasama YV, Lambert PC, Rutherford MJ. Flexible parametric methods for calculating life expectancy in small populations. Population Health Metrics 2023;21:13. https://doi.org/10.1186/s12963-023-00313-x.\nWells M, Rutherford MJ, Lambert PC. Fair comparisons of cause-specific and relative survival by accounting for the systematic removal of patients from risk-sets. Cancer Epidemiology 2023;86:102408. https://doi.org/10.1016/j.canep.2023.102408.\nSweeting MJ, Rutherford MJ, Jackson D, Lee S, Latimer NR, Hettle R, Lambert PC. Survival extrapolation incorporating general population mortality using excess hazard and cure models: A tutorial. Medical Decision Making 2023;43:737–48. https://doi.org/10.1177/0272989X231184247.\nMyklebust TÅa, Aagnes B, Nilssen Y, Rutherford M, Lambert PC, Andersson TML, Johansson ALV, Dickman PW, Møller B. Improving communication of cancer survival statistics-feasibility of implementing model-based algorithms in routine publications. British Journal of Cancer 2023;129:819–28. https://doi.org/10.1038/s41416-023-02360-5.\nTeece L, Sweeting MJ, Hall M, Coles B, Oliver-Williams C, Welch CA, Belder MA de, Deanfield J, Weston C, Rutherford MJ, Paley L, Kadam UT, Lambert PC, Peake MD, Gale CP, Adlam D, VICORI Collaborative. Impact of a prior cancer diagnosis on quality of care and survival following acute myocardial infarction: Retrospective population-based cohort study in England. Circulation Cardiovascular Quality and Outcomes 2023;16:e009236. https://doi.org/10.1161/CIRCOUTCOMES.122.009236.\nSkourlis N, Crowther MJ, Andersson TM-L, Lu D, Lambe M, Lambert PC. Exploring different research questions via complex multi-state models when using registry-based repeated prescriptions of antidepressants in women with breast cancer and a matched population comparison group. BMC Medical Research Methodology 2023;23:87. https://doi.org/10.1186/s12874-023-01905-9.\nColes B, Welch CA, Motiwale RS, Teece L, Oliver-Williams C, Weston C, Belder MA de, Lambert PC, Rutherford MJ, Paley L, Kadam UT, Lawson CA, Deanfield J, Peake MD, McDonagh T, Sweeting MJ, Adlam D, VICORI Collaborative. Acute heart failure presentation, management, and outcomes in cancer patients: A national longitudinal study. European Heart Journal Acute Cardiovascular Care 2023;12:315–27. https://doi.org/10.1093/ehjacc/zuad020.\nLundberg FE, Kroman N, Lambe M, Andersson TM-L, Engholm G, Johannesen TB, Virtanen A, Pettersson D, Ólafsdóttir EJ, Birgisson H, Lambert PC, Mørch LS, Johansson ALV. Age-specific survival trends and life-years lost in women with breast cancer 1990-2016: The NORDCAN survival studies. Acta Oncologica 2022;61:1481–9. https://doi.org/10.1080/0284186X.2022.2156811.\nBatyrbekova N, Bower H, Dickman PW, Ravn Landtblom A, Hultcrantz M, Szulkin R, Lambert PC, Andersson TM-L. Modelling multiple time-scales with flexible parametric survival models. BMC Medical Research Methodology 2022;22:290. https://doi.org/10.1186/s12874-022-01773-9.\nSyriopoulou E, Wästerlid T, Lambert PC, Andersson TM-L. Standardised survival probabilities: A useful and informative tool for reporting regression models for survival data. British Journal of Cancer 2022;127:1808–15. https://doi.org/10.1038/s41416-022-01949-6.\nLeontyeva Y, Bower H, Gauffin O, Lambert PC, Andersson TM-L. Assessing the impact of including variation in general population mortality on standard errors of relative survival and loss in life expectancy. BMC Medical Research Methodology 2022;22:130. https://doi.org/10.1186/s12874-022-01597-7.\nSyriopoulou E, Mozumder SI, Rutherford MJ, Lambert PC. Estimating causal effects in the presence of competing events using regression standardisation with the stata command standsurv. BMC Medical Research Methodology 2022;22:226. https://doi.org/10.1186/s12874-022-01666-x.\nSchmidt JCF, Lambert PC, Gillies CL, Sweeting MJ. Patterns of rates of mortality in the Clinical Practice Research Datalink. PloS One 2022;17:e0265709. https://doi.org/10.1371/journal.pone.0265709.\nLundberg FE, Birgisson H, Johannesen TB, Engholm G, Virtanen A, Pettersson D, Ólafsdóttir EJ, Lambe M, Lambert PC, Mørch LS, Johansson ALV, Andersson TM-L. Survival trends in patients diagnosed with colon and rectal cancer in the Nordic countries 1990-2016: The NORDCAN survival studies. European Journal of Cancer 2022;172:76–84. https://doi.org/10.1016/j.ejca.2022.05.032.\nBower H, Andersson TM-L, Crowther MJ, Lambert PC. Flexible parametric survival analysis with multiple timescales: Estimation and implementation using stmt. The Stata Journal 2022;22:679–701. https://doi.org/10.1177/1536867x221124552.\nSmith A, Lambert PC, Rutherford MJ. Generating high-fidelity synthetic time-to-event datasets to improve data transparency and accessibility. BMC Medical Research Methodology 2022;22:176. https://doi.org/10.1186/s12874-022-01654-1.\nStannard R, Lambert PC, Andersson TM-L, Rutherford MJ. Obtaining long-term stage-specific relative survival estimates in the presence of incomplete historical stage information. British Journal of Cancer 2022;127:1061–8. https://doi.org/10.1038/s41416-022-01866-8.\nSkourlis N, Crowther MJ, Andersson TM-L, Lambert PC. On the choice of timescale for other cause mortality in a competing risk setting using flexible parametric survival models. Biometrical Journal 2022;64:1161–77. https://doi.org/10.1002/bimj.202100254.\nAndersson TM-L, Rutherford MJ, Møller B, Lambert PC, Myklebust TÅ. Reference-adjusted loss in life expectancy for population-based cancer patient survival comparisons-with an application to colon cancer in Sweden. Cancer Epidemiology, Biomarkers & Prevention 2022;31:1720–6. https://doi.org/10.1158/1055-9965.EPI-22-0137.\nAndersson TM-L, Myklebust TÅ, Rutherford MJ, Møller B, Arnold M, Soerjomataram I, Bray F, Parkin DM, Lambert PC. Five ways to improve international comparisons of cancer survival: Lessons learned from ICBP SURVMARK-2. British Journal of Cancer 2022;126:1224–8. https://doi.org/10.1038/s41416-022-01701-0.\nRutherford MJ, Andersson TM-L, Myklebust TÅ, Møller B, Lambert PC. Non-parametric estimation of reference adjusted, standardised probabilities of all-cause death and death due to cancer for population group comparisons. BMC Medical Research Methodology 2022;22:2. https://doi.org/10.1186/s12874-021-01465-w.\nAndersson TM-L, Rutherford MJ, Myklebust TÅ, Møller B, Arnold M, Soerjomataram I, Bray F, Elkader HA, Engholm G, Huws D, Little A, Shack L, Walsh PM, Woods RR, Parkin DM, Lambert PC. A way to explore the existence of “immortals” in cancer registry data - an illustration using data from ICBP SURVMARK-2. Cancer Epidemiology 2022;76:102085. https://doi.org/10.1016/j.canep.2021.102085.\nLee SF, Vellayappan BA, Wong LC, Chiang CL, Chan SK, Wan EY-F, Wong IC-K, Lambert PC, Rachet B, Ng AK, Luque-Fernandez MA. Cardiovascular diseases among diffuse large b-cell lymphoma long-term survivors in asia: A multistate model study. ESMO Open 2022;7:100363. https://doi.org/10.1016/j.esmoop.2021.100363.\nRiley RD, Collins GS, Ensor J, Archer L, Booth S, Mozumder SI, Rutherford MJ, Smeden M van, Lambert PC, Snell KIE. Minimum sample size calculations for external validation of a clinical prediction model with a time-to-event outcome. Statistics in Medicine 2021;41:1280–95. https://doi.org/10.1002/sim.9275.\nSkourlis N, Crowther MJ, Andersson TM-L, Lambert PC. Development of a dynamic interactive web tool to enhance understanding of multi-state model analyses: MSMplus. BMC Medical Research Methodology 2021;21:262. https://doi.org/10.1186/s12874-021-01420-9.\nSyriopoulou E, Rutherford MJ, Lambert PC. Inverse probability weighting and doubly robust standardization in the relative survival framework. Statistics in Medicine 2021;40:6069–92. https://doi.org/10.1002/sim.9171.\nSweeting MJ, Oliver-Williams C, Teece L, Welch CA, Belder MA de, Coles B, Lambert PC, Paley L, Rutherford MJ, Elliss-Brookes L, Deanfield J, Peake MD, Adlam D. Data resource profile: The Virtual Cardio-Oncology Research Initiative (VICORI) linking national English cancer registration and cardiovascular audits. International Journal of Epidemiology 2022;50:1768–79. https://doi.org/10.1093/ije/dyab082.\nColes B, Teece L, Weston C, Belder MA de, Oliver-Williams C, Welch CA, Rutherford MJ, Lambert PC, Bidulka P, Paley L, Nitsch D, Deanfield J, Peake MD, Adlam D, Sweeting MJ, collaborative V. Case-ascertainment of acute myocardial infarction hospitalisations in cancer patients: A cohort study using English linked electronic health data. European Heart Journal Quality of Care & Clinical Outcomes 2021;8:86–95. https://doi.org/10.1093/ehjqcco/qcab045.\nLambert PC, Syriopoulou E, Rutherford MJ. Direct modelling of age standardized marginal relative survival through incorporation of time-dependent weights. BMC Medical Research Methodology 2021;21:84. https://doi.org/10.1186/s12874-021-01266-1.\nMozumder SI, Rutherford MJ, Lambert PC. Estimating restricted mean survival time and expected life-years lost in the presence of competing risks within flexible parametric survival models. BMC Medical Research Methodology 2021;21:52. https://doi.org/10.1186/s12874-021-01213-0.\nEnsor J, Snell KIE, Debray TPA, Lambert PC, Look MP, Mamas MA, Moons KGM, Riley RD. Individual participant data meta-analysis for external validation, recalibration, and updating of a flexible parametric prognostic model. Statistics in Medicine 2021;40:3066–84. https://doi.org/10.1002/sim.8959.\nHill M, Lambert PC, Crowther MJ. Relaxing the assumption of constant transition rates in a multi-state model in hospital epidemiology. BMC Medical Research Methodology 2021;21:16. https://doi.org/10.1186/s12874-020-01192-8.\nWeibull CE, Lambert PC, Eloranta S, Andersson TM-L, Dickman PW, Crowther MJ. A multistate model incorporating estimation of excess hazards and multiple time scales. Statistics in Medicine 2021;40:2139–54. https://doi.org/10.1002/sim.8894.\nAndersson TM-L, Rutherford MJ, Myklebust TÅ, Møller B, Soerjomataram I, Arnold M, Bray F, Parkin DM, Sasieni P, Bucher O, De P, Engholm G, Gavin A, Little A, Porter G, Ramanakumar AV, Saint-Jacques N, Walsh PM, Woods RR, Lambert PC. Exploring the impact of cancer registry completeness on international cancer survival differences: A simulation study. British Journal of Cancer 2021;124:1026–32. https://doi.org/10.1038/s41416-020-01196-7.\nRutherford MJ, Lambert PC, Sweeting MJ, Pennington B, Crowther MJ, Abrams KR, Latime NR. NICE DSU TECHNICAL SUPPORT DOCUMENT 21: Flexible methods for survival analysis. Decision Support Unit, University of Sheffield 2021.\nAndersson TM-L, Myklebust TÅ, Rutherford MJ, Møller B, Soerjomataram I, Arnold M, Bray F, Parkin DM, Sasieni P, Bucher O, De P, Engholm G, Gavin A, Little A, Porter G, Ramanakumar AV, Saint-Jacques N, Walsh PM, Woods RR, Lambert PC. The impact of excluding or including Death Certificate Initiated (DCI) cases on estimated cancer survival: A simulation study. Cancer Epidemiology 2021;71:101881. https://doi.org/10.1016/j.canep.2020.101881.\nSyriopoulou E, Rutherford MJ, Lambert PC. Understanding disparities in cancer prognosis: An extension of mediation analysis to the relative survival framework. Biometrical Journal 2021;63:341–53. https://doi.org/10.1002/bimj.201900355.\nSmith AJ, Lambert PC, Rutherford MJ. Understanding the impact of sex and stage differences on melanoma cancer patient survival: A SEER-based study. British Journal of Cancer 2021;1124:671–7. https://doi.org/10.1038/s41416-020-01144-5.\nLundberg FE, Andersson TM-L, Lambe M, Engholm G, Mørch LS, Johannesen TB, Virtanen A, Pettersson D, Olafsdottir EJ, Birgisson H, Johansson ALV, Lambert PC. Trends in cancer survival in the Nordic countries 1990-2016: The NORDCAN survival studies. Acta Oncologica 2020;59:1266–74. https://doi.org/10.1080/0284186X.2020.1822544.\nLambert PC, Andersson TM-L, Rutherford MJ, Myklebust TÅ, Møller B. Reference-adjusted and standardized all-cause and crude probabilities as an alternative to net survival in population-based cancer studies. International Journal of Epidemiology 2020;49:1614–23. https://doi.org/10.1093/ije/dyaa112.\nMyklebust TÅ, Andersson TM-L, Bardot A, Vernon S, Gavin A, Fitzpatrick D, Jerm MB, Rutherford MJ, Parkin DM, Sasieni P, Arnold M, Soerjomataram I, Bray F, Lambert PC, Møller B. Can different definitions of date of cancer incidence explain observed international variation in cancer survival? An ICBP SURVMARK-2 study. Cancer Epidemiology 2020;67:101759. https://doi.org/10.1016/j.canep.2020.101759.\nRutherford MJ, Dickman PW, Coviello E, Lambert PC. Estimation of age-standardized net survival, even when age-specific data are sparse. Cancer Epidemiology 2020;67:101745. https://doi.org/10.1016/j.canep.2020.101745.\nWelch CA, Sweeting MJ, Lambert PC, Rutherford MJ, Jack RH, West D, Adlam D, Peake M. Impact on survival of modelling increased surgical resection rates in patients with non-small-cell lung cancer and cardiovascular comorbidities: A VICORI study. British Journal of Cancer 2020;123:471–9. https://doi.org/10.1038/s41416-020-0869-8.\nBooth S, Riley RD, Ensor J, Lambert PC, Rutherford MJ. Temporal recalibration for improving prognostic model development and risk predictions in settings where survival is improving over time. International Journal of Epidemiology 2020;49:1316–25. https://doi.org/10.1093/ije/dyaa030.\nSyriopoulou E, Rutherford MJ, Lambert PC. Marginal measures and causal effects using the relative survival framework. International Journal of Epidemiology 2020;49:619–28. https://doi.org/10.1093/ije/dyz268.\nArnold M, Rutherford MJ, Bardot A, Ferlay J, Andersson TM, Myklebust TÅ, Tervonen H, Thursfield V, Ransom D, Shack L, Woods RR, Turner D, Leonfellner S, Ryan S, Saint-Jacques N, De P, McClure C, Ramanakumar AV, Stuart-Panko H, Engholm G, Walsh PM, Jackson C, Vernon S, Morgan E, Gavin A, Morrison DS, Huws DW, Porter G, Butler J, Bryant H, Currow DC, Hiom S, Parkin DM, Sasieni P, Lambert PC, Möller B, Soerjomataram I, Bray F. Progress in cancer survival, mortality, and incidence in seven high-income countries 1995-2014 (ICBP SURVMARK-2): A population-based study. Lancet Oncology 2019;20:1493–505.\nWong KF, Lambert PC, Mozumder SI, Broggio J, Rutherford MJ. Conditional crude probabilities of death for English cancer patients. British Journal of Cancer 2019;121:883–9. https://doi.org/10.1038/s41416-019-0597-0.\nAndersson TM-L, Rutherford MJ, Lambert PC. Illustration of different modelling assumptions for estimation of loss in expectation of life due to cancer. BMC Medical Research Methodology 2019;19:19. https://doi.org/https://doi.org/10.1186/s12874-019-0785-x.\nBower H, Crowther MJ, Rutherford MJ, Andersson TML, Clements M, Liu XR, Dickman PW, Lambert PC. Capturing simple and complex time-dependent effects using flexible parametric survival models: Communications in Statistics - Simulation and Computation 2019. https://doi.org/https://doi.org/10.1080/03610918.2019.1634201.\nSyriopoulou E, Morris E, P. F, Lambert PC, Rutherford MJ. Understanding the impact of socioeconomic differences in colorectal cancer survival: Potential gain in life-years. British Journal of Cancer 2019;120:1052–8. https://doi.org/10.1038/s41416-019-0455-0.\nRutherford MJ, Andersson TM-L, Björkholm M, Lambert PC. Loss in life expectancy and gain in life years as measures of cancer impact. Cancer Epidemiology 2019;60:168–73. https://doi.org/10.1016/j.canep.2019.04.005.\nBower H, Andersson TM-L, Syriopoulou E, Rutherford MJ, Lambe M, Ahlgren J, Dickman PW, Lambert PC. Potential gain in life years for Swedish women with breast cancer if stage and survival differences between education groups could be eliminated - three what-if scenarios. Breast 2019;45:75–81. https://doi.org/10.1016/j.breast.2019.03.005.\nWeibull CE, Björkholm M, Glimelius I, Lambert PC, Andersson TM-L, Smedby KE, Dickman PW, Eloranta S. Temporal trends in treatment-related incidence of diseases of the circulatory system among Hodgkin lymphoma patients. International Journal of Cancer 2019;145:1200–8. https://doi.org/10.1002/ijc.32142.\nSyriopoulou E, Mozumder SI, Rutherford MJ, Lambert PC. Robustness of individual and marginal model-based estimates: A sensitivity analysis of flexible parametric models. Cancer Epidemiology 2018;58:17–24. https://doi.org/10.1016/j.canep.2018.10.017.\nPlym A, Bower H, Fredriksson I, Holmberg L, Lambert PC, Lambe M. Loss in working years after a breast cancer diagnosis. British Journal of Cancer 2018;118:738–43. https://doi.org/10.1038/bjc.2017.456.\nMozumder SI, Dickman PW, Rutherford MJ, Lambert PC. InterPreT cancer survival: A dynamic web interactive prediction cancer survival tool for health-care professionals and cancer epidemiologists. Cancer Epidemiology 2018;56:46–52. https://doi.org/10.1016/j.canep.2018.07.009.\nWeibull CE, Johansson ALV, Eloranta S, Smedby KaE, Björkholm M, Lambert PC, Dickman PW, Glimelius I. Contemporarily treated patients with Hodgkin lymphoma have childbearing potential in line with matched comparators. Journal of Clinical Oncology 2018;36:2718–25. https://doi.org/10.1200/JCO.2018.78.3514.\nLatimer NR, Abrams KR, Lambert PC, Morden JP, Crowther MJ. Assessing methods for dealing with treatment switching in clinical trials: A follow-up simulation study. Statistical Methods in Medical Research 2018;27:765–84. https://doi.org/10.1177/0962280216642264.\nMozumder SI, Rutherford MJ, Lambert PC. A flexible parametric competing-risks model using a direct likelihood approach for the cause-specific cumulative incidence function. The Stata Journal 2017;17:462–89. https://doi.org/10.1177/1536867x1701700212.\nMozumder SI, Lambert PC, Rutherford MJ. Direct likelihood inference on the cause-specific cumulative incidence function: A flexible parametric regression modelling approach. Statistics in Medicine 2018;37:82–97. https://doi.org/10.1002/sim.7498.\nBower H, Andersson TM-L, Crowther MJ, Dickman PW, Lambe M, Lambert PC. Adjusting expected mortality rates using information from a control population: An example using socioeconomic status. American Journal of Epidemiology 2018;187:828–36. https://doi.org/10.1093/aje/kwx303.\nLatimer NR, Abrams KR, Lambert PC, Crowther MJ, Wailoo AJ, Morden JP, Akehurst RL, Campbell MJ. Adjusting for treatment switching in randomised controlled trials - a simulation study and a simplified two-stage method. Statistical Methods in Medical Research 2017;26:724–51. https://doi.org/10.1177/0962280214557578.\nPeters TL, Weibull CE, Fang F, Sandler DP, Lambert PC, Ye W, Kamel F. Association of fractures with the incidence of amyotrophic lateral sclerosis. Amyotrophic Lateral Sclerosis & Frontotemporal Degeneration 2017;18:419–25. https://doi.org/10.1080/21678421.2017.1300287.\nCrowther MJ, Lambert PC. Parametric multi-state survival models: Flexible modelling allowing transition-specific distributions with application to estimating clinically useful measures of effect differences. Statistics in Medicine 2017;36:4719–42. https://doi.org/10.1002/sim.7448.\nCramb SM, Mengersen KL, Lambert PC, Ryan LM, Baade PD. A flexible parametric approach to examining spatial variation in relative survival. Statistics in Medicine 2016;35:5448–63. https://doi.org/10.1002/sim.7071.\nLambert PC. The estimation and modelling of cause-specific cumulative incidence functions using time-dependent weights. The Stata Journal 2017;17:181–207.\nLambert PC, Wilkes SR, Crowther MJ. Flexible parametric modelling of the cause-specific cumulative incidence function. Statistics in Medicine 2017;36:1429–46. https://doi.org/10.1002/sim.7208.\nSyriopoulou E, Bower H, Andersson TM-L, Lambert PC, Rutherford MJ. Estimating the impact of a cancer diagnosis on life expectancy by socio-economic group for a range of cancer types in England. British Journal of Cancer 2017;117:1419–26. https://doi.org/10.1038/bjc.2017.300.\nBower H, Andersson TML, Bjorkholm M, Dickman PW, Lambert PC, Derolf AR. Continued improvement in survival of acute myeloid leukemia patients: An application of the loss in expectation of life. Blood Cancer Journal 2016;6:e390. https://doi.org/10.1038/bcj.2016.3.\nBower H, Björkholm M, Dickman PW, Höglund M, Lambert PC, Andersson TM-L. Life expectancy of chronic myeloid leukemia patients is approaching the life expectancy of the general population. Journal of Clinical Oncology 2016;34:2851–7. https://doi.org/10.1200/JCO.2015.66.2866.\nBower H, Crowther MJ, Lambert PC. strcs: A command for fitting flexible parametric survival models on the log-hazard scale. The Stata Journal 2016;16:989–1012. https://doi.org/10.1177/1536867X1601600410.\nEdgren G, Hjalgrim H, Rostgaard K, Lambert PC, Wikman A, Norda R, Titlestad K-E, Erikstrup C, Ullum H, Melbye M, Busch MP, Nyrón O. Transmission of neurodegenerative disorders through blood transfusion: A cohort study. Annals of Internal Medicine 2016;165:316–24. https://doi.org/10.7326/M15-2421.\nCrowther MJ, Andersson TM-L, Lambert PC, Abrams KR, Humphreys K. Joint modelling of longitudinal and survival data: Incorporating delayed entry and an assessment of model misspecification. Statistics in Medicine 2016;35:1193–209. https://doi.org/10.1002/sim.6779.\nAndersson TM-L, Dickman PW, Eloranta S, Sjövall A, Lambe M, Lambert PC. The loss in expectation of life after colon cancer: A population-based study. BMC Cancer 2015;15:412. https://doi.org/10.1186/s12885-015-1427-2.\nHultcrantz M, Wilkes SR, Kristensson SY, Andersson TM-L, Derolf A, Eloranta S, O. OL, Lambert PC, Björkholm M. Risk and cause of death in 9,285 patients diagnosed with myeloproliferative neoplasms in Sweden between 1973 and 2005. A population-based study. Journal of Clinical Oncology 2015;33:2288–95. https://doi.org/10.1200/JCO.2014.57.6652.\nRutherford MJ, Abel GA, Greenberg DC, Lambert PC, Lyratzopoulos G. The impact of eliminating age inequalities in stage at diagnosis on breast cancer survival for older women. British Journal of Cancer 2015;112:S124–8. https://doi.org/10.1038/bjc.2015.51.\nRutherford MJ, Ironmonger L, Ormiston-Smith N, Abel GA, Greenberg DC, Lyratzopoulos G, Lambert PC. Estimating the potential survival gains by eliminating socioeconomic and sex inequalities in stage at diagnosis of melanoma. British Journal of Cancer 2015;112 Suppl:S116–23. https://doi.org/10.1038/bjc.2015.50.\nCrowther MJ, Lambert PC. Reply to letter to the Editor by Remontet et al. Statistics in Medicine 2015;34:3378–80. https://doi.org/10.1002/sim.6606.\nLambert PC, Dickman PW, Rutherford MJ. Comparison of approaches to estimating age-standardized net survival. BMC Med Res Methodol 2015;15:64. https://doi.org/10.1186/s12874-015-0057-3.\nRutherford MJ, Andersson TM-L, Møller H, Lambert PC. Understanding the impact of socioeconomic differences in breast cancer survival in England and Wales: Avoidable deaths and potential gain in expectation of life. Cancer Epidemiology 2015;39:118–25. https://doi.org/10.1016/j.canep.2014.11.002.\nRutherford MJ, Crowther MJ, Lambert PC. The use of restricted cubic splines to approximate complex hazard functions in the analysis of time-to-event data: A simulation study. Journal of Statistical Computation and Simulation 2015;85:777–93. https://doi.org/10.1080/00949655.2013.845890.\nCrowther MJ, Lambert PC. A general framework for parametric survival analysis. Statistics in Medicine 2014;33:5280–97. https://doi.org/10.1002/sim.6300.\nEloranta S, Lambert PC, Andersson TM-L, Björkholm M, Dickman PW. The application of cure models in the presence of competing risks: A tool for improved risk communication in population-based cancer patient survival. Epidemiology 2014;25:742–8. https://doi.org/10.1097/EDE.0000000000000130.\nFeldman AL, Johansson ALV, Lambert PC, Sieurin J, Yang F, Pedersen NL, Wirdefeldt K. Familial coaggregation of alzheimer’s disease and parkinson’s disease: Systematic review and meta-analysis. Neuroepidemiology 2014;42:69–80. https://doi.org/10.1159/000355452.\nGao H, Hägg S, Sjögren P, Lambert PC, Ingelsson E, Dam RM van. Serum selenium in relation to measures of glucose metabolism and incidence of type 2 diabetes in an older swedish population. Diabetic Medicine : A Journal of the British Diabetic Association 2014;31:787–93. https://doi.org/10.1111/dme.12429.\nLatimer NR, Abrams KR, Lambert PC, Crowther MJ, Wailoo AJ, Morden JP, Akehurst RL, Campbell MJ. Adjusting survival time estimates to account for treatment switching in randomized controlled trials–an economic evaluation context: Methods, limitations, and recommendations. Medical Decision Making 2014;34:387–402. https://doi.org/10.1177/0272989X13520192.\nAndersson TM-L, Eriksson H, Hansson J, Månsson-Brahme E, Dickman PW, Eloranta S, Lambe M, Lambert PC. Estimating the cure proportion of malignant melanoma, an alternative approach to assess long term survival: A population-based study. Cancer Epidemiology 2014;38:93–9. https://doi.org/10.1016/j.canep.2013.12.006.\nAndersson TM-L, Dickman PW, Eloranta S, Lambe M, Lambert PC. Estimating the loss in expectation of life due to cancer using flexible parametric survival models. Statistics in Medicine 2013;32:5286–300. https://doi.org/10.1002/sim.5943.\nAhyow LC, Lambert PC, Jenkins DR, Neal KR, Tobin M. Bed occupancy rates and hospital-acquired clostridium difficile infection: A cohort study. Infection Control and Hospital Epidemiology 2013;34:1062–9. https://doi.org/10.1086/673156.\nCrowther MJ, Abrams KR, Lambert PC. Joint modelling of longitudinal and survival data. The Stata Journal 2013;13:165–84.\nCrowther MJ, Lambert PC. Stgenreg: A stata package for general parametric survival analysis. Journal of Statistical Software 2013;53:1–17. https://doi.org/10.18637/jss.v053.i12.\nCrowther MJ, Lambert PC. Simulating biologically plausible complex survival data. Statistics in Medicine 2013;32:4118–34. https://doi.org/10.1002/sim.5823.\nCrowther MJ, Lambert PC, Abrams KR. Adjusting for measurement error in baseline prognostic biomarkers included in a time-to-event analysis: A joint modelling approach. BMC Medical Research Methodology 2013;13:146. https://doi.org/10.1186/1471-2288-13-146.\nCvancarova M, Aagnes B, Fosså SD, Lambert PC, Møller B, Bray F. Proportion cured models applied to 23 cancer sites in norway. International Journal of Cancer 2012;132:1700–10. https://doi.org/10.1002/ijc.27802.\nEloranta S, Adolfsson J, Lambert PC, Stattin P, Akre O, Andersson TM-L, Dickman PW. How can we make cancer survival statistics more useful for patients and clinicians: An illustration using localized prostate cancer in Sweden. Cancer Causes Control 2013;24:505–15. https://doi.org/10.1007/s10552-012-0141-5.\nEloranta S, Lambert PC, Sjöberg J, Andersson TM-L, Björkholm M, Dickman PW. Temporal trends in mortality from diseases of the circulatory system after treatment for Hodgkin lymphoma: A population-based cohort study in Sweden (1973 to 2006). Journal of Clinical Oncology 2013;31:1435–41. https://doi.org/10.1200/JCO.2012.45.2714.\nHinchliffe SR, Abrams KR, Lambert PC. The impact of under and over-recording of cancer on death certificates in a competing risks analysis: A simulation study. Cancer Epidemiology 2013;37:11–9. https://doi.org/10.1016/j.canep.2012.08.012.\nHinchliffe SR, Lambert PC. Flexible parametric modelling of cause-specific hazards to estimate cumulative incidence functions. BMC Medical Research Methodology 2013;13:13. https://doi.org/10.1186/1471-2288-13-13.\nHinchliffe SR, Lambert PC. Extending the flexible parametric survival model for competing risks. The Stata Journal 2013;13:344–55.\nHinchliffe SR, Scott DA, Lambert PC. Flexible parametric illness-death models. The Stata Journal 2013;13:759–75.\nHinchliffe SR, Seaton SE, Lambert PC, Draper ES, Field DJ, Manktelow BN. Modelling time to death or discharge in neonatal care: An application of competing risks. Paediatr Perinat Epidemiol 2013;27:426–33. https://doi.org/10.1111/ppe.12053.\nRutherford MJ, Hinchliffe SR, Abel GA, Lyratzopoulos G, Lambert PC, Greenberg DC. How much of the deprivation gap in cancer survival can be explained by variation in stage at diagnosis: An example from breast cancer in the East of England. International Journal of Cancer 2013;133:2192–200. https://doi.org/10.1002/ijc.28221.\nRutherford MJ, Møller H, Lambert PC. A comprehensive assessment of the impact of errors in the cancer registration process on 1- and 5-year relative survival estimates. British Journal of Cancer 2013;108:691–8. https://doi.org/10.1038/bjc.2013.12.\nDickman PW, Lambert PC, Coviello E, Rutherford MJ. Estimating net survival in population-based cancer studies. International Journal of Cancer 2013;133:519–21. https://doi.org/10.1002/ijc.28041.\nShah A, Andersson TM-L, Rachet B, Björkholm M, Lambert PC. Survival and cure of acute myeloid leukaemia in England, 1971-2006: A population-based study. British Journal of Haematology 2013;162:509–16. https://doi.org/10.1111/bjh.12425.\nYu XQ, De Angelis R, Andersson TML, Lambert PC, O’Connell DL, Dickman PW. Estimating the proportion cured of cancer: Some practical advice for users. Cancer Epidemiology 2013;37:836–42. https://doi.org/10.1016/j.canep.2013.08.014.\nAndersson TM-L, Lambert PC. Fitting and modeling cure in population-based cancer studies within the framework of flexible parametric survival models. The Stata Journal 2012;12:623–8.\nAndrae B, Andersson TM-L, Lambert PC, Kemetli L, Silfverdal L, Strander B, Ryd W, Dillner J, Törnberg S, Sparén P. Screening and cervical cancer cure: Population based cohort study. BMJ 2012;344:e900. https://doi.org/10.1136/bmj.e900.\nCrowther MJ, Abrams KR, Lambert PC. Flexible parametric joint modelling of longitudinal and survival data. Statistics in Medicine 2012;31:4456–71. https://doi.org/10.1002/sim.5644.\nCrowther MJ, Lambert PC. Simulating complex survival data. The Stata Journal 2012;12:674–87.\nCrowther MJ, Riley RD, Staessen JA, Wang J, Gueyffier F, Lambert PC. Individual patient data meta-analysis of survival data using Poisson regression models. BMC Medical Research Methodology 2012;12:34. https://doi.org/10.1186/1471-2288-12-34.\nEloranta S, Lambert PC, Andersson TM-L, Czene K, Hall P, Björkholm M, Dickman PW. Partitioning of excess mortality in population-based cancer patient survival studies using flexible parametric survival models. BMC Medical Research Methodology 2012;12:86. https://doi.org/10.1186/1471-2288-12-86.\nHinchliffe SR, Dickman PW, Lambert PC. Adjusting for the proportion of cancer deaths in the general population when using relative survival: A sensitivity analysis. Cancer Epidemiology 2012;36:148–52. https://doi.org/10.1016/j.canep.2011.09.007.\nHinchliffe SR, Rutherford MJ, Crowther MJ, Nelson CP, Lambert PC. Should relative survival be used with lung cancer data? British Journal of Cancer 2012;106:1854–9. https://doi.org/10.1038/bjc.2012.182.\nHolmberg L, Robinson D, Sandin F, Bray F, Linklater KM, Klint A, Lambert PC, Adolfsson J, Hamdy FC, Catto J, Møller H. A comparison of prostate cancer survival in England, Norway and Sweden: A population-based study. Cancer Epidemiology 2012;36:e7–12. https://doi.org/10.1016/j.canep.2011.08.001.\nMøller H, Sandin F, Robinson D, Bray F, Klint S, Linklater KM, Lambert PC, Påhlman L, Holmberg L, Morris E. Colorectal cancer survival in socioeconomic groups in England: Variation is mainly in the short term after diagnosis. European Journal of Cancer 2012;48:46–53. https://doi.org/10.1016/j.ejca.2011.05.018.\nRutherford MJ, Dickman PW, Lambert PC. Comparison of methods for calculating relative survival in population-based studies. Cancer Epidemiology 2012;36:16–21. https://doi.org/10.1016/j.canep.2011.05.010.\nRutherford MJ, Thompson JR, Lambert PC. Projecting cancer incidence using age-period-cohort models incorporating restricted cubic splines. International Journal of Biostatistics 2012;8:33. https://doi.org/10.1515/1557-4679.1411.\nShack LG, Shah A, Lambert PC, Rachet B. Cure by age and stage at diagnosis for colorectal cancer patients in North West England, 1997-2004: A population-based study. Cancer Epidemiology 2012;36:548–53. https://doi.org/10.1016/j.canep.2012.06.011.\nAndersson TM-L, Dickman PW, Eloranta S, Lambert PC. Estimating and modelling cure in population-based cancer studies within the framework of flexible parametric survival models. BMC Medical Research Methodology 2011;11:96. https://doi.org/10.1186/1471-2288-11-96.\nEaker S, Wigertz A, Lambert PC, Bergkvist L, Ahlgren J, Lambe M, Uppsala/Örebro Breast Cancer Group. Breast cancer, sickness absence, income and marital status. A study on life situation 1 year prior diagnosis compared to 3 and 5 years after diagnosis. PLoS One 2011;6:e18040. https://doi.org/10.1371/journal.pone.0018040.\nHakulinen T, Seppä K, Lambert PC. Choosing the relative survival method for cancer survival estimation. European Journal of Cancer 2011;47:2202–10. https://doi.org/10.1016/j.ejca.2011.03.011.\nLambert PC, Holmberg L, Sandin F, Bray F, Linklater KM, Purushotham A, Robinson D, Møller H. Quantifying differences in breast cancer survival between England and Norway. Cancer Epidemiology 2011;35:526–33. https://doi.org/10.1016/j.canep.2011.04.003.\nColeman MP, Rachet B, Woods L, Berrino F, Butler J, Capocaccia R, Dickman PW, Gavin A, Giorgi R, Hamilton W, Lambert PC, Peake MD, Perme MP, Stare J, Vedstedt P. Rebuttal to editorial saying cancer survival statistics are misleading. BMJ 2011;343:d4214. https://doi.org/10.1136/bmj.d4214.\nMorden JP, Lambert PC, Latimer N, Abrams KR, Wailoo AJ. Assessing methods for dealing with treatment switching in randomised controlled trials: A simulation study. BMC Medical Research Methodology 2011;11:572–82. https://doi.org/10.1093/biostatistics/kxq007.\nMorris EJA, Sandin F, Lambert PC, Bray F, Klint Å, Linklater K, Robinson D, Påhlman L, Holmberg L, Møller H. A population-based comparison of the survival of patients with colorectal cancer in England, Norway and Sweden between 1996 and 2004. Gut 2011;60:1087–93. https://doi.org/10.1136/gut.2010.229575.\nAndersson TM-L, Lambert PC, Derolf AR, Kristinsson SY, Eloranta S, Landgren O, Björkholm M, Dickman PW. Temporal trends in the proportion cured among adults diagnosed with acute myeloid leukaemia in Sweden 1973-2001, a population-based study. Br J Haematol 2010;148:918–24. https://doi.org/10.1111/j.1365-2141.2009.08026.x.\nEloranta S, Lambert PC, Cavalli-Björkman N, Andersson TM-L, Glimelius B, Dickman PW. Does socioeconomic status influence the prospect of cure from colon cancer–a population-based study in Sweden 1965-2000. European Journal of Cancer 2010;46:2965–72. https://doi.org/10.1016/j.ejca.2010.05.028.\nLambert PC, Dickman PW, Nelson CP, Royston P. Estimating the crude probability of death due to cancer and other causes using relative survival models. Statistics in Medicine 2010;29:885–95. https://doi.org/10.1002/sim.3762.\nLambert PC, Dickman PW, Weston CL, Thompson JR. Estimating the cure fraction in population-based cancer studies by using finite mixture models. Journal of the Royal Statistical Society, Series C 2010;59:35–55. https://doi.org/10.1111/j.1467-9876.2009.00677.x.\nRiley RD, Lambert PC, Abo-Zaid G. Meta-analysis of individual participant data: Rationale, conduct, and reporting. BMJ 2010;340:c221. https://doi.org/10.1136/bmj.c221.\nRutherford MJ, Lambert PC, Thompson JR. Age-period-cohort modelling. The Stata Journal 2010;10:606–27. https://doi.org/10.1038/bjc.2015.51.\nSquire IB, Nelson CP, Ng LL, Jones DR, Woods KL, Lambert PC. Prognostic value of admission blood glucose concentration and diabetes diagnosis on survival after acute myocardial infarction; results from 4702 index cases in routine practice. Clinical Science 2010;118:527–35. https://doi.org/10.1042/CS20090322.\nLambert PC, Royston P. Further development of flexible parametric models for survival analysis. The Stata Journal 2009;9:265–90.\nLarfors G, Lambert PC, Lambe M, Ekbom A, Cnattingius S. Placental weight and breast cancer survival in young women. Cancer Epidemiol Biomarkers Prev 2009;18:777–83. https://doi.org/10.1158/1055-9965.EPI-08-0979.\nPanickar J, Lakhanpaul M, Lambert PC, Kenia P, Stephenson T, Smyth A, Grigg J. Oral prednisolone for preschool children with acute virus-induced wheezing. New England Journal of Medicine 2009;360:329–38. https://doi.org/10.1056/NEJMoa0804897.\nWoods LM, Rachet B, Lambert PC, Coleman MP. ‘Cure’ from breast cancer among two populations of women followed for 23 years after diagnosis. Annals of Oncology 2009;20:1331–6. https://doi.org/10.1093/annonc/mdn791.\nBhaskaran K, Hamouda O, Sannes M, Boufassa F, Johnson AM, Lambert PC, Porter K, CASCADE Collaboration. Changes in the risk of death after HIV seroconversion compared with mortality in the general population. JAMA 2008;300:51–9. https://doi.org/10.1001/jama.300.1.51.\nGillies CL, Lambert PC, Abrams KR, Sutton AJ, Cooper NJ, Hsu RT, Davies MJ, Khunti K. Different strategies for screening and prevention of type 2 diabetes in adults: Cost effectiveness analysis. BMJ 2008;336:1180–5. https://doi.org/10.1136/bmj.39545.585289.25.\nLambert PC, Billingham LJ, Cooper NJ, Sutton AJ, Abrams KR. Estimating the cost-effectiveness of an intervention in a clinical trial when partial cost information is available: A Bayesian approach. Health Economics 2008;17:67–81. https://doi.org/10.1002/hec.1243.\nNelson CP, Lambert PC, Squire IB, Jones DR. Relative survival: What can cardiovascular disease learn from cancer? European Heart Journal 2008;29:941–7. https://doi.org/10.1093/eurheartj/ehn079.\nLambert PC, Sutton AJ, Burton PR, Abrams KR, Jones DR. Comments on ’trying to be precise about vagueness’ by stephen senn, statistics in medicine 2007; 26:1417-1430. Statistics in Medicine 2008;27:619–22, author reply 622–4. https://doi.org/10.1002/sim.3043.\nReynolds R, Lambert PC, Burton PR, B. S. A. C. Extended Working Parties on Resistance Surveillance. Analysis, power and design of antimicrobial resistance surveillance studies, taking account of inter-centre variation and turnover. J Antimicrob Chemother 2008;62 Suppl 2:ii29–39. https://doi.org/10.1093/jac/dkn350.\nRiley RD, Lambert PC, Staessen JA, Wang J, Gueyffier F, Thijs L, Boutitie F. Meta-analysis of continuous outcomes combining individual patient data and aggregate data. Statistics in Medicine 2008;27:1870–93. https://doi.org/10.1002/sim.3165.\nCooper NJ, Lambert PC, Abrams KR, Sutton AJ. Predicting costs over time using Bayesian Markov chain Monte Carlo methods: An application to early inflammatory polyarthritis. Health Economics 2007;16:37–56. https://doi.org/10.1002/hec.1141.\nGillies CL, Abrams KR, Lambert PC, Cooper NJ, Sutton AJ, Hsu RT, Khunti K. Pharmacological and lifestyle interventions to prevent or delay type 2 diabetes in people with impaired glucose tolerance: Systematic review and meta-analysis. BMJ 2007;334:299. https://doi.org/10.1136/bmj.39063.689375.55.\nLambert PC. Modeling of the cure fraction in survival studies. The Stata Journal 2007;7:351–75.\nLambert PC, Dickman PW, Österlund P, Andersson TM-L, Sankila R, Glimelius B. Temporal trends in the proportion cured for cancer of the colon and rectum: A population-based study using data from the Finnish cancer registry. International Journal of Cancer 2007;121:2052–9. https://doi.org/10.1002/ijc.22948.\nLambert PC, Thompson JR, Weston CL, Dickman PW. Estimating and modeling the cure fraction in population-based cancer survival analysis. Biostatistics 2007;8:576–94. https://doi.org/10.1093/biostatistics/kxl030.\nManca A, Lambert PC, Sculpher M, Rice N. Cost-effectiveness analysis using data from multinational trials: The use of bivariate hierarchical modeling. Medical Decision Making 2007;27:471–90. https://doi.org/10.1177/0272989X07302132.\nNelson CP, Lambert PC, Squire IB, Jones DR. Flexible parametric models for relative survival, with application in coronary heart disease. Statistics in Medicine 2007;26:5486–98. https://doi.org/10.1002/sim.3064.\nRiley RD, Abrams KR, Lambert PC, Sutton AJ, Thompson JR. An evaluation of bivariate random-effects meta-analysis for the joint synthesis of two correlated outcomes. Statistics in Medicine 2007;26:78–97. https://doi.org/10.1002/sim.2524.\nRiley RD, Abrams KR, Sutton AJ, Lambert PC, Thompson JR. Bivariate random-effects meta-analysis and the estimation of between-study correlation. BMC Medical Research Methodology 2007;7:3. https://doi.org/10.1186/1471-2288-7-3.\nSutton AJ, Cooper NJ, Jones DR, Lambert PC, Thompson JR, Abrams KR. Evidence-based sample size calculations based upon updated meta-analysis. Statistics in Medicine 2007;26:2479–500. https://doi.org/10.1002/sim.2704.\nAbrams KR, Gillies CL, Lambert PC. Meta-analysis of heterogeneously reported trials assessing change from baseline. Statistics in Medicine 2005;24:3823–44. https://doi.org/10.1002/sim.2423.\nLambert PC, Smith LK, Jones DR, Botha JL. Additive and multiplicative covariate regression models for relative survival incorporating fractional polynomials for time-dependent effects. Statistics in Medicine 2005;24:3871–85. https://doi.org/10.1002/sim.2399.\nLambert PC, Sutton AJ, Burton PR, Abrams KR, Jones DR. How vague is vague? A simulation study of the impact of the use of vague prior distributions in MCMC using WinBUGS. Statistics in Medicine 2005;24:2401–28. https://doi.org/10.1002/sim.2112.\nMinelli C, Thompson JR, Abrams KR, Lambert PC. Bayesian implementation of a genetic model-free approach to the meta-analysis of genetic association studies. Statistics in Medicine 2005;24:3845–61. https://doi.org/10.1002/sim.2393.\nSutton AJ, Cooper NJ, Abrams KR, Lambert PC, Jones DR. A Bayesian approach to evaluating net clinical benefit allowed for parameter uncertainty. Journal of Clinical Epidemiology 2005;58:26–40. https://doi.org/10.1016/j.jclinepi.2004.03.015.\nTaub NA, Morgan Z, Brugha TS, Lambert PC, Bebbington PE, Jenkins R, Kessler RC, Zaslavsky AM, Hotz T. Recalibration methods to enhance information on prevalence rates from large mental health surveys. Int J Methods Psychiatr Res 2005;14:3–13.\nLambert PC, Burton PR, Abrams KR, Brooke AM. The analysis of peak expiratory flow data using a three-level hierarchical model. Statistics in Medicine 2004;23:3821–39. https://doi.org/10.1002/sim.1951.\nRiley RD, Heney D, Jones DR, Sutton AJ, Lambert PC, Abrams KR, Young B, Wailoo AJ, Burchill SA. A systematic review of molecular and biological tumor markers in neuroblastoma. Clinical Cancer Research 2004;10:4–12.\nRiley RD, Sutton AJ, Abrams KR, Lambert PC. Sensitivity analyses allowed more appropriate and reliable meta-analysis conclusions for multiple outcomes when missing data was present. Journal of Clinical Epidemiology 2004;57:911–24. https://doi.org/10.1016/j.jclinepi.2004.01.018.\nSmith LK, Lambert PC, Botha JL, Jones DR. Providing more up-to-date estimates of patient survival: A comparison of standard survival analysis with period analysis using life-table methods and proportional hazards models. Journal of Clinical Epidemiology 2004;57:14–20. https://doi.org/10.1016/S0895-4356(03)00253-1.\nSweeting MJ, Sutton AJ, Lambert PC. What to add to nothing? Use and avoidance of continuity corrections in meta-analysis of sparse data. Statistics in Medicine 2004;23:1351–75. https://doi.org/10.1002/sim.1761.\nBaker R, Smith JF, Lambert PC. Randomised controlled trial of the effectiveness of feedback in improving test ordering in general practice. Scand J Prim Health Care 2003;21:219–23.\nHsu RT, Lambert PC, Dixon-Woods M, Kurinczuk JJ. Effect of NHS walk-in centre on local primary healthcare services: Before and after observational study. BMJ 2003;326:530. https://doi.org/10.1136/bmj.326.7388.530.\nMckean MC, Hewitt C, Lambert PC, Myint S, Silverman M. An adult model of exclusive viral wheeze: Inflammation in the upper and lower respiratory tracts. Clin Exp Allergy 2003;33:912–20.\nOommen A, Lambert PC, Grigg J. Efficacy of a short course of parent-initiated oral prednisolone for viral wheeze in children aged 1-5 years: Randomised controlled trial. Lancet 2003;362:1433–8. https://doi.org/10.1016/S0140-6736(03)14685-5.\nRiley RD, Abrams KR, Sutton AJ, Lambert PC, Jones DR, Heney D, Burchill SA. Reporting of prognostic markers: Current problems and development of guidelines for evidence-based practice in the future. British Journal of Cancer 2003;88:1191–8. https://doi.org/10.1038/sj.bjc.6600886.\nCooper NJ, Abrams KR, Sutton AJ, Turner D, Lambert PC. A bayesian approach to markov modelling in cost-effectiveness analyses: Application to taxane use in advanced breast cancer. Journal of the Royal Statistical Society Series A: Statistics in Society 2003;166:389–405. https://doi.org/10.1111/1467-985x.00283.\nRiley RD, Burchill SA, Abrams KR, Heney D, Lambert PC, Jones DR, Sutton AJ, Young B, Wailoo AJ, Lewis IJ. A systematic review and evaluation of the use of tumour markers in paediatric oncology: Ewing’s sarcoma and neuroblastoma. Health Technol Assess 2003;7:1–162.\nWaugh J, Kilby M, Lambert P, Bell SC, Blackwell CN, Shennan A, Halligan A. Validation of the DCA 2000 microalbumin:creatinine ratio urinanalyzer for its use in pregnancy and preeclampsia. Hypertension in Pregnancy 2003;22:77–92. https://doi.org/10.1081/prg-120017006.\nRiley RD, Burchill SA, Abrams KR, Heney D, Sutton AJ, Jones DR, Lambert PC, Young B, Wailoo AJ, Lewis IJ. A systematic review of molecular and biological markers in tumours of the ewing’s sarcoma family. European Journal of Cancer 2003;39:19–30.\nSmith LK, Lambert PC, Jones DR. Up-to-date estimates of long-term cancer survival in England and Wales. British Journal of Cancer 2003;89:74–6. https://doi.org/10.1038/sj.bjc.6600976.\nWaugh J, Bell SC, Kilby MD, Lambert PC, Blackwell CN, Shennan A, Halligan A. Urinary microalbumin/creatinine ratios: Reference range in uncomplicated pregnancy. Clinical Science 2003;104:103–7. https://doi.org/10.1042/CS20020170.\nLambert PC, Sutton AJ, Abrams KR, Jones DR. A comparison of summary patient-level covariates in meta-regression with individual patient data meta-analysis. Journal of Clinical Epidemiology 2002;55:86–94.\nYoung B, Fitch GE, Dixon-Woods M, Lambert PC, Brooke AM. Parents’ accounts of wheeze and asthma related symptoms: A qualitative study. Arch Dis Child 2002;87:131–4.\nSutton AJ, Cooper NJ, Lambert PC, Jones DR, Abrams KR, Sweeting MJ. Meta-analysis of rare and adverse event data. Expert Review of Pharmacoeconomics and Outcomes Research 2002;2:367–79. https://doi.org/10.1586/14737167.2.4.367.\nLambert PC, Abrams KR, Jones DR, Halligan AW, Shennan A. Analysis of ambulatory blood pressure monitor data using a hierarchical model incorporating restricted cubic splines and heterogeneous within-subject variances. Statistics in Medicine 2001;20:3789–805.\nMckean MC, Leech M, Lambert PC, Hewitt C, Myint S, Silverman M. A model of viral wheeze in nonasthmatic adults: Symptoms and physiology. Eur Respir J 2001;18:23–32.\nWaugh J, Perry IJ, Halligan AW, Swiet MD, Lambert PC, Penny JA, Taylor DJ, Jones DR, Shennan A. Birth weight and 24-hour ambulatory blood pressure in nonproteinuric hypertensive pregnancy. Am J Obstet Gynecol 2000;183:633–7. https://doi.org/10.1067/mob.2000.106448.\nBell SC, Halligan AW, Martin A, Ashmore J, Shennan AH, Lambert PC, Taylor DJ. The role of observer error in antenatal dipstick proteinuria analysis. Br J Obstet Gynaecol 1999;106:1177–80.\nWilliams N, Jackson D, Lambert PC, Johnstone JM. Incidence of non-specific abdominal pain in children during school term: Population survey based on discharge diagnoses. BMJ 1999;318:1455.\nBrooke AM, Lambert PC, Burton PR, Clarke C, Luyt DK, Simpson H. Recurrent cough: Natural history and significance in infancy and early childhood. Pediatr Pulmonol 1998;26:256–61.\nHellmich M, Abrams KR, Jones DR, Lambert PC. A Bayesian approach to a general regression model for ROC curves. Medical Decision Making 1998;18:436–43.\nPenny JA, Halligan AW, Shennan AH, Lambert PC, Jones DR, Swiet M de, Taylor DJ. Automated, ambulatory, or conventional blood pressure measurement in pregnancy: Which is the better predictor of severe hypertension? Am J Obstet Gynecol 1998;178:521–6.\nHalligan AW, Shennan A, Lambert PC, Bell SC, Taylor DJ, Swiet M de. Automated blood pressure measurement as a predictor of proteinuric pre-eclampsia. Br J Obstet Gynaecol 1997;104:559–62.\nBrooke AM, Lambert PC, Burton PR, Clarke C, Luyt DK, Simpson H. Night cough in a population-based sample of children: Characteristics, relation to symptoms and associations with measures of asthma severity. Eur Respir J 1996;9:65–71.\nHalligan A, Lambert PC, O’Brien E, Shennan A. Characteristics of a reversed circadian blood pressure rhythm in pregnant women with hypertension. J Hum Hypertens 1996;10:135.\nHalligan A, Shennan A, Lambert PC, Swiet M de, Taylor DJ. Diurnal blood pressure difference in the assessment of preeclampsia. Obstet Gynecol 1996;87:205–8. https://doi.org/10.1016/0029-7844(95)00379-7.\nPeek M, Shennan A, Halligan A, Lambert PC, Taylor DJ, Swiet MD. Hypertension in pregnancy: Which method of blood pressure measurement is most predictive of outcome? Obstet Gynecol 1996;88:1030–3. https://doi.org/10.1016/S0029-7844(96)00350-X.\nLuyt D, Bourke A, Lambert P, Burton P, Simpson H. Wheeze in preschool children: Who is followed-up, who is treated and who is hospitalized? European Respiratory Journal 1995;8:1736–41. https://doi.org/10.1183/09031936.95.08101736.\nBrooke AM, Lambert PC, Burton PR, Clarke C, Luyt DK, Simpson H. The natural history of respiratory symptoms in preschool children. Am J Respir Crit Care Med 1995;152:1872–8.\nEsmail A, Lambert PC, Jones DR, Mitchell EA. Prevalence of risk factors for sudden infant death syndrome in south east England before the 1991 national ’Back to Sleep’ health education campaign. J Public Health Med 1995;17:282–9."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Paul Lambert",
    "section": "",
    "text": "About me\nI am a biostatistician working at the Cancer Registry of Norway (Kreftregisteret). I also work part-time as a Guest Professor in the Biostatistics Group in the Department of Medical Epidemiology and Biostatistics, Karolinska Institutet, Stockholm, Sweden. Previously, I worked at the Biostatistics Research Group at the University of Leicester, UK.\nI have a variety of interests, mainly in the area of survival analysis in epidemiology. Much of my work focuses on the analysis from data from national cancer registries. I particularly enjoy writing software (mainly in Stata) to enable transferal of new methods into practice.\nMy teaching is now mainly specialist courses (link). and have developed some interactive graphs(link) to help with communication.\n\n\nEducation\n\nPhD in Biostatistics (1999). University of Leicester, UK\nMSc in Medical Statistics (1992). University of Leicester, UK"
  },
  {
    "objectID": "courses.html",
    "href": "courses.html",
    "title": "Courses",
    "section": "",
    "text": "When I worked at the University of Leicester my main teaching was on the MSc Medical Statistics course where I taught various modules including survival analysis, advanced survival analysis, statistical inference and computationally intensive methods. I was a student on this course way back in 1991.\nNow my teaching is mainly delivery of specialist courses."
  },
  {
    "objectID": "courses.html#upcoming-courses",
    "href": "courses.html#upcoming-courses",
    "title": "Courses",
    "section": "Upcoming courses",
    "text": "Upcoming courses\n\n9 September 2024. Modelling survival data using flexible parametric models in Stata using stpm3: concepts and modelling choices. Pre conference course at the 2024 Northern European Stata Conference.\nJune 2025. We (Paul Dickman, Mark Rutherford, Therese Andersson and Betty Syriopoulou and I) hope to teach our 5-day course on statistical methods for population-based cancer survival analysis in Veneto Italy. Further details will be available here."
  },
  {
    "objectID": "talks.html",
    "href": "talks.html",
    "title": "Talks",
    "section": "",
    "text": "Recent (and not so recent) Talks:\n7 June 2024 Recent developments in the fitting and assessment of flexible parametric survival models 2024 German Stata Conference, Mannheim, Germany.\n14th November 2023 Reference adjusted cancer survival measures What are they and when should they be used? 2023 ENCR-IACR Scientific Conference, Granada, Spain.\n12 October 2022 Improving fitting and predictions for flexible parametric survival models Northern European Stata Conference, Oslo, Norway.\n9 September 2022 Improving fitting and predictions for flexible parametric survival models 2022 UK Stata Conference, London, UK\n6 August 2021. Making Stata estimation commands faster through automatic differentiation and integration with Python. 2021 Stata Conference (online)\n18 February 2021. Regression standardization with time-to-event data to estimate marginal measures of association and causal effects using the standsurv command.. Stata Biostatistics and Epidemiology Virtual Symposium.\n22 September 2020. Standardised and reference adjusted all-cause and crude probabilities in the relative survival framework. Advances in Survival Analysis. International Biometric Society - British and Irish Region.\nAugust 2020 A marginal model for relative survival.. International Biometric Society 2020\n26 September 2019. Issues in Standardization. Symposium for statisticians working in register-based cancer epidemiology 2019, Stockholm, Sweden\n29 August 2019. Standardised crude probabilities of death to improve understanding of national and international cancer survival comparisons. Association of the Nordic Cancer Registries meeting 2019, Stockholm Sweden\n30 August 2019. Marginal estimates through regression standardization in competing risks and relative survival models. Nordic and Baltic Stata Users Group meeting 2019, Stockholm, Sweden."
  },
  {
    "objectID": "software/stpm3/predictions.html",
    "href": "software/stpm3/predictions.html",
    "title": "Using frames for predictions",
    "section": "",
    "text": "Predictions are much improved in stpm3.\nWe first load the Rotterdam breast cancer data and then use stset to declare the survival time and event indicator.\n. use https://www.pclambert.net/data/rott3, clear\n(Rotterdam breast cancer data (augmented with cause of death))\n\n. stset os, f(osi==1) scale(12) exit(time 120)\n\nSurvival-time data settings\n\n         Failure event: osi==1\nObserved time interval: (0, os]\n     Exit on or before: time 120\n     Time for analysis: time/12\n\n--------------------------------------------------------------------------\n      2,982  total observations\n          0  exclusions\n--------------------------------------------------------------------------\n      2,982  observations remaining, representing\n      1,171  failures in single-record/single-failure data\n 20,002.424  total analysis time at risk and under observation\n                                                At risk from t =         0\n                                     Earliest observed entry t =         0\n                                          Last observed exit t =        10\nI will fit a simple proportional hazards model just include hormon and age.\n. stpm3 i.hormon age, scale(lncumhazard) df(5) \n\nIteration 0:  Log likelihood = -2909.4582  \nIteration 1:  Log likelihood = -2908.4666  \nIteration 2:  Log likelihood = -2908.4635  \nIteration 3:  Log likelihood = -2908.4635  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(2)  =  64.07\nLog likelihood = -2908.4635                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |\n        yes  |   .3229905   .0876157     3.69   0.000     .1512669    .4947141\n         age |   .0149851    .002374     6.31   0.000     .0103322    .0196381\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |  -24.01501   1.921081   -12.50   0.000    -27.78026   -20.24976\n        _ns2 |   6.695913   1.028047     6.51   0.000     4.680978    8.710849\n        _ns3 |  -1.221354   .0499264   -24.46   0.000    -1.319208   -1.123501\n        _ns4 |  -.8156036   .0389592   -20.93   0.000    -.8919622   -.7392449\n        _ns5 |  -.5046344   .0422296   -11.95   0.000     -.587403   -.4218658\n       _cons |  -1.391522   .1368464   -10.17   0.000    -1.659736   -1.123308\n------------------------------------------------------------------------------\nWe can predict the survival function for a 60 year old women who did not take hormon therapy using,\n. predict S, survival ci                 ///\n&gt;            at1(age 60 hormon 0)        ///\n&gt;            timevar(0 10, step(0.1)) \nPredictions are stored in frame - stpm3_pred\nThe predict command has requested a survival function with a 95% confidence interval. The values of the covariates to predict at are given in the at1() option. It is possible to have multiple at options. The predictions will be at times between 0 and 10 in steps of 0.1, leading to 101 observations.\nWe can list or plot the results in frame stpm3_pred.\n. frame stpm3_pred: list in 1/21, noobs\n\n  +-----------------------------------------+\n  |  tt           S       S_lci       S_uci |\n  |-----------------------------------------|\n  |   0           1           1           1 |\n  |  .1   .99987272   .99948675   .99996844 |\n  |  .2   .99939144   .99844378   .99976209 |\n  |  .3   .99849308    .9969857   .99924694 |\n  |  .4   .99715658   .99513109   .99834016 |\n  |-----------------------------------------|\n  |  .5   .99537771   .99288014   .99700048 |\n  |  .6   .99316099   .99022634    .9952166 |\n  |  .7   .99051598   .98716155   .99299707 |\n  |  .8   .98745529   .98367965   .99036174 |\n  |  .9   .98399346   .97977945   .98733494 |\n  |-----------------------------------------|\n  |   1   .98014617   .97546655   .98394053 |\n  | 1.1   .97592979    .9707539   .98019903 |\n  | 1.2   .97136109   .96566103    .9761267 |\n  | 1.3   .96645696   .96021236   .97173595 |\n  | 1.4   .96123425   .95443524   .96703632 |\n  |-----------------------------------------|\n  | 1.5   .95570969   .94835805   .96203579 |\n  | 1.6   .94989974    .9420086   .95674187 |\n  | 1.7   .94382061   .93541289   .95116257 |\n  | 1.8   .93748813   .92859406   .94530721 |\n  | 1.9   .93091774   .92157156   .93918715 |\n  |-----------------------------------------|\n  |   2   .92412448   .91436051   .93281647 |\n  +-----------------------------------------+\nstpm3 saves predictions to a new frame by default. The default name for the prediction frame is stpm3_pred, but you can, and generally should, choose a frame name using the frame() option.\n. predict S1, survival ci               ///\n&gt;             at1(age 60 hormon 0)      ///\n&gt;             timevar(0 10, step(0.1))  ///\n&gt;             frame(f1)\nPredictions are stored in frame - f1"
  },
  {
    "objectID": "software/stpm3/predictions.html#stpm3-makes-use-of-frames-for-predictions",
    "href": "software/stpm3/predictions.html#stpm3-makes-use-of-frames-for-predictions",
    "title": "Using frames for predictions",
    "section": "",
    "text": "Predictions are much improved in stpm3.\nWe first load the Rotterdam breast cancer data and then use stset to declare the survival time and event indicator.\n. use https://www.pclambert.net/data/rott3, clear\n(Rotterdam breast cancer data (augmented with cause of death))\n\n. stset os, f(osi==1) scale(12) exit(time 120)\n\nSurvival-time data settings\n\n         Failure event: osi==1\nObserved time interval: (0, os]\n     Exit on or before: time 120\n     Time for analysis: time/12\n\n--------------------------------------------------------------------------\n      2,982  total observations\n          0  exclusions\n--------------------------------------------------------------------------\n      2,982  observations remaining, representing\n      1,171  failures in single-record/single-failure data\n 20,002.424  total analysis time at risk and under observation\n                                                At risk from t =         0\n                                     Earliest observed entry t =         0\n                                          Last observed exit t =        10\nI will fit a simple proportional hazards model just include hormon and age.\n. stpm3 i.hormon age, scale(lncumhazard) df(5) \n\nIteration 0:  Log likelihood = -2909.4582  \nIteration 1:  Log likelihood = -2908.4666  \nIteration 2:  Log likelihood = -2908.4635  \nIteration 3:  Log likelihood = -2908.4635  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(2)  =  64.07\nLog likelihood = -2908.4635                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |\n        yes  |   .3229905   .0876157     3.69   0.000     .1512669    .4947141\n         age |   .0149851    .002374     6.31   0.000     .0103322    .0196381\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |  -24.01501   1.921081   -12.50   0.000    -27.78026   -20.24976\n        _ns2 |   6.695913   1.028047     6.51   0.000     4.680978    8.710849\n        _ns3 |  -1.221354   .0499264   -24.46   0.000    -1.319208   -1.123501\n        _ns4 |  -.8156036   .0389592   -20.93   0.000    -.8919622   -.7392449\n        _ns5 |  -.5046344   .0422296   -11.95   0.000     -.587403   -.4218658\n       _cons |  -1.391522   .1368464   -10.17   0.000    -1.659736   -1.123308\n------------------------------------------------------------------------------\nWe can predict the survival function for a 60 year old women who did not take hormon therapy using,\n. predict S, survival ci                 ///\n&gt;            at1(age 60 hormon 0)        ///\n&gt;            timevar(0 10, step(0.1)) \nPredictions are stored in frame - stpm3_pred\nThe predict command has requested a survival function with a 95% confidence interval. The values of the covariates to predict at are given in the at1() option. It is possible to have multiple at options. The predictions will be at times between 0 and 10 in steps of 0.1, leading to 101 observations.\nWe can list or plot the results in frame stpm3_pred.\n. frame stpm3_pred: list in 1/21, noobs\n\n  +-----------------------------------------+\n  |  tt           S       S_lci       S_uci |\n  |-----------------------------------------|\n  |   0           1           1           1 |\n  |  .1   .99987272   .99948675   .99996844 |\n  |  .2   .99939144   .99844378   .99976209 |\n  |  .3   .99849308    .9969857   .99924694 |\n  |  .4   .99715658   .99513109   .99834016 |\n  |-----------------------------------------|\n  |  .5   .99537771   .99288014   .99700048 |\n  |  .6   .99316099   .99022634    .9952166 |\n  |  .7   .99051598   .98716155   .99299707 |\n  |  .8   .98745529   .98367965   .99036174 |\n  |  .9   .98399346   .97977945   .98733494 |\n  |-----------------------------------------|\n  |   1   .98014617   .97546655   .98394053 |\n  | 1.1   .97592979    .9707539   .98019903 |\n  | 1.2   .97136109   .96566103    .9761267 |\n  | 1.3   .96645696   .96021236   .97173595 |\n  | 1.4   .96123425   .95443524   .96703632 |\n  |-----------------------------------------|\n  | 1.5   .95570969   .94835805   .96203579 |\n  | 1.6   .94989974    .9420086   .95674187 |\n  | 1.7   .94382061   .93541289   .95116257 |\n  | 1.8   .93748813   .92859406   .94530721 |\n  | 1.9   .93091774   .92157156   .93918715 |\n  |-----------------------------------------|\n  |   2   .92412448   .91436051   .93281647 |\n  +-----------------------------------------+\nstpm3 saves predictions to a new frame by default. The default name for the prediction frame is stpm3_pred, but you can, and generally should, choose a frame name using the frame() option.\n. predict S1, survival ci               ///\n&gt;             at1(age 60 hormon 0)      ///\n&gt;             timevar(0 10, step(0.1))  ///\n&gt;             frame(f1)\nPredictions are stored in frame - f1"
  },
  {
    "objectID": "software/stpm3.html",
    "href": "software/stpm3.html",
    "title": "stpm3",
    "section": "",
    "text": "stpm3 fits flexible parametric survival models. These models use splines to model the effect of the time scale. stpm3 replaces stpm2, though stpm2 will continue to be available on SSC.\nI have added some examples to explain some of the features of stpm3 and differences to stpm2."
  },
  {
    "objectID": "software/stpm3.html#fitting-stpm3-models.",
    "href": "software/stpm3.html#fitting-stpm3-models.",
    "title": "stpm3",
    "section": "Fitting stpm3 models.",
    "text": "Fitting stpm3 models.\n\nChange to the scale option\nUse of factor variables"
  },
  {
    "objectID": "software/stpm3.html#predictions-conditional-on-covariate-values",
    "href": "software/stpm3.html#predictions-conditional-on-covariate-values",
    "title": "stpm3",
    "section": "Predictions (conditional on covariate values)",
    "text": "Predictions (conditional on covariate values)\n\nFrames for prediction\nExtended functions\nMultiple at options and contrasts\nRelative survival models"
  },
  {
    "objectID": "software/stpm3.html#marginal-predictions",
    "href": "software/stpm3.html#marginal-predictions",
    "title": "stpm3",
    "section": "Marginal predictions",
    "text": "Marginal predictions\n\nUsing standsurv with factor variables"
  },
  {
    "objectID": "software/stpm3.html#other-details",
    "href": "software/stpm3.html#other-details",
    "title": "stpm3",
    "section": "Other Details",
    "text": "Other Details\n\n[Numerical integration for models on log hazard scale]"
  },
  {
    "objectID": "software/stpm3.html#releases",
    "href": "software/stpm3.html#releases",
    "title": "stpm3",
    "section": "Releases",
    "text": "Releases\nSee stpm3_releases.txt"
  },
  {
    "objectID": "software/stpm3/predictions.html#merging-to-an-existing-frame",
    "href": "software/stpm3/predictions.html#merging-to-an-existing-frame",
    "title": "Using frames for predictions",
    "section": "Merging to an existing frame",
    "text": "Merging to an existing frame\nOne feature is that you can merge new predictions to an existing frame. When you do this the time variable stored in the existing frame will be used. For example, we could predict for a 70 year old woman and merge with frame f1.\n. predict S2, survival ci                 ///\n&gt;             at1(age 70 hormon 0)        ///\n&gt;             frame(f1, merge)\nPredictions are stored in frame - f1"
  },
  {
    "objectID": "software/stpm3/predictions.html#plotting-from-a-frame",
    "href": "software/stpm3/predictions.html#plotting-from-a-frame",
    "title": "Using frames for predictions",
    "section": "Plotting from a frame",
    "text": "Plotting from a frame\nIt is simple to plot the predictions stored in a frame.\n. frame f1 {\n.   twoway line S1 S2 tt,                        ///\n&gt;          xtitle(Years since surgery)           ///\n&gt;          ytitle(Survival function)             ///\n&gt;          ylabel(0(0.2)1, format(%3.1f))        ///\n&gt;          legend(order(1 \"Age 60\" 2 \"Age 70\"))\n. }"
  },
  {
    "objectID": "software/stpm3/predictions.html#using-multiple-at-options",
    "href": "software/stpm3/predictions.html#using-multiple-at-options",
    "title": "Using frames for predictions",
    "section": "Using multiple `at’ options",
    "text": "Using multiple `at’ options\nNote that when using predict you can specify multiple at() options, which is often easier than having multiple predict commands. Below I use frame(f1, replace) to replace the existing frame f1.\n. predict S1 S2, survival ci                 ///\n&gt;                at1(age 60 hormon 0)        ///\n&gt;                at2(age 70 hormon 0)        ///\n&gt;                timevar(0 10, step(0.1))    ///\n&gt;                frame(f1, replace)\nPredictions are stored in frame - f1\nI will cover more details about multiple at() options when I discuss contrasts."
  },
  {
    "objectID": "software/stpm3/predictions.html#merging-a-different-type-of-prediction",
    "href": "software/stpm3/predictions.html#merging-a-different-type-of-prediction",
    "title": "Using frames for predictions",
    "section": "Merging a different type of prediction",
    "text": "Merging a different type of prediction\nUsing frame(..., merge) is useful when you require predictions of different types, for example when requiring predictions of both survival and hazard functions. The predictions for the hazard functions are merged with the survival predictions below.\n. predict h1 h2, hazard ci                   ///\n&gt;                at1(age 60 hormon 0)        ///\n&gt;                at2(age 70 hormon 0)        ///\n&gt;                frame(f1, merge)\nPredictions are stored in frame - f1\nAlternatively you may want to predict the hazard function to a new frame."
  },
  {
    "objectID": "software/stpm3/predictions.html#predicting-to-the-active-frame",
    "href": "software/stpm3/predictions.html#predicting-to-the-active-frame",
    "title": "Using frames for predictions",
    "section": "Predicting to the active frame",
    "text": "Predicting to the active frame\nSometimes you may want to merge the predictions into the active frame rather than create a new frame. You can do this with the merge option. This could be useful if you wanted to predict at each observed value in a dataset, for example at the observed event/censoring times (_t), or at a specific value of time.\nThe code below, predicts 10 year survival for each observation in the dataset.\n. predict S10, survival ci          ///\n&gt;              at1(.)               ///\n&gt;              timevar(10)          ///\n&gt;              merge\nNote that only one value of time has been specified in the timevar() option The default is to predict at this time for all individuals. The at1(.) option means that predictions will be at observed values of covariates rather than values specifed by the user.\nWe could plot a histogram of the 10 year survival probabilities.\n. hist S10\n(bin=34, start=.2766368, width=.01245414)"
  },
  {
    "objectID": "software/stpm3/extended_functions.html",
    "href": "software/stpm3/extended_functions.html",
    "title": "Extended Functions",
    "section": "",
    "text": "A new addition to stpm3 is the use of extended functions within a model varlist. This allows you to specify various spline, polynomials, fractional polynomials functions directly when specifying the model. This makes fitting the model slightly easier, but the main advantage is the ease at which you can get predictions from complex models.\nWe first load the Rotterdam 2 breast cancer data and then use stset to declare the survival time and event indicator.\n. use https://www.pclambert.net/data/rott2b, clear\n(Rotterdam breast cancer data (augmented with cause of death))\n\n. stset os, f(osi==1) scale(12) exit(time 60)\n\nSurvival-time data settings\n\n         Failure event: osi==1\nObserved time interval: (0, os]\n     Exit on or before: time 60\n     Time for analysis: time/12\n\n--------------------------------------------------------------------------\n      2,982  total observations\n          0  exclusions\n--------------------------------------------------------------------------\n      2,982  observations remaining, representing\n        753  failures in single-record/single-failure data\n 13,038.968  total analysis time at risk and under observation\n                                                At risk from t =         0\n                                     Earliest observed entry t =         0\n                                          Last observed exit t =         5\nIf you want to include a non-linear effect for a covariate in a model, the usual approach would be to generate some new derived variables and then include these in the model. For example, by generating a quadratic and cubic term or generating spline basis functions using mkspline or rcsgen.\nThe code below shows how to include non-linear effects using restricted cubic splines with rcsgen with 4 knots, which equates to 3 spline variables.\n. rcsgen age, gen(agercs) df(3)\nVariables agercs1 to agercs3 were created\n\n. global ageknots `r(knots)'\n\n. stpm3 i.hormon agercs1-agercs3, scale(lncumhazard) df(5) \n\nIteration 0:  Log likelihood = -2120.3306  \nIteration 1:  Log likelihood = -2120.0705  \nIteration 2:  Log likelihood = -2120.0694  \nIteration 3:  Log likelihood = -2120.0694  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(4)  =  69.03\nLog likelihood = -2120.0694                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |\n        yes  |   .3966145   .1041656     3.81   0.000     .1924536    .6007754\n     agercs1 |  -.0430389   .0160545    -2.68   0.007    -.0745051   -.0115727\n     agercs2 |  -.0000314    .000038    -0.82   0.410    -.0001059    .0000432\n     agercs3 |  -1.70e-07   .0000357    -0.00   0.996    -.0000701    .0000697\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |  -22.10362   2.190797   -10.09   0.000    -26.39751   -17.80974\n        _ns2 |   6.252487    1.18838     5.26   0.000     3.923304     8.58167\n        _ns3 |  -1.093169   .0583025   -18.75   0.000    -1.207439   -.9788977\n        _ns4 |  -.5425182   .0376756   -14.40   0.000    -.6163609   -.4686754\n        _ns5 |   -.376672   .0361107   -10.43   0.000    -.4474477   -.3058964\n       _cons |   .3065984    .606017     0.51   0.613    -.8811731     1.49437\n------------------------------------------------------------------------------\n\n. estimates store stpm3_rcsgen\nI have stored the knot locations as these will be needed for certain predictions.\nTo fit an identical model, but using extended function we can use @rcs(age, df(3)) within an stpm3 varlist.\n. stpm3 i.hormon @rcs(age, df(3)), scale(lncumhazard) df(5) \n\nIteration 0:  Log likelihood = -2120.3306  \nIteration 1:  Log likelihood = -2120.0705  \nIteration 2:  Log likelihood = -2120.0694  \nIteration 3:  Log likelihood = -2120.0694  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(4)  =  69.03\nLog likelihood = -2120.0694                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |\n        yes  |   .3966145   .1041656     3.81   0.000     .1924536    .6007754\n_rcs_f1_age1 |  -.0430389   .0160545    -2.68   0.007    -.0745051   -.0115727\n_rcs_f1_age2 |  -.0000314    .000038    -0.82   0.410    -.0001059    .0000432\n_rcs_f1_age3 |  -1.70e-07   .0000357    -0.00   0.996    -.0000701    .0000697\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |  -22.10362   2.190797   -10.09   0.000    -26.39751   -17.80974\n        _ns2 |   6.252487    1.18838     5.26   0.000     3.923304     8.58167\n        _ns3 |  -1.093169   .0583025   -18.75   0.000    -1.207439   -.9788977\n        _ns4 |  -.5425182   .0376756   -14.40   0.000    -.6163609   -.4686754\n        _ns5 |   -.376672   .0361107   -10.43   0.000    -.4474477   -.3058964\n       _cons |   .3065984    .606017     0.51   0.613    -.8811731     1.49437\n------------------------------------------------------------------------------\nExtended functions\n (1) @rcs(age, df(3))\nIf you compare the model coefficients and log-likelihoods you will see they are identical.\nFrom here on I will use natural splines - these will give the same predicted values as when using restricted cubic splines, but have some useful additional properties.\n. stpm3 i.hormon @ns(age, df(3)), scale(lncumhazard) df(5) \n\nIteration 0:  Log likelihood = -2120.3306  \nIteration 1:  Log likelihood = -2120.0705  \nIteration 2:  Log likelihood = -2120.0694  \nIteration 3:  Log likelihood = -2120.0694  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(4)  =  69.03\nLog likelihood = -2120.0694                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |\n        yes  |   .3966145   .1041656     3.81   0.000     .1924536    .6007754\n _ns_f1_age1 |  -1.769774   1.089136    -1.62   0.104    -3.904441    .3648924\n _ns_f1_age2 |  -1.233782   .4602279    -2.68   0.007    -2.135812   -.3317519\n _ns_f1_age3 |  -1.709216   .4899396    -3.49   0.000     -2.66948   -.7489521\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |  -22.10362   2.190797   -10.09   0.000    -26.39751   -17.80974\n        _ns2 |   6.252487    1.18838     5.26   0.000     3.923304     8.58167\n        _ns3 |  -1.093169   .0583025   -18.75   0.000    -1.207439   -.9788977\n        _ns4 |  -.5425182   .0376756   -14.40   0.000    -.6163609   -.4686754\n        _ns5 |   -.376672   .0361107   -10.43   0.000    -.4474477   -.3058964\n       _cons |  -.1364105   .2354592    -0.58   0.562     -.597902     .325081\n------------------------------------------------------------------------------\nExtended functions\n (1) @ns(age, df(3))\n\n. estimates store stpm3_ns\nThe coefficients for the spline variables are now different, but if you predict for a specified covariate pattern, the predictions will be identical."
  },
  {
    "objectID": "software/stpm3/extended_functions.html#include-non-linear-function-in-a-varlist",
    "href": "software/stpm3/extended_functions.html#include-non-linear-function-in-a-varlist",
    "title": "Extended Functions",
    "section": "",
    "text": "A new addition to stpm3 is the use of extended functions within a model varlist. This allows you to specify various spline, polynomials, fractional polynomials functions directly when specifying the model. This makes fitting the model slightly easier, but the main advantage is the ease at which you can get predictions from complex models.\nWe first load the Rotterdam 2 breast cancer data and then use stset to declare the survival time and event indicator.\n. use https://www.pclambert.net/data/rott2b, clear\n(Rotterdam breast cancer data (augmented with cause of death))\n\n. stset os, f(osi==1) scale(12) exit(time 60)\n\nSurvival-time data settings\n\n         Failure event: osi==1\nObserved time interval: (0, os]\n     Exit on or before: time 60\n     Time for analysis: time/12\n\n--------------------------------------------------------------------------\n      2,982  total observations\n          0  exclusions\n--------------------------------------------------------------------------\n      2,982  observations remaining, representing\n        753  failures in single-record/single-failure data\n 13,038.968  total analysis time at risk and under observation\n                                                At risk from t =         0\n                                     Earliest observed entry t =         0\n                                          Last observed exit t =         5\nIf you want to include a non-linear effect for a covariate in a model, the usual approach would be to generate some new derived variables and then include these in the model. For example, by generating a quadratic and cubic term or generating spline basis functions using mkspline or rcsgen.\nThe code below shows how to include non-linear effects using restricted cubic splines with rcsgen with 4 knots, which equates to 3 spline variables.\n. rcsgen age, gen(agercs) df(3)\nVariables agercs1 to agercs3 were created\n\n. global ageknots `r(knots)'\n\n. stpm3 i.hormon agercs1-agercs3, scale(lncumhazard) df(5) \n\nIteration 0:  Log likelihood = -2120.3306  \nIteration 1:  Log likelihood = -2120.0705  \nIteration 2:  Log likelihood = -2120.0694  \nIteration 3:  Log likelihood = -2120.0694  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(4)  =  69.03\nLog likelihood = -2120.0694                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |\n        yes  |   .3966145   .1041656     3.81   0.000     .1924536    .6007754\n     agercs1 |  -.0430389   .0160545    -2.68   0.007    -.0745051   -.0115727\n     agercs2 |  -.0000314    .000038    -0.82   0.410    -.0001059    .0000432\n     agercs3 |  -1.70e-07   .0000357    -0.00   0.996    -.0000701    .0000697\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |  -22.10362   2.190797   -10.09   0.000    -26.39751   -17.80974\n        _ns2 |   6.252487    1.18838     5.26   0.000     3.923304     8.58167\n        _ns3 |  -1.093169   .0583025   -18.75   0.000    -1.207439   -.9788977\n        _ns4 |  -.5425182   .0376756   -14.40   0.000    -.6163609   -.4686754\n        _ns5 |   -.376672   .0361107   -10.43   0.000    -.4474477   -.3058964\n       _cons |   .3065984    .606017     0.51   0.613    -.8811731     1.49437\n------------------------------------------------------------------------------\n\n. estimates store stpm3_rcsgen\nI have stored the knot locations as these will be needed for certain predictions.\nTo fit an identical model, but using extended function we can use @rcs(age, df(3)) within an stpm3 varlist.\n. stpm3 i.hormon @rcs(age, df(3)), scale(lncumhazard) df(5) \n\nIteration 0:  Log likelihood = -2120.3306  \nIteration 1:  Log likelihood = -2120.0705  \nIteration 2:  Log likelihood = -2120.0694  \nIteration 3:  Log likelihood = -2120.0694  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(4)  =  69.03\nLog likelihood = -2120.0694                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |\n        yes  |   .3966145   .1041656     3.81   0.000     .1924536    .6007754\n_rcs_f1_age1 |  -.0430389   .0160545    -2.68   0.007    -.0745051   -.0115727\n_rcs_f1_age2 |  -.0000314    .000038    -0.82   0.410    -.0001059    .0000432\n_rcs_f1_age3 |  -1.70e-07   .0000357    -0.00   0.996    -.0000701    .0000697\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |  -22.10362   2.190797   -10.09   0.000    -26.39751   -17.80974\n        _ns2 |   6.252487    1.18838     5.26   0.000     3.923304     8.58167\n        _ns3 |  -1.093169   .0583025   -18.75   0.000    -1.207439   -.9788977\n        _ns4 |  -.5425182   .0376756   -14.40   0.000    -.6163609   -.4686754\n        _ns5 |   -.376672   .0361107   -10.43   0.000    -.4474477   -.3058964\n       _cons |   .3065984    .606017     0.51   0.613    -.8811731     1.49437\n------------------------------------------------------------------------------\nExtended functions\n (1) @rcs(age, df(3))\nIf you compare the model coefficients and log-likelihoods you will see they are identical.\nFrom here on I will use natural splines - these will give the same predicted values as when using restricted cubic splines, but have some useful additional properties.\n. stpm3 i.hormon @ns(age, df(3)), scale(lncumhazard) df(5) \n\nIteration 0:  Log likelihood = -2120.3306  \nIteration 1:  Log likelihood = -2120.0705  \nIteration 2:  Log likelihood = -2120.0694  \nIteration 3:  Log likelihood = -2120.0694  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(4)  =  69.03\nLog likelihood = -2120.0694                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |\n        yes  |   .3966145   .1041656     3.81   0.000     .1924536    .6007754\n _ns_f1_age1 |  -1.769774   1.089136    -1.62   0.104    -3.904441    .3648924\n _ns_f1_age2 |  -1.233782   .4602279    -2.68   0.007    -2.135812   -.3317519\n _ns_f1_age3 |  -1.709216   .4899396    -3.49   0.000     -2.66948   -.7489521\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |  -22.10362   2.190797   -10.09   0.000    -26.39751   -17.80974\n        _ns2 |   6.252487    1.18838     5.26   0.000     3.923304     8.58167\n        _ns3 |  -1.093169   .0583025   -18.75   0.000    -1.207439   -.9788977\n        _ns4 |  -.5425182   .0376756   -14.40   0.000    -.6163609   -.4686754\n        _ns5 |   -.376672   .0361107   -10.43   0.000    -.4474477   -.3058964\n       _cons |  -.1364105   .2354592    -0.58   0.562     -.597902     .325081\n------------------------------------------------------------------------------\nExtended functions\n (1) @ns(age, df(3))\n\n. estimates store stpm3_ns\nThe coefficients for the spline variables are now different, but if you predict for a specified covariate pattern, the predictions will be identical."
  },
  {
    "objectID": "software/stpm3/extended_functions.html#predictions-with-extended-functions",
    "href": "software/stpm3/extended_functions.html#predictions-with-extended-functions",
    "title": "Extended Functions",
    "section": "Predictions with extended functions",
    "text": "Predictions with extended functions\nIf we generated the spline variables for age at diagnosis and then included these in the model, we would have to work out the values of the spline variables at the age at diagnosis of interest. For example, using the scalar option of rcsgen to predict survival for a 70 year old on hormonal treatment the code below can be used.\n. estimates restore stpm3_rcsgen\n(results stpm3_rcsgen are active now)\n\n. rcsgen, scalar(70) gen(c) knots(${ageknots})\nScalars c1 to c3 were created\n\n. predict S70a, survival ci                                             ///\n&gt;               at1(agercs1 `=c1' agercs2 `=c2' agercs3 `=c3' hormon 1) ///\n&gt;               timevar(0 5, step(0.1))                                 ///\n&gt;               frame(f1)\nPredictions are stored in frame - f1\nBy storing the knots and passing these to rcsgen combined with the scalar option, the values of the restricted cubic spline variables for a 70 year old are obtained. These can then be passed to the predict command.\nIf you use an extended function to fit an equivalent model this simplifies the predictions. For example predicting for a 70 year old woman on hormonal treatment we can use the following predict command.\n. estimates restore stpm3_ns\n(results stpm3_ns are active now)\n\n. predict S70b, survival ci          ///\n&gt;               at1(age 70 hormon 1) ///\n&gt;               frame(f1, merge)\nPredictions are stored in frame - f1\nThese predictions have been merged into frame f1, so we can compare the predictions.\n. frame f1: list in 1/21, noobs\n\n  +-----------------------------------------------------------------------------+\n  |  tt        S70a    S70a_lci    S70a_uci        S70b    S70b_lci    S70b_uci |\n  |-----------------------------------------------------------------------------|\n  |   0           1           1           1           1           1           1 |\n  |  .1   .99980531   .99901994   .99996134   .99980531   .99901994   .99996134 |\n  |  .2    .9990375   .99724993   .99966333    .9990375   .99724993   .99966333 |\n  |  .3   .99757461   .99484041   .99886071   .99757461   .99484041   .99886071 |\n  |  .4   .99537568   .99175595   .99740816   .99537568   .99175595   .99740816 |\n  |-----------------------------------------------------------------------------|\n  |  .5   .99243419   .98793852   .99525821   .99243419   .98793852   .99525821 |\n  |  .6   .98876195   .98333349   .99242911   .98876195   .98333349   .99242911 |\n  |  .7   .98438145   .97790805    .9889687   .98438145   .97790805    .9889687 |\n  |  .8   .97932165   .97166223   .98492686   .97932165   .97166223   .98492686 |\n  |  .9   .97361549   .96462911   .98034204   .97361549   .96462911   .98034204 |\n  |-----------------------------------------------------------------------------|\n  |   1   .96729824   .95686644   .97523978   .96729824   .95686644   .97523978 |\n  | 1.1   .96040644   .94844522     .969637   .96040644   .94844522     .969637 |\n  | 1.2   .95297712   .93943933   .96354746   .95297712   .93943933   .96354746 |\n  | 1.3   .94504732   .92991782   .95698631   .94504732   .92991782   .95698631 |\n  | 1.4   .93665358   .91993953    .9499734   .93665358   .91993953    .9499734 |\n  |-----------------------------------------------------------------------------|\n  | 1.5   .92783183   .90954967   .94253584   .92783183   .90954967   .94253584 |\n  | 1.6   .91861703   .89877754   .93470981   .91861703   .89877754   .93470981 |\n  | 1.7   .90904198   .88763238   .92654197   .90904198   .88763238   .92654197 |\n  | 1.8   .89913147   .87609834   .91808407   .89913147   .87609834   .91808407 |\n  | 1.9   .88890629   .86417228   .90937397   .88890629   .86417228   .90937397 |\n  |-----------------------------------------------------------------------------|\n  |   2   .87838596   .85187732   .90042978   .87838596   .85187732   .90042978 |\n  +-----------------------------------------------------------------------------+\nThe predictions are identical, but obtaining the predictions using extended functions was much easier. If the model includes interactions then I would say it is much, much easier and less prone to coding errors.\nThe current extended functions are\n\n\n\n@bs()\nB-splines\n\n\n@fn()\ngeneral transformation\n\n\n@fp()\nfractional polynomials\n\n\n@ns()\nnatural cubic splines\n\n\n@poly()\npolynomials\n\n\n@rcs()\nrestricted cubic splines\n\n\n\nSee the help file for options for each of these functions. For example, with the spline functions you specify knots positions or the degree for B-splines. For fractional polynomials there are scale and center options. For all extended functions, except fractional polynomials, it is possible to perform winsorising before the derived variables are generated using the winsor() option."
  },
  {
    "objectID": "software/stpm3/extended_functions.html#predictions-in-more-complex-models",
    "href": "software/stpm3/extended_functions.html#predictions-in-more-complex-models",
    "title": "Extended Functions",
    "section": "Predictions in more complex models",
    "text": "Predictions in more complex models\nIf the model get complex with numerous interactions and non-linear effects and interactions with time, the predictions remain simple.\nConsider the model below with main effects and an interaction between hormon and a natural spline function for age. stpm3 stores the details of the extended function and so when predictions are made the appropriate values of the derived variables can be obtained.\nIn the code below, I obtain predictions for 70 year old women with and without hormonal treatment.\n. stpm3 i.hormon##@ns(age, df(3)), scale(lncumhazard) df(5) \n\nIteration 0:  Log likelihood = -2117.3742  \nIteration 1:  Log likelihood = -2117.1157  \nIteration 2:  Log likelihood = -2117.1148  \nIteration 3:  Log likelihood = -2117.1148  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(7)  =  77.72\nLog likelihood = -2117.1148                             Prob &gt; chi2   = 0.0000\n\n--------------------------------------------------------------------------------------\n                     | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n---------------------+----------------------------------------------------------------\nxb                   |\n              hormon |\n                yes  |   1.295954   .5457098     2.37   0.018      .226382    2.365525\n         _ns_f1_age1 |  -1.006332    1.17959    -0.85   0.394    -3.318285    1.305621\n         _ns_f1_age2 |  -1.519938    .473222    -3.21   0.001    -2.447436   -.5924397\n         _ns_f1_age3 |  -1.322119   .5553445    -2.38   0.017    -2.410574   -.2336639\n                     |\nhormon#c._ns_f1_age1 |\n                yes  |  -6.312222    4.38403    -1.44   0.150    -14.90476    2.280319\n                     |\nhormon#c._ns_f1_age2 |\n                yes  |   3.192456   2.152641     1.48   0.138    -1.026642    7.411555\n                     |\nhormon#c._ns_f1_age3 |\n                yes  |  -2.436599   1.186322    -2.05   0.040    -4.761746   -.1114511\n---------------------+----------------------------------------------------------------\ntime                 |\n                _ns1 |  -22.10808   2.190478   -10.09   0.000    -26.40134   -17.81483\n                _ns2 |   6.252367   1.188247     5.26   0.000     3.923447    8.581288\n                _ns3 |  -1.094601   .0583504   -18.76   0.000    -1.208966   -.9802364\n                _ns4 |  -.5429931   .0377085   -14.40   0.000    -.6169004   -.4690859\n                _ns5 |  -.3770147   .0361414   -10.43   0.000    -.4478506   -.3061788\n               _cons |  -.2889299   .2699311    -1.07   0.284    -.8179851    .2401253\n--------------------------------------------------------------------------------------\nExtended functions\n (1) @ns(age, df(3))\n\n. \n. predict S70h0 S70h1, survival ci              ///\n&gt;                      at1(age 70 hormon 0)     ///\n&gt;                      at2(age 70 hormon 1)     ///\n&gt;                      timevar(0 5, step(0.1))  ///\n&gt;                      frame(f2)\nPredictions are stored in frame - f2\nThe nice thing here is that thehe predict command would be identical if there was no interaction.\nEven if there are time-dependent effects, the predict statement does not change. The model below adds an interaction for the time-dependent effects for hormon and age.\n. stpm3 i.hormon##@ns(age, df(3)),                 ///\n&gt;       tvc(i.hormon##@ns(age, df(2))) dftvc(2)    ///\n&gt;       scale(lncumhazard) df(5)                           \n\nIteration 0:  Log likelihood = -2116.6275  \nIteration 1:  Log likelihood = -2107.5573  \nIteration 2:  Log likelihood = -2103.0051  \nIteration 3:  Log likelihood = -2102.7883  \nIteration 4:  Log likelihood = -2102.7869  \nIteration 5:  Log likelihood = -2102.7869  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(7)  =  74.61\nLog likelihood = -2102.7869                             Prob &gt; chi2   = 0.0000\n\n-------------------------------------------------------------------------------------------------\n                                | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n--------------------------------+----------------------------------------------------------------\nxb                              |\n                         hormon |\n                           yes  |     1.2372    .559703     2.21   0.027     .1402021    2.334198\n                    _ns_f1_age1 |  -.9347474    1.18498    -0.79   0.430    -3.257267    1.387772\n                    _ns_f1_age2 |  -1.538365   .4738744    -3.25   0.001    -2.467142   -.6095881\n                    _ns_f1_age3 |  -1.308583   .5588214    -2.34   0.019    -2.403853   -.2133128\n                                |\n           hormon#c._ns_f1_age1 |\n                           yes  |  -5.991194   4.385156    -1.37   0.172    -14.58594    2.603554\n                                |\n           hormon#c._ns_f1_age2 |\n                           yes  |   3.188885   2.145601     1.49   0.137    -1.016415    7.394185\n                                |\n           hormon#c._ns_f1_age3 |\n                           yes  |  -2.318151   1.205093    -1.92   0.054    -4.680089    .0437866\n--------------------------------+----------------------------------------------------------------\ntime                            |\n                           _ns1 |  -19.18669   7.212764    -2.66   0.008    -33.32345   -5.049932\n                           _ns2 |   5.607982   3.176181     1.77   0.077    -.6172182    11.83318\n                           _ns3 |   -1.05599   .2202421    -4.79   0.000    -1.487656    -.624323\n                           _ns4 |  -.5553481   .1523431    -3.65   0.000    -.8539351   -.2567611\n                           _ns5 |  -.3960238   .1116303    -3.55   0.000    -.6148151   -.1772324\n                                |\n              hormon#c._ns_tvc1 |\n                           yes  |   4.903816   4.856667     1.01   0.313    -4.615075    14.42271\n                                |\n              hormon#c._ns_tvc2 |\n                           yes  |   .0799753   1.642765     0.05   0.961    -3.139786    3.299736\n                                |\n       c._ns_f2_age1#c._ns_tvc1 |  -29.15335   8.875221    -3.28   0.001    -46.54847   -11.75824\n                                |\n       c._ns_f2_age1#c._ns_tvc2 |   .6654049   1.325155     0.50   0.616     -1.93185     3.26266\n                                |\n       c._ns_f2_age2#c._ns_tvc1 |  -.8954604   11.34532    -0.08   0.937    -23.13188    21.34096\n                                |\n       c._ns_f2_age2#c._ns_tvc2 |   .3600924   2.127002     0.17   0.866    -3.808755     4.52894\n                                |\nhormon#c._ns_f2_age1#c._ns_tvc1 |\n                           yes  |  -117.1348   72.85753    -1.61   0.108    -259.9329    25.66332\n                                |\nhormon#c._ns_f2_age1#c._ns_tvc2 |\n                           yes  |  -.4836296   6.116531    -0.08   0.937    -12.47181    11.50455\n                                |\nhormon#c._ns_f2_age2#c._ns_tvc1 |\n                           yes  |  -5.302671   20.04585    -0.26   0.791    -44.59182    33.98648\n                                |\nhormon#c._ns_f2_age2#c._ns_tvc2 |\n                           yes  |  -1.511553   5.134032    -0.29   0.768    -11.57407    8.550965\n                                |\n                          _cons |  -.3015535   .2724136    -1.11   0.268    -.8354743    .2323674\n-------------------------------------------------------------------------------------------------\nExtended functions\n (1) @ns(age, df(3))\n (2) @ns(age, df(2))\n\n.       \n. predict S70h0 S70h1, survival ci                ///\n&gt;                      at1(age 70 hormon 0)       ///\n&gt;                      at2(age 70 hormon 1)       ///\n&gt;                      timevar(0 5, step(0.1))    ///\n&gt;                      frame(f3)\nPredictions are stored in frame - f3\nThe key point is that the predict command stays simple. Note that I use a different function for the time-dependent effect, so two @ns() functions at the end of the model output.\nFinally I will fit a model with a spline function that winsorises the variables before the spline basis functions are generated. This can improve model stability in the tails in complex models. I use B-splines rather than natural splines for the effect of age.\n. stpm3 i.hormon##@bs(age, df(3) degree(2) winsor(2 98)), ///\n&gt;       scale(lncumhazard) df(5)                           \n\nIteration 0:  Log likelihood = -2117.8269  \nIteration 1:  Log likelihood = -2117.5679  \nIteration 2:  Log likelihood = -2117.5669  \nIteration 3:  Log likelihood = -2117.5669  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(7)  =  75.27\nLog likelihood = -2117.5669                             Prob &gt; chi2   = 0.0000\n\n--------------------------------------------------------------------------------------\n                     | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n---------------------+----------------------------------------------------------------\nxb                   |\n              hormon |\n                yes  |  -.2013625   .8479376    -0.24   0.812     -1.86329    1.460565\n         _bs_f1_age1 |   -.789629   .2399149    -3.29   0.001    -1.259854   -.3194044\n         _bs_f1_age2 |  -.3251852   .1782746    -1.82   0.068     -.674597    .0242265\n         _bs_f1_age3 |   .2358417   .2106851     1.12   0.263    -.1770935     .648777\n                     |\nhormon#c._bs_f1_age1 |\n                yes  |    1.71135   1.096385     1.56   0.119    -.4375242    3.860225\n                     |\nhormon#c._bs_f1_age2 |\n                yes  |  -.2149046   .8373336    -0.26   0.797    -1.856048    1.426239\n                     |\nhormon#c._bs_f1_age3 |\n                yes  |   .9610499   .9192863     1.05   0.296    -.8407181    2.762818\n---------------------+----------------------------------------------------------------\ntime                 |\n                _ns1 |  -22.10814   2.191013   -10.09   0.000    -26.40245   -17.81384\n                _ns2 |   6.253144   1.188507     5.26   0.000     3.923714    8.582574\n                _ns3 |  -1.093972   .0583289   -18.76   0.000    -1.208295   -.9796495\n                _ns4 |  -.5428561   .0376962   -14.40   0.000    -.6167393   -.4689729\n                _ns5 |  -.3769876   .0361375   -10.43   0.000    -.4478158   -.3061593\n               _cons |  -.9075211   .1468767    -6.18   0.000    -1.195394   -.6196481\n--------------------------------------------------------------------------------------\nExtended functions\n (1) @bs(age, df(3) degree(2) winsor(2 98))\n\n.       \n. predict S70h0 S70h1, survival ci                 ///\n&gt;                      at1(age 70 hormon 0)        ///\n&gt;                      at2(age 70 hormon 1)        ///\n&gt;                      timevar(0 5, step(0.1))     ///\n&gt;                      frame(f4)\nPredictions are stored in frame - f4\nThe winsor(2 98) option replaces values less than the 2nd centile with the value at the 2nd centile and values greater than the 98th centile with the values at the 98th centile. There is a values suboption where you can directly specifying values for the cutoffs rather than centiles.\nAgain, the key point here is that the predict commands does not change."
  },
  {
    "objectID": "software/stpm3/contrasts.html",
    "href": "software/stpm3/contrasts.html",
    "title": "Contrasts",
    "section": "",
    "text": "If you have more than one at option then you can perform contrasts. For example, if you predict survival curves for more than one covariate pattern you can take differences or ratios of these predictions.\nThis is best shown through example. I first load the Rotterdam breast cancer data.\n. use https://www.pclambert.net/data/rott3, clear\n(Rotterdam breast cancer data (augmented with cause of death))\n\n. stset os, f(osi==1) scale(12) exit(time 60)\n\nSurvival-time data settings\n\n         Failure event: osi==1\nObserved time interval: (0, os]\n     Exit on or before: time 60\n     Time for analysis: time/12\n\n--------------------------------------------------------------------------\n      2,982  total observations\n          0  exclusions\n--------------------------------------------------------------------------\n      2,982  observations remaining, representing\n        753  failures in single-record/single-failure data\n 13,038.968  total analysis time at risk and under observation\n                                                At risk from t =         0\n                                     Earliest observed entry t =         0\n                                          Last observed exit t =         5\nI will fit a simple model including the effect of hormon and use a natural spline for age.\n. stpm3 i.hormon @ns(age, df(3)), scale(lncumhazard) df(5) \n\nIteration 0:  Log likelihood = -2120.3306  \nIteration 1:  Log likelihood = -2120.0705  \nIteration 2:  Log likelihood = -2120.0694  \nIteration 3:  Log likelihood = -2120.0694  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(4)  =  69.03\nLog likelihood = -2120.0694                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |\n        yes  |   .3966145   .1041656     3.81   0.000     .1924536    .6007754\n _ns_f1_age1 |  -1.769774   1.089136    -1.62   0.104    -3.904441    .3648924\n _ns_f1_age2 |  -1.233782   .4602279    -2.68   0.007    -2.135812   -.3317519\n _ns_f1_age3 |  -1.709216   .4899396    -3.49   0.000     -2.66948   -.7489521\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |  -22.10362   2.190797   -10.09   0.000    -26.39751   -17.80974\n        _ns2 |   6.252487    1.18838     5.26   0.000     3.923304     8.58167\n        _ns3 |  -1.093169   .0583025   -18.75   0.000    -1.207439   -.9788977\n        _ns4 |  -.5425182   .0376756   -14.40   0.000    -.6163609   -.4686754\n        _ns5 |   -.376672   .0361107   -10.43   0.000    -.4474477   -.3058964\n       _cons |  -.1364105   .2354592    -0.58   0.562     -.597902     .325081\n------------------------------------------------------------------------------\nExtended functions\n (1) @ns(age, df(3))\n\n. estimates store stpm3_ns\nI will now predict the survival function for a 70 year woman with and without hormonal treatment.\n. predict S70h0 S70h1, survival ci          ///\n&gt;               at1(age 70 hormon 0)        ///\n&gt;               at2(age 70 hormon 1)        ///\n&gt;               timevar(0 5, step(0.1))     ///\n&gt;               frame(f1)\nPredictions are stored in frame - f1\nThe predicted survival functions are plotted below.\n. frame f1 {\n.   twoway (line S70h0 S70h1 tt) ///\n&gt;          , xtitle(\"Years since surgery\") ///\n&gt;          ytitle(\"S(t)\")                  ///\n&gt;          legend(order(1 \"hormon=0\" 2 \"hormon=1\") ring(0) pos(1) cols(1))\n. }\n\nVisually we can see the difference in the lines which is over 10 percentage points at 5 years. We can calculate the difference using the contrast(difference) option. We can name the contrast variable using the contrastvar() option rather than rely on the default names.\n. predict S70h0 S70h1, survival ci          ///\n&gt;               at1(age 70 hormon 0)        ///\n&gt;               at2(age 70 hormon 1)        ///\n&gt;               contrast(difference)        ///\n&gt;               contrastvar(Sdiff)          ///\n&gt;               timevar(0 5, step(0.1))     ///\n&gt;               frame(f1, replace)\nPredictions are stored in frame - f1\nOnce the contrast is stored, it can be plotted together with a 95% confidence interval.\n. frame f1 {\n.   twoway (rarea Sdiff_lci Sdiff_uci tt, color(red%30)) ///\n&gt;          (line Sdiff tt, color(red))                   ///\n&gt;          , xtitle(\"Years since surgery\")               ///\n&gt;          ytitle(\"Difference in S(t)\")                  ///\n&gt;          ylabel(,format(%3.2f))                        ///\n&gt;          legend(off)\n. }\n\nBy default at1() is the reference, so the difference is at2() - at1(). The reference level can be changed using the atreference() option.\n. predict S70h0 S70h1, survival ci          ///\n&gt;               at1(age 70 hormon 0)        ///\n&gt;               at2(age 70 hormon 1)        ///\n&gt;               atreference(2)              ///\n&gt;               contrast(difference)        ///\n&gt;               contrastvar(Sdiff)          ///\n&gt;               timevar(0 5, step(0.1))     ///\n&gt;               frame(f1, replace)\nPredictions are stored in frame - f1\nOnce the contrast is stored, it can be plotted together with a 95% confidence interval.\n. frame f1 {\n.   twoway (rarea Sdiff_lci Sdiff_uci tt, color(red%30)) ///\n&gt;          (line Sdiff tt, color(red))                   ///\n&gt;          , xtitle(\"Years since surgery\")               ///\n&gt;          ytitle(\"Difference in S(t)\")                  ///\n&gt;          ylabel(,format(%3.2f))                        ///\n&gt;          legend(off)\n. }"
  },
  {
    "objectID": "software/stpm3/contrasts.html#multiple-at-options",
    "href": "software/stpm3/contrasts.html#multiple-at-options",
    "title": "Contrasts",
    "section": "",
    "text": "If you have more than one at option then you can perform contrasts. For example, if you predict survival curves for more than one covariate pattern you can take differences or ratios of these predictions.\nThis is best shown through example. I first load the Rotterdam breast cancer data.\n. use https://www.pclambert.net/data/rott3, clear\n(Rotterdam breast cancer data (augmented with cause of death))\n\n. stset os, f(osi==1) scale(12) exit(time 60)\n\nSurvival-time data settings\n\n         Failure event: osi==1\nObserved time interval: (0, os]\n     Exit on or before: time 60\n     Time for analysis: time/12\n\n--------------------------------------------------------------------------\n      2,982  total observations\n          0  exclusions\n--------------------------------------------------------------------------\n      2,982  observations remaining, representing\n        753  failures in single-record/single-failure data\n 13,038.968  total analysis time at risk and under observation\n                                                At risk from t =         0\n                                     Earliest observed entry t =         0\n                                          Last observed exit t =         5\nI will fit a simple model including the effect of hormon and use a natural spline for age.\n. stpm3 i.hormon @ns(age, df(3)), scale(lncumhazard) df(5) \n\nIteration 0:  Log likelihood = -2120.3306  \nIteration 1:  Log likelihood = -2120.0705  \nIteration 2:  Log likelihood = -2120.0694  \nIteration 3:  Log likelihood = -2120.0694  \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(4)  =  69.03\nLog likelihood = -2120.0694                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |\n        yes  |   .3966145   .1041656     3.81   0.000     .1924536    .6007754\n _ns_f1_age1 |  -1.769774   1.089136    -1.62   0.104    -3.904441    .3648924\n _ns_f1_age2 |  -1.233782   .4602279    -2.68   0.007    -2.135812   -.3317519\n _ns_f1_age3 |  -1.709216   .4899396    -3.49   0.000     -2.66948   -.7489521\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |  -22.10362   2.190797   -10.09   0.000    -26.39751   -17.80974\n        _ns2 |   6.252487    1.18838     5.26   0.000     3.923304     8.58167\n        _ns3 |  -1.093169   .0583025   -18.75   0.000    -1.207439   -.9788977\n        _ns4 |  -.5425182   .0376756   -14.40   0.000    -.6163609   -.4686754\n        _ns5 |   -.376672   .0361107   -10.43   0.000    -.4474477   -.3058964\n       _cons |  -.1364105   .2354592    -0.58   0.562     -.597902     .325081\n------------------------------------------------------------------------------\nExtended functions\n (1) @ns(age, df(3))\n\n. estimates store stpm3_ns\nI will now predict the survival function for a 70 year woman with and without hormonal treatment.\n. predict S70h0 S70h1, survival ci          ///\n&gt;               at1(age 70 hormon 0)        ///\n&gt;               at2(age 70 hormon 1)        ///\n&gt;               timevar(0 5, step(0.1))     ///\n&gt;               frame(f1)\nPredictions are stored in frame - f1\nThe predicted survival functions are plotted below.\n. frame f1 {\n.   twoway (line S70h0 S70h1 tt) ///\n&gt;          , xtitle(\"Years since surgery\") ///\n&gt;          ytitle(\"S(t)\")                  ///\n&gt;          legend(order(1 \"hormon=0\" 2 \"hormon=1\") ring(0) pos(1) cols(1))\n. }\n\nVisually we can see the difference in the lines which is over 10 percentage points at 5 years. We can calculate the difference using the contrast(difference) option. We can name the contrast variable using the contrastvar() option rather than rely on the default names.\n. predict S70h0 S70h1, survival ci          ///\n&gt;               at1(age 70 hormon 0)        ///\n&gt;               at2(age 70 hormon 1)        ///\n&gt;               contrast(difference)        ///\n&gt;               contrastvar(Sdiff)          ///\n&gt;               timevar(0 5, step(0.1))     ///\n&gt;               frame(f1, replace)\nPredictions are stored in frame - f1\nOnce the contrast is stored, it can be plotted together with a 95% confidence interval.\n. frame f1 {\n.   twoway (rarea Sdiff_lci Sdiff_uci tt, color(red%30)) ///\n&gt;          (line Sdiff tt, color(red))                   ///\n&gt;          , xtitle(\"Years since surgery\")               ///\n&gt;          ytitle(\"Difference in S(t)\")                  ///\n&gt;          ylabel(,format(%3.2f))                        ///\n&gt;          legend(off)\n. }\n\nBy default at1() is the reference, so the difference is at2() - at1(). The reference level can be changed using the atreference() option.\n. predict S70h0 S70h1, survival ci          ///\n&gt;               at1(age 70 hormon 0)        ///\n&gt;               at2(age 70 hormon 1)        ///\n&gt;               atreference(2)              ///\n&gt;               contrast(difference)        ///\n&gt;               contrastvar(Sdiff)          ///\n&gt;               timevar(0 5, step(0.1))     ///\n&gt;               frame(f1, replace)\nPredictions are stored in frame - f1\nOnce the contrast is stored, it can be plotted together with a 95% confidence interval.\n. frame f1 {\n.   twoway (rarea Sdiff_lci Sdiff_uci tt, color(red%30)) ///\n&gt;          (line Sdiff tt, color(red))                   ///\n&gt;          , xtitle(\"Years since surgery\")               ///\n&gt;          ytitle(\"Difference in S(t)\")                  ///\n&gt;          ylabel(,format(%3.2f))                        ///\n&gt;          legend(off)\n. }"
  },
  {
    "objectID": "software/stpm3/contrasts.html#more-than-2-at-options",
    "href": "software/stpm3/contrasts.html#more-than-2-at-options",
    "title": "Contrasts",
    "section": "More than 2 at options",
    "text": "More than 2 at options\nYou can have as many at options as you want. The following predicts survival at 10 year intervals between 40 and 90 years at diagnosis.\n. local j 1\n\n. foreach a of numlist  40(10)90 {\n  2.   local atlist `atlist' at`j'(age `a' hormon 0)\n  3.   local ++j\n  4. } \n\n. predict S*, survival ci              ///\n&gt;             `atlist'                 ///\n&gt;             timevar(0 5, step(0.1))  ///\n&gt;             frame(f2, replace)\nPredictions are stored in frame - f2\n. frame f2 {\n.   twoway (line S? tt, ) ///\n&gt;          , xtitle(\"Years since surgery\")                         ///\n&gt;          ytitle(\"S(t)\")                                          ///\n&gt;          ylabel(,format(%3.2f))                                  ///\n&gt;          legend(order(1 \"40\" 2 \"50\" 3 \"60\" 4 \"70\" 5 \"80\" 6 \"90\") ///\n&gt;                 ring(0) pos(7) cols(1))\n. }\n\nIf you want to make contrasts between the different ages then we need to make one of the at options the reference. Below I make the 2nd at option the reference, which is for 50 year olds (they have the best survival).\n. local atlist\n\n. local j 1\n\n. foreach a of numlist  40(10)90 {\n  2.   local atlist `atlist' at`j'(age `a' hormon 0)\n  3.   local ++j\n  4. } \n\n. predict S*, survival ci                 ///\n&gt;             `atlist'                    ///\n&gt;             contrast(difference)        ///\n&gt;             contrastvar(Sdiff*)         ///\n&gt;             atreference(2)              ///\n&gt;             timevar(0 5, step(0.1))     ///\n&gt;             frame(f2, replace)\nPredictions are stored in frame - f2\n. frame f2 {\n.   twoway (line Sdiff? tt, ) ///\n&gt;          , xtitle(\"Years since surgery\")                         ///\n&gt;          ytitle(\"S(t)\")                                          ///\n&gt;          ylabel(,format(%3.2f))                                  ///\n&gt;          title(\"Difference in survival compared to 50 year old\") ///\n&gt;          legend(order(1 \"40\" 2 \"60\" 3 \"70\" 4 \"80\" 5 \"90\")        ///\n&gt;                 ring(0) pos(7) cols(1))\n. }"
  },
  {
    "objectID": "software/stpm3/relative_survival_models.html",
    "href": "software/stpm3/relative_survival_models.html",
    "title": "Relative Survival Models",
    "section": "",
    "text": "This is just a draft at present"
  },
  {
    "objectID": "software/stpm3/relative_survival_models.html#relative-survivalexcess-mortality-models",
    "href": "software/stpm3/relative_survival_models.html#relative-survivalexcess-mortality-models",
    "title": "Relative Survival Models",
    "section": "Relative survival(excess mortality) models",
    "text": "Relative survival(excess mortality) models\nRelative survival(excess mortality) models are used to analyses population-based cancer survival data. As in stpm2 this is done through using the bhazard() option when fitting an stpm3 model.\nstpm3 has better predictions than stpm2 through the use of an expsurv() option.\nThis guide is really aimed at those who are familiar with relative survival models.\nThe code below loads the example colon cancer data set and merges in the expected mortality rates at the event/censoring times.\n. use \"https://pclambert.net/data/colon.dta\", clear\n(Colon carcinoma, diagnosed 1975-94, follow-up to 1995)\n\n. stset surv_mm,f(status=1,2) id(id) scale(12) exit(time 120.5)\n\nSurvival-time data settings\n\n           ID variable: id\n         Failure event: status==1 2\nObserved time interval: (surv_mm[_n-1], surv_mm]\n     Exit on or before: time 120.5\n     Time for analysis: time/12\n\n--------------------------------------------------------------------------\n     15,564  total observations\n          0  exclusions\n--------------------------------------------------------------------------\n     15,564  observations remaining, representing\n     15,564  subjects\n     10,459  failures in single-failure-per-subject data\n 51,685.667  total analysis time at risk and under observation\n                                                At risk from t =         0\n                                     Earliest observed entry t =         0\n                                          Last observed exit t =  10.04167\n\n. gen _age = floor(min(age+_t,99))\n\n. gen _year = floor(yydx +_t)\n\n. gen male = sex==1\n\n. merge m:1 _age _year sex using \"https://pclambert.net/data/popmort.dta\", keep(match master)\n\n    Result                      Number of obs\n    -----------------------------------------\n    Not matched                             0\n    Matched                            15,564  (_merge==3)\n    -----------------------------------------\nTo illusrate the prediction options I will fit a model with an interaction between age and sex for both main and time-dependent effects, where the effect of age is modelled using natural splines. I will also use winsoring at the 2nd and 98th centiles of age.\n. stpm3 i.male##@ns(age,df(3) winsor(2 98)), ///\n&gt;       tvc(i.male##@ns(age,df(3) winsor(2 98))) dftvc(2) ///\n&gt;       df(5) scale(lncumhazard)  bhazard(rate)\n\nIteration 0:  Log likelihood = -21354.047  \nIteration 1:  Log likelihood =  -20769.05  \nIteration 2:  Log likelihood = -20726.739  \nIteration 3:  Log likelihood = -20725.951  \nIteration 4:  Log likelihood = -20725.949  \nIteration 5:  Log likelihood = -20725.949  \n\n                                                        Number of obs = 15,564\n                                                        Wald chi2(7)  =  17.94\nLog likelihood = -20725.949                             Prob &gt; chi2   = 0.0123\n\n-----------------------------------------------------------------------------------------------\n                              | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n------------------------------+----------------------------------------------------------------\nxb                            |\n                       1.male |  -.3529372   .2438788    -1.45   0.148    -.8309309    .1250566\n                  _ns_f1_age1 |  -.9225446   .4701276    -1.96   0.050    -1.843978   -.0011114\n                  _ns_f1_age2 |   .2828585   .1945014     1.45   0.146    -.0983573    .6640743\n                  _ns_f1_age3 |  -.0417452   .2264952    -0.18   0.854    -.4856676    .4021771\n                              |\n           male#c._ns_f1_age1 |\n                           1  |   1.240154    .847648     1.46   0.143     -.421206    2.901513\n                              |\n           male#c._ns_f1_age2 |\n                           1  |   .0103073   .2858799     0.04   0.971     -.550007    .5706216\n                              |\n           male#c._ns_f1_age3 |\n                           1  |    .486169   .4344473     1.12   0.263    -.3653321     1.33767\n------------------------------+----------------------------------------------------------------\ntime                          |\n                         _ns1 |  -7.658599   .4600483   -16.65   0.000    -8.560277   -6.756921\n                         _ns2 |   2.685312   .1249449    21.49   0.000     2.440425    2.930199\n                         _ns3 |  -.2397703   .1295897    -1.85   0.064    -.4937614    .0142209\n                         _ns4 |   .0815264   .1095782     0.74   0.457    -.1332429    .2962956\n                         _ns5 |   .2678154   .0959583     2.79   0.005     .0797406    .4558901\n                              |\n              male#c._ns_tvc1 |\n                           1  |   .9938131   .4540786     2.19   0.029     .1038354    1.883791\n                              |\n              male#c._ns_tvc2 |\n                           1  |   1.111332   .5122449     2.17   0.030     .1073506    2.115314\n                              |\n     c._ns_f1_age1#c._ns_tvc1 |  -17.30983   2.373232    -7.29   0.000    -21.96128   -12.65838\n                              |\n     c._ns_f1_age1#c._ns_tvc2 |  -5.081748    1.12152    -4.53   0.000    -7.279888   -2.883609\n                              |\n     c._ns_f1_age2#c._ns_tvc1 |   3.098712   1.430068     2.17   0.030     .2958309    5.901593\n                              |\n     c._ns_f1_age2#c._ns_tvc2 |  -.3393347   .5099432    -0.67   0.506    -1.338805    .6601357\n                              |\n     c._ns_f1_age3#c._ns_tvc1 |  -3.389762    .565698    -5.99   0.000    -4.498509   -2.281014\n                              |\n     c._ns_f1_age3#c._ns_tvc2 |  -2.109922   .5190539    -4.06   0.000    -3.127249   -1.092595\n                              |\nmale#c._ns_f1_age1#c._ns_tvc1 |\n                           1  |   1.102057   3.237953     0.34   0.734    -5.244215    7.448329\n                              |\nmale#c._ns_f1_age1#c._ns_tvc2 |\n                           1  |  -2.844073   1.856685    -1.53   0.126    -6.483108    .7949625\n                              |\nmale#c._ns_f1_age2#c._ns_tvc1 |\n                           1  |  -2.353453   1.906681    -1.23   0.217     -6.09048    1.383573\n                              |\nmale#c._ns_f1_age2#c._ns_tvc2 |\n                           1  |  -.2610123   .7417512    -0.35   0.725    -1.714818    1.192793\n                              |\nmale#c._ns_f1_age3#c._ns_tvc1 |\n                           1  |  -.2141621   .9766446    -0.22   0.826     -2.12835    1.700026\n                              |\nmale#c._ns_f1_age3#c._ns_tvc2 |\n                           1  |  -2.073735    .944128    -2.20   0.028    -3.924192   -.2232782\n                              |\n                        _cons |  -.1063001   .1227919    -0.87   0.387    -.3469678    .1343676\n-----------------------------------------------------------------------------------------------\nExtended functions\n (1) @ns(age, df(3) winsor(2 98))\nThe use of bhazard(rate) makes this a relative survival model. This means that relative survival will be predicted when using the survival option of the predict command. Similarly, the excess mortality (hazard) rate will be predicted when uing the hazard option of the predict command.\nSome predictions require use of the expsurv() option to merge in the expected mortality rates.\nThe various predictions will be for males and females aged 70.\n\nRelative Survival\nFirst I will predict relative survival and the difference between males and females.\n. predict Rm Rf, at1(male 1 age 70)         ///\n&gt;                at2(male 0 age 70)         ///\n&gt;                surv  ci                   ///\n&gt;                timevar(0 10, step(0.1))   ///\n&gt;                contrast(difference)       ///\n&gt;                contrastvar(Rdiff)         ///\n&gt;                frame(f1)\nPredictions are stored in frame - f1\nThe predictions are saved in frame f1, and can be plotted.\n. frame f1 {\n.   line Rm Rf tt, name(RS, replace)    ///\n&gt;        xtitle(\"Time since diagnosis\") ///\n&gt;        ytitle(R(t))\n.   twoway (rarea Rdiff_lci Rdiff_uci tt, color(red%30)) ///\n&gt;          (line Rdiff tt, color(red)),                 ///\n&gt;          xtitle(\"Time since diagnosis\")                ///\n&gt;          ytitle(Difference in R(t))                    /// \n&gt;          legend(off)                                   ///\n&gt;          name(RSdiff, replace)\n. }\n \n\n\nAll-cause survival\nUsing the expsurv() option allows all-cause survival to be calculated.\n\\[\nS(t|X) = S^*(t|X)R(t|X)\n\\]\n. predict Sm Sf, surv  ci ///\n&gt;                at1(male 1 age 70)   ///\n&gt;                at2(male 0 age 70)   ///\n&gt;                contrast(difference) ///\n&gt;                contrastvar(Sdiff)   ///               \n&gt;                frame(f1, merge)     ///\n&gt;                expsurv(using(\"https://www.pclambert.net/data/popmort\") ///  Popmort file\n&gt;                        agediag(70)        ///  Age at diagnosis in the dataset\n&gt;                        datediag(1990-1-1) ///  Date of diagnosis in the dataset\n&gt;                        pmother(sex)       ///  Other variables included in the popmort file\n&gt;                        pmrate(rate)       ///  Rate variable in the popmort file  \n&gt;                        at1(sex 1)         ///\n&gt;                        at2(sex 2)         ///\n&gt;                        )                \nPredictions are stored in frame - f1\n\n. frame f1 {\n.   line Sm Sf tt, name(S, replace)     ///\n&gt;        xtitle(\"Time since diagnosis\") ///\n&gt;        ytitle(S(t))\n.   twoway (rarea Sdiff_lci Sdiff_uci tt, color(red%30)) ///\n&gt;          (line Sdiff tt, color(red)),                 ///\n&gt;          xtitle(\"Time since diagnosis\")                ///\n&gt;          ytitle(Difference in S(t))                    /// \n&gt;          legend(off)                                   ///\n&gt;          name(Sdiff, replace)  \n. }\n \n\n\nMarginal all-cause hazard\nThis is the same as above, but replace the survival' option withhazard`.\n. predict hm hf, hazard  ci ///\n&gt;                at1(male 1 age 70)   ///\n&gt;                at2(male 0 age 70)   ///\n&gt;                contrast(difference) ///\n&gt;                contrastvar(hdiff)   ///               \n&gt;                frame(f1, merge)     ///\n&gt;                expsurv(using(\"https://www.pclambert.net/data/popmort\") ///  Popmort file\n&gt;                        agediag(70)        ///  Age at diagnosis in the dataset\n&gt;                        datediag(1990-1-1) ///  Date of diagnosis in the dataset\n&gt;                        pmother(sex)       ///  Other variables included in the popmort file\n&gt;                        pmrate(rate)       ///  Rate variable in the popmort file  \n&gt;                        at1(sex 1)         ///\n&gt;                        at2(sex 2)         ///\n&gt;                        )                \nPredictions are stored in frame - f1\n\n. frame f1 {\n.   line hm hf tt, name(S, replace)     ///\n&gt;        xtitle(\"Time since diagnosis\") ///\n&gt;        ytitle(h(t))\n.   twoway (rarea hdiff_lci hdiff_uci tt, color(red%30)) ///\n&gt;          (line hdiff tt, color(red)),                 ///\n&gt;          xtitle(\"Time since diagnosis\")                ///\n&gt;          ytitle(Difference in h(t))                    /// \n&gt;          legend(off)                                   ///\n&gt;          name(Sdiff, replace)    \n.   line hm hf tt, name(h, replace)\n.   line hdiff* tt, name(hdiff, replace)\n. }\n \n\n\nCrude Probabilities\nThe default is to only give crude probability of death due to cancer. You can use the expvar option to option crude probablities of death due to other causes.\n. predict Ccm Ccf, crudeprob ci ///\n&gt;                at1(male 1 age 70)  ///\n&gt;                at2(male 0 age 70)  ///\n&gt;                contrast(difference) ///\n&gt;                contrastvar(Ccdiff)   ///               \n&gt;                frame(f1, merge)    ///\n&gt;                expsurv(using(\"https://www.pclambert.net/data/popmort\") ///  Popmort file\n&gt;                        agediag(70)      ///  Age at diagnosis in the dataset\n&gt;                        datediag(1990-1-1)      ///  Date of diagnosis in the dataset\n&gt;                        pmother(sex)       ///  Other variables included in the popmort file\n&gt;                        pmrate(rate)       ///  Rate variable in the popmort file  \n&gt;                        at1(sex 1)         ///\n&gt;                        at2(sex 2)         ///\n&gt;                        expvar(Com Cof) ///\n&gt;                        )                      \nPredictions are stored in frame - f1\n\n\nLife expectancy\nThis is obtained through separate extrpolation of the relative and expected survival.\n. gen t80 = 80 in 1\n(15,563 missing values generated)\n\n. predict LEf LEm, rmst ci            ///\n&gt;                at1(male 1 age 70)   ///\n&gt;                at2(male 0 age 70)   ///\n&gt;                contrast(difference) ///\n&gt;                contrastvar(Ccdiff)  /// \n&gt;                timevar(t80)         ///\n&gt;                frame(f2)            ///\n&gt;                expsurv(using(\"https://www.pclambert.net/data/popmort\") ///  Popmort file\n&gt;                        agediag(70)      ///  Age at diagnosis in the dataset\n&gt;                        datediag(1990-1-1)      ///  Date of diagnosis in the dataset\n&gt;                        pmother(sex)       ///  Other variables included in the popmort file\n&gt;                        pmrate(rate)       ///  Rate variable in the popmort file  \n&gt;                        pmmaxyear(2000)    ///\n&gt;                        at1(sex 1)         ///\n&gt;                        at2(sex 2)         ///\n&gt;                        expvar(ELEm ELEf) ///\n&gt;                        )\nPredictions are stored in frame - f2\n\n.                        \n. frame f2: {\n.   list LEf* ELEf                       \n\n     +---------------------------------------------+\n     |      LEf     LEf_lci    LEf_uci        ELEf |\n     |---------------------------------------------|\n  1. | 5.652845   5.3925576   5.925696   14.658482 |\n     +---------------------------------------------+\n.   list LEm* ELEm                       \n\n     +-----------------------------------------------+\n     |       LEm     LEm_lci     LEm_uci        ELEm |\n     |-----------------------------------------------|\n  1. | 7.0845352   6.8264632   7.3523635   11.328775 |\n     +-----------------------------------------------+\n. }                \n\n\nLife expectancy over a range of ages\nThe code below creates a frame with a range of ages to predict life expectencty.\n. capture frame drop ageLEL\n\n. frame create ageLEL\n\n. frame ageLEL {\n.   range age 50 99 50\nNumber of observations (_N) was 0, now 50.\n.   gen male = .\n(50 missing values generated)\n.   gen sex = .\n(50 missing values generated)\n.   predict LEm LEf, rmst ci                ///\n&gt;                  at1(male 1, obsvalues)   ///\n&gt;                  at2(male 0, obsvalues)   ///\n&gt;                  timevar(80)              ///\n&gt;                  merge                    ///\n&gt;                  expsurv(using(\"https://www.pclambert.net/data/popmort\") ///  Popmort file\n&gt;                          agediag(age)       ///  Age at diagnosis in the dataset\n&gt;                          datediag(1990-1-1) ///  Date of diagnosis in the dataset\n&gt;                          pmother(sex)       ///  Other variables included in the popmort file\n&gt;                          pmrate(rate)       ///  Rate variable in the popmort file  \n&gt;                          pmmaxyear(2000)    ///\n&gt;                          at1(sex 1)         ///\n&gt;                          at2(sex 2)         ///\n&gt;                          expvar(ELEm ELEf)  ///\n&gt;                          )\n.  gen LELm = ELEm - LEm                         \n.  gen LELf = ELEf - LEf                         \n. }\nThe predicted values can now be plotted.\n. frame ageLEL {\n.   line LEf ELEf LELf age,                             ///\n&gt;        xtitle(\"Age at diagnosis\")                 ///\n&gt;        ytitle(Life Expectency)                        ///\n&gt;        legend(order(1 \"Life Expectancy\"               ///\n&gt;                     2 \"Expected Life Expectancy\"      ///\n&gt;                     3 \"Reduction in Life Expectancy\")  ///\n&gt;               ring(0) cols(1) pos(1))\n. }"
  },
  {
    "objectID": "software/stpm3/contrasts.html#more-than-two-at-options",
    "href": "software/stpm3/contrasts.html#more-than-two-at-options",
    "title": "Contrasts",
    "section": "More than two at options",
    "text": "More than two at options\nYou can have as many at options as you want. The following predicts survival at 10 year intervals between 40 and 90 years at diagnosis.\n. local j 1\n\n. foreach a of numlist  40(10)90 {\n  2.   local atlist `atlist' at`j'(age `a' hormon 0)\n  3.   local ++j\n  4. } \n\n. predict S*, survival ci              ///\n&gt;             `atlist'                 ///\n&gt;             timevar(0 5, step(0.1))  ///\n&gt;             frame(f2, replace)\nPredictions are stored in frame - f2\n. frame f2 {\n.   twoway (line S? tt, ) ///\n&gt;          , xtitle(\"Years since surgery\")                         ///\n&gt;          ytitle(\"S(t)\")                                          ///\n&gt;          ylabel(,format(%3.2f))                                  ///\n&gt;          legend(order(1 \"40\" 2 \"50\" 3 \"60\" 4 \"70\" 5 \"80\" 6 \"90\") ///\n&gt;                 ring(0) pos(7) cols(1))\n. }\n\nIf you want to make contrasts between the different ages then we need to make one of the at options the reference. Below I make the 2nd at option the reference, which is for 50 year olds (they have the best survival).\n. local atlist\n\n. local j 1\n\n. foreach a of numlist  40(10)90 {\n  2.   local atlist `atlist' at`j'(age `a' hormon 0)\n  3.   local ++j\n  4. } \n\n. predict S*, survival ci                 ///\n&gt;             `atlist'                    ///\n&gt;             contrast(difference)        ///\n&gt;             contrastvar(Sdiff*)         ///\n&gt;             atreference(2)              ///\n&gt;             timevar(0 5, step(0.1))     ///\n&gt;             frame(f2, replace)\nPredictions are stored in frame - f2\n. frame f2 {\n.   twoway (line Sdiff? tt, ) ///\n&gt;          , xtitle(\"Years since surgery\")                         ///\n&gt;          ytitle(\"S(t)\")                                          ///\n&gt;          ylabel(,format(%3.2f))                                  ///\n&gt;          title(\"Difference in survival compared to 50 year old\") ///\n&gt;          legend(order(1 \"40\" 2 \"60\" 3 \"70\" 4 \"80\" 5 \"90\")        ///\n&gt;                 ring(0) pos(7) cols(1))\n. }"
  },
  {
    "objectID": "software/stpm3/standsurv.html",
    "href": "software/stpm3/standsurv.html",
    "title": "Standardization",
    "section": "",
    "text": "I will not go into details of standsurv here. There are various tutorials here.\nThere main advantage of using stpm3 rather than stpm2 with standsurv is the support for factor variables. I will ilustrate this with an example.\nThe code below loads the example colon cancer data set.\n. use \"https://pclambert.net/data/colon.dta\", clear\n(Colon carcinoma, diagnosed 1975-94, follow-up to 1995)\n\n. stset surv_mm,f(status=1,2) id(id) scale(12) exit(time 120.5)\n\nSurvival-time data settings\n\n           ID variable: id\n         Failure event: status==1 2\nObserved time interval: (surv_mm[_n-1], surv_mm]\n     Exit on or before: time 120.5\n     Time for analysis: time/12\n\n--------------------------------------------------------------------------\n     15,564  total observations\n          0  exclusions\n--------------------------------------------------------------------------\n     15,564  observations remaining, representing\n     15,564  subjects\n     10,459  failures in single-failure-per-subject data\n 51,685.667  total analysis time at risk and under observation\n                                                At risk from t =         0\n                                     Earliest observed entry t =         0\n                                          Last observed exit t =  10.04167\n\n. gen male = sex==1\nTo illust rate the prediction options I will fit a model with an interaction between age and sex for both main and time-dependent effects, where the effect of age is modelled using natural splines.\n. stpm3 i.male##@ns(age,df(3)),                 ///\n&gt;       tvc(i.male##@ns(age,df(3))) dftvc(2)    ///\n&gt;       df(5) scale(lncumhazard)\n\nIteration 0:  Log likelihood = -26496.501  \nIteration 1:  Log likelihood = -26041.128  \nIteration 2:  Log likelihood = -26005.402  \nIteration 3:  Log likelihood = -26004.879  \nIteration 4:  Log likelihood = -26004.877  \n\n                                                       Number of obs =  15,564\n                                                       Wald chi2(7)  = 1029.65\nLog likelihood = -26004.877                            Prob &gt; chi2   =  0.0000\n\n-----------------------------------------------------------------------------------------------\n                              | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n------------------------------+----------------------------------------------------------------\nxb                            |\n                       1.male |  -.2413054   .2648957    -0.91   0.362    -.7604915    .2778806\n                  _ns_f1_age1 |  -6.206267   .9371474    -6.62   0.000    -8.043042   -4.369492\n                  _ns_f1_age2 |  -.4202365   .4447267    -0.94   0.345    -1.291885    .4514119\n                  _ns_f1_age3 |  -1.728845   .2531885    -6.83   0.000    -2.225086   -1.232605\n                              |\n           male#c._ns_f1_age1 |\n                           1  |   .6846415   1.445986     0.47   0.636     -2.14944    3.518723\n                              |\n           male#c._ns_f1_age2 |\n                           1  |   .2790083   .6314231     0.44   0.659    -.9585582    1.516575\n                              |\n           male#c._ns_f1_age3 |\n                           1  |   .6956873   .4554633     1.53   0.127    -.1970044    1.588379\n------------------------------+----------------------------------------------------------------\ntime                          |\n                         _ns1 |  -10.15155   .8167647   -12.43   0.000    -11.75238   -8.550724\n                         _ns2 |   2.443526   .2234638    10.93   0.000     2.005545    2.881507\n                         _ns3 |  -1.284021   .1792894    -7.16   0.000    -1.635421   -.9326197\n                         _ns4 |  -.8369727   .1507723    -5.55   0.000    -1.132481   -.5414644\n                         _ns5 |  -.6772495   .1283478    -5.28   0.000    -.9288065   -.4256924\n                              |\n              male#c._ns_tvc1 |\n                           1  |   .4080991   .7632087     0.53   0.593    -1.087763    1.903961\n                              |\n              male#c._ns_tvc2 |\n                           1  |   1.358488   .6838173     1.99   0.047     .0182309    2.698745\n                              |\n     c._ns_f1_age1#c._ns_tvc1 |  -19.04827   6.611939    -2.88   0.004    -32.00744   -6.089109\n                              |\n     c._ns_f1_age1#c._ns_tvc2 |   2.555644   2.733908     0.93   0.350    -2.802717    7.914004\n                              |\n     c._ns_f1_age2#c._ns_tvc1 |   3.701198   3.555068     1.04   0.298    -3.266608      10.669\n                              |\n     c._ns_f1_age2#c._ns_tvc2 |  -.0607414   1.341542    -0.05   0.964    -2.690115    2.568632\n                              |\n     c._ns_f1_age3#c._ns_tvc1 |  -2.033876   .8956267    -2.27   0.023    -3.789272     -.27848\n                              |\n     c._ns_f1_age3#c._ns_tvc2 |  -.9184194    .694715    -1.32   0.186    -2.280036     .443197\n                              |\nmale#c._ns_f1_age1#c._ns_tvc1 |\n                           1  |   7.104149   8.667078     0.82   0.412    -9.883011    24.09131\n                              |\nmale#c._ns_f1_age1#c._ns_tvc2 |\n                           1  |  -2.530205   3.925255    -0.64   0.519    -10.22356    5.163153\n                              |\nmale#c._ns_f1_age2#c._ns_tvc1 |\n                           1  |  -4.308112   4.611764    -0.93   0.350      -13.347    4.730778\n                              |\nmale#c._ns_f1_age2#c._ns_tvc2 |\n                           1  |  -1.033032   1.804592    -0.57   0.567    -4.569967    2.503903\n                              |\nmale#c._ns_f1_age3#c._ns_tvc1 |\n                           1  |   .0752104   1.472709     0.05   0.959    -2.811246    2.961666\n                              |\nmale#c._ns_f1_age3#c._ns_tvc2 |\n                           1  |  -2.959448   1.198582    -2.47   0.014    -5.308625   -.6102702\n                              |\n                        _cons |   1.835955   .1428585    12.85   0.000     1.555958    2.115953\n-----------------------------------------------------------------------------------------------\nExtended functions\n (1) @ns(age, df(3))\nTo obtain the marginal survival for males and females which is standardized over the combined covariate distribution (just age in this case) we can use standsurv.\n. range tt 0 10 101\n(15,463 missing values generated)\n\n. standsurv, at1(male 1) at2(male 0)    ///\n&gt;            atvar(Sm Sf)               ///\n&gt;            survival ci                ///\n&gt;            timevar(tt)                ///\n&gt;            contrast(difference)       ///\n&gt;            contrastvar(Sdiff)\nIf this was an stpm2 model then the spline variables would need to be calculated and then the interactions with age formed and this information passed to standsurv. To demonstrate the advantages of using stpm3 with factor variables and extended functions I will now fit the same model without using them.\n. gensplines age, gen(agens) df(3) type(ns)\n\n. forvalues i = 1/3 {\n  2.   gen m_agens`i' = agens`i' * male\n  3. }\n\n. stpm3 male agens1 agens2 agens3 m_agens1 m_agens2 m_agens3,                 ///\n&gt;       tvc(male agens1 agens2 agens3 m_agens1 m_agens2 m_agens3) dftvc(2)    ///\n&gt;       df(5) scale(lncumhazard)\n\nIteration 0:  Log likelihood = -26496.501  \nIteration 1:  Log likelihood = -26041.128  \nIteration 2:  Log likelihood = -26005.402  \nIteration 3:  Log likelihood = -26004.879  \nIteration 4:  Log likelihood = -26004.877  \n\n                                                       Number of obs =  15,564\n                                                       Wald chi2(7)  = 1029.65\nLog likelihood = -26004.877                            Prob &gt; chi2   =  0.0000\n\n---------------------------------------------------------------------------------------\n                      | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n----------------------+----------------------------------------------------------------\nxb                    |\n                 male |  -.2413055   .2648957    -0.91   0.362    -.7604915    .2778806\n               agens1 |  -6.206267   .9371474    -6.62   0.000    -8.043042   -4.369492\n               agens2 |  -.4202365   .4447267    -0.94   0.345    -1.291885    .4514119\n               agens3 |  -1.728845   .2531885    -6.83   0.000    -2.225086   -1.232605\n             m_agens1 |   .6846414   1.445986     0.47   0.636     -2.14944    3.518723\n             m_agens2 |   .2790084   .6314231     0.44   0.659    -.9585582    1.516575\n             m_agens3 |   .6956873   .4554633     1.53   0.127    -.1970043    1.588379\n----------------------+----------------------------------------------------------------\ntime                  |\n                 _ns1 |  -10.15155   .8167647   -12.43   0.000    -11.75238   -8.550724\n                 _ns2 |   2.443526   .2234638    10.93   0.000     2.005545    2.881507\n                 _ns3 |  -1.284021   .1792894    -7.16   0.000    -1.635421   -.9326197\n                 _ns4 |  -.8369727   .1507723    -5.55   0.000    -1.132481   -.5414644\n                 _ns5 |  -.6772495   .1283478    -5.28   0.000    -.9288065   -.4256924\n                      |\n    c.male#c._ns_tvc1 |   .4080993   .7632087     0.53   0.593    -1.087762    1.903961\n                      |\n    c.male#c._ns_tvc2 |   1.358488   .6838173     1.99   0.047     .0182309    2.698745\n                      |\n  c.agens1#c._ns_tvc1 |  -19.04827   6.611939    -2.88   0.004    -32.00743   -6.089108\n                      |\n  c.agens1#c._ns_tvc2 |   2.555644   2.733907     0.93   0.350    -2.802716    7.914004\n                      |\n  c.agens2#c._ns_tvc1 |   3.701197   3.555068     1.04   0.298    -3.266608      10.669\n                      |\n  c.agens2#c._ns_tvc2 |  -.0607416   1.341542    -0.05   0.964    -2.690115    2.568632\n                      |\n  c.agens3#c._ns_tvc1 |  -2.033876   .8956267    -2.27   0.023    -3.789272   -.2784798\n                      |\n  c.agens3#c._ns_tvc2 |  -.9184194    .694715    -1.32   0.186    -2.280036     .443197\n                      |\nc.m_agens1#c._ns_tvc1 |   7.104146   8.667078     0.82   0.412    -9.883014    24.09131\n                      |\nc.m_agens1#c._ns_tvc2 |  -2.530206   3.925255    -0.64   0.519    -10.22356    5.163152\n                      |\nc.m_agens2#c._ns_tvc1 |  -4.308111   4.611764    -0.93   0.350      -13.347     4.73078\n                      |\nc.m_agens2#c._ns_tvc2 |  -1.033032   1.804592    -0.57   0.567    -4.569967    2.503903\n                      |\nc.m_agens3#c._ns_tvc1 |     .07521   1.472709     0.05   0.959    -2.811246    2.961666\n                      |\nc.m_agens3#c._ns_tvc2 |  -2.959448   1.198582    -2.47   0.014    -5.308625   -.6102702\n                      |\n                _cons |   1.835955   .1428585    12.85   0.000     1.555958    2.115953\n---------------------------------------------------------------------------------------\nIt is necessary to incorporate the interactions into the standsurv call.\n. standsurv, at1(male 1 m_agens1 = agens1 m_agens2 = agens2 m_agens3 = agens3) ///\n&gt;            at2(male 0 m_agens1 0 m_agens2 0 m_agens3 0)                      ///\n&gt;            atvar(Sm2 Sf2)                                                    ///\n&gt;            survival ci                                                       ///\n&gt;            timevar(tt)                                                       ///\n&gt;            contrast(difference)                                              ///\n&gt;            contrastvar(Sdiff2)\nThe standardized estimates are identical, but using factor variables combined with extended functions makes life much easier.\n. list Sm Sm2 Sf Sf2 Sdiff Sdiff2 in 1/21\n\n     +-----------------------------------------------------------------------+\n     |        Sm         Sm2          Sf         Sf2       Sdiff      Sdiff2 |\n     |-----------------------------------------------------------------------|\n  1. |         1           1           1           1           0           0 |\n  2. | .92529544   .92529544   .94122671   .94122671   .01593127   .01593127 |\n  3. | .84974543   .84974543   .87134444   .87134444   .02159901   .02159901 |\n  4. | .80156899   .80156899   .82310037   .82310037   .02153138   .02153138 |\n  5. | .76810437   .76810437   .78841692   .78841692   .02031255   .02031255 |\n     |-----------------------------------------------------------------------|\n  6. | .74118184   .74118184   .76034216   .76034216   .01916031   .01916031 |\n  7. |   .717297     .717297   .73561505   .73561505   .01831805   .01831805 |\n  8. | .69488055   .69488055   .71268416   .71268416   .01780361   .01780361 |\n  9. | .67372368   .67372368   .69128998   .69128998    .0175663    .0175663 |\n 10. | .65393972   .65393972   .67149719   .67149719   .01755747   .01755747 |\n     |-----------------------------------------------------------------------|\n 11. | .63554177   .63554177   .65327781   .65327781   .01773603   .01773603 |\n 12. | .61848439   .61848439   .63654471   .63654471   .01806032   .01806032 |\n 13. | .60270014   .60270014   .62119777   .62119777   .01849764   .01849764 |\n 14. | .58811278   .58811278    .6071354    .6071354   .01902262   .01902262 |\n 15. | .57464333   .57464333   .59425862   .59425862   .01961529   .01961529 |\n     |-----------------------------------------------------------------------|\n 16. | .56218743   .56218743   .58244778   .58244778   .02026035   .02026035 |\n 17. | .55060497   .55060497    .5715515    .5715515   .02094653   .02094653 |\n 18. | .53977597   .53977597   .56144057   .56144057   .02166461   .02166461 |\n 19. | .52960174   .52960174   .55200868   .55200868   .02240694   .02240694 |\n 20. | .52000042   .52000042    .5431676    .5431676   .02316718   .02316718 |\n     |-----------------------------------------------------------------------|\n 21. |  .5109036    .5109036    .5348437    .5348437    .0239401    .0239401 |\n     +-----------------------------------------------------------------------+\nThe marginal estimates can be plotted\n. line Sm Sf tt, xtitle(\"Time since diagnosis\")      ///\n&gt;                ytitle(S(t))                        ///\n&gt;                legend(order(1 \"Males\" 2 \"Females\") ///\n&gt;                       ring(0) pos(1) cols(1))      ///\n&gt;                name(Marginal, replace)\n\n. twoway (rarea Sdiff_lci Sdiff_uci tt, color(red%30)) ///\n&gt;          (line Sdiff tt, color(red)),                ///\n&gt;          xtitle(\"Time since diagnosis\")              ///\n&gt;          ytitle(Difference in marginal survival)     /// \n&gt;          legend(off)                                 ///\n&gt;          name(Marginal_diff, replace)"
  },
  {
    "objectID": "software/stpm3/standsurv.html#using-standsurv",
    "href": "software/stpm3/standsurv.html#using-standsurv",
    "title": "Standardization",
    "section": "",
    "text": "I will not go into details of standsurv here. There are various tutorials here.\nThere main advantage of using stpm3 rather than stpm2 with standsurv is the support for factor variables. I will ilustrate this with an example.\nThe code below loads the example colon cancer data set.\n. use \"https://pclambert.net/data/colon.dta\", clear\n(Colon carcinoma, diagnosed 1975-94, follow-up to 1995)\n\n. stset surv_mm,f(status=1,2) id(id) scale(12) exit(time 120.5)\n\nSurvival-time data settings\n\n           ID variable: id\n         Failure event: status==1 2\nObserved time interval: (surv_mm[_n-1], surv_mm]\n     Exit on or before: time 120.5\n     Time for analysis: time/12\n\n--------------------------------------------------------------------------\n     15,564  total observations\n          0  exclusions\n--------------------------------------------------------------------------\n     15,564  observations remaining, representing\n     15,564  subjects\n     10,459  failures in single-failure-per-subject data\n 51,685.667  total analysis time at risk and under observation\n                                                At risk from t =         0\n                                     Earliest observed entry t =         0\n                                          Last observed exit t =  10.04167\n\n. gen male = sex==1\nTo illust rate the prediction options I will fit a model with an interaction between age and sex for both main and time-dependent effects, where the effect of age is modelled using natural splines.\n. stpm3 i.male##@ns(age,df(3)),                 ///\n&gt;       tvc(i.male##@ns(age,df(3))) dftvc(2)    ///\n&gt;       df(5) scale(lncumhazard)\n\nIteration 0:  Log likelihood = -26496.501  \nIteration 1:  Log likelihood = -26041.128  \nIteration 2:  Log likelihood = -26005.402  \nIteration 3:  Log likelihood = -26004.879  \nIteration 4:  Log likelihood = -26004.877  \n\n                                                       Number of obs =  15,564\n                                                       Wald chi2(7)  = 1029.65\nLog likelihood = -26004.877                            Prob &gt; chi2   =  0.0000\n\n-----------------------------------------------------------------------------------------------\n                              | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n------------------------------+----------------------------------------------------------------\nxb                            |\n                       1.male |  -.2413054   .2648957    -0.91   0.362    -.7604915    .2778806\n                  _ns_f1_age1 |  -6.206267   .9371474    -6.62   0.000    -8.043042   -4.369492\n                  _ns_f1_age2 |  -.4202365   .4447267    -0.94   0.345    -1.291885    .4514119\n                  _ns_f1_age3 |  -1.728845   .2531885    -6.83   0.000    -2.225086   -1.232605\n                              |\n           male#c._ns_f1_age1 |\n                           1  |   .6846415   1.445986     0.47   0.636     -2.14944    3.518723\n                              |\n           male#c._ns_f1_age2 |\n                           1  |   .2790083   .6314231     0.44   0.659    -.9585582    1.516575\n                              |\n           male#c._ns_f1_age3 |\n                           1  |   .6956873   .4554633     1.53   0.127    -.1970044    1.588379\n------------------------------+----------------------------------------------------------------\ntime                          |\n                         _ns1 |  -10.15155   .8167647   -12.43   0.000    -11.75238   -8.550724\n                         _ns2 |   2.443526   .2234638    10.93   0.000     2.005545    2.881507\n                         _ns3 |  -1.284021   .1792894    -7.16   0.000    -1.635421   -.9326197\n                         _ns4 |  -.8369727   .1507723    -5.55   0.000    -1.132481   -.5414644\n                         _ns5 |  -.6772495   .1283478    -5.28   0.000    -.9288065   -.4256924\n                              |\n              male#c._ns_tvc1 |\n                           1  |   .4080991   .7632087     0.53   0.593    -1.087763    1.903961\n                              |\n              male#c._ns_tvc2 |\n                           1  |   1.358488   .6838173     1.99   0.047     .0182309    2.698745\n                              |\n     c._ns_f1_age1#c._ns_tvc1 |  -19.04827   6.611939    -2.88   0.004    -32.00744   -6.089109\n                              |\n     c._ns_f1_age1#c._ns_tvc2 |   2.555644   2.733908     0.93   0.350    -2.802717    7.914004\n                              |\n     c._ns_f1_age2#c._ns_tvc1 |   3.701198   3.555068     1.04   0.298    -3.266608      10.669\n                              |\n     c._ns_f1_age2#c._ns_tvc2 |  -.0607414   1.341542    -0.05   0.964    -2.690115    2.568632\n                              |\n     c._ns_f1_age3#c._ns_tvc1 |  -2.033876   .8956267    -2.27   0.023    -3.789272     -.27848\n                              |\n     c._ns_f1_age3#c._ns_tvc2 |  -.9184194    .694715    -1.32   0.186    -2.280036     .443197\n                              |\nmale#c._ns_f1_age1#c._ns_tvc1 |\n                           1  |   7.104149   8.667078     0.82   0.412    -9.883011    24.09131\n                              |\nmale#c._ns_f1_age1#c._ns_tvc2 |\n                           1  |  -2.530205   3.925255    -0.64   0.519    -10.22356    5.163153\n                              |\nmale#c._ns_f1_age2#c._ns_tvc1 |\n                           1  |  -4.308112   4.611764    -0.93   0.350      -13.347    4.730778\n                              |\nmale#c._ns_f1_age2#c._ns_tvc2 |\n                           1  |  -1.033032   1.804592    -0.57   0.567    -4.569967    2.503903\n                              |\nmale#c._ns_f1_age3#c._ns_tvc1 |\n                           1  |   .0752104   1.472709     0.05   0.959    -2.811246    2.961666\n                              |\nmale#c._ns_f1_age3#c._ns_tvc2 |\n                           1  |  -2.959448   1.198582    -2.47   0.014    -5.308625   -.6102702\n                              |\n                        _cons |   1.835955   .1428585    12.85   0.000     1.555958    2.115953\n-----------------------------------------------------------------------------------------------\nExtended functions\n (1) @ns(age, df(3))\nTo obtain the marginal survival for males and females which is standardized over the combined covariate distribution (just age in this case) we can use standsurv.\n. range tt 0 10 101\n(15,463 missing values generated)\n\n. standsurv, at1(male 1) at2(male 0)    ///\n&gt;            atvar(Sm Sf)               ///\n&gt;            survival ci                ///\n&gt;            timevar(tt)                ///\n&gt;            contrast(difference)       ///\n&gt;            contrastvar(Sdiff)\nIf this was an stpm2 model then the spline variables would need to be calculated and then the interactions with age formed and this information passed to standsurv. To demonstrate the advantages of using stpm3 with factor variables and extended functions I will now fit the same model without using them.\n. gensplines age, gen(agens) df(3) type(ns)\n\n. forvalues i = 1/3 {\n  2.   gen m_agens`i' = agens`i' * male\n  3. }\n\n. stpm3 male agens1 agens2 agens3 m_agens1 m_agens2 m_agens3,                 ///\n&gt;       tvc(male agens1 agens2 agens3 m_agens1 m_agens2 m_agens3) dftvc(2)    ///\n&gt;       df(5) scale(lncumhazard)\n\nIteration 0:  Log likelihood = -26496.501  \nIteration 1:  Log likelihood = -26041.128  \nIteration 2:  Log likelihood = -26005.402  \nIteration 3:  Log likelihood = -26004.879  \nIteration 4:  Log likelihood = -26004.877  \n\n                                                       Number of obs =  15,564\n                                                       Wald chi2(7)  = 1029.65\nLog likelihood = -26004.877                            Prob &gt; chi2   =  0.0000\n\n---------------------------------------------------------------------------------------\n                      | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]\n----------------------+----------------------------------------------------------------\nxb                    |\n                 male |  -.2413055   .2648957    -0.91   0.362    -.7604915    .2778806\n               agens1 |  -6.206267   .9371474    -6.62   0.000    -8.043042   -4.369492\n               agens2 |  -.4202365   .4447267    -0.94   0.345    -1.291885    .4514119\n               agens3 |  -1.728845   .2531885    -6.83   0.000    -2.225086   -1.232605\n             m_agens1 |   .6846414   1.445986     0.47   0.636     -2.14944    3.518723\n             m_agens2 |   .2790084   .6314231     0.44   0.659    -.9585582    1.516575\n             m_agens3 |   .6956873   .4554633     1.53   0.127    -.1970043    1.588379\n----------------------+----------------------------------------------------------------\ntime                  |\n                 _ns1 |  -10.15155   .8167647   -12.43   0.000    -11.75238   -8.550724\n                 _ns2 |   2.443526   .2234638    10.93   0.000     2.005545    2.881507\n                 _ns3 |  -1.284021   .1792894    -7.16   0.000    -1.635421   -.9326197\n                 _ns4 |  -.8369727   .1507723    -5.55   0.000    -1.132481   -.5414644\n                 _ns5 |  -.6772495   .1283478    -5.28   0.000    -.9288065   -.4256924\n                      |\n    c.male#c._ns_tvc1 |   .4080993   .7632087     0.53   0.593    -1.087762    1.903961\n                      |\n    c.male#c._ns_tvc2 |   1.358488   .6838173     1.99   0.047     .0182309    2.698745\n                      |\n  c.agens1#c._ns_tvc1 |  -19.04827   6.611939    -2.88   0.004    -32.00743   -6.089108\n                      |\n  c.agens1#c._ns_tvc2 |   2.555644   2.733907     0.93   0.350    -2.802716    7.914004\n                      |\n  c.agens2#c._ns_tvc1 |   3.701197   3.555068     1.04   0.298    -3.266608      10.669\n                      |\n  c.agens2#c._ns_tvc2 |  -.0607416   1.341542    -0.05   0.964    -2.690115    2.568632\n                      |\n  c.agens3#c._ns_tvc1 |  -2.033876   .8956267    -2.27   0.023    -3.789272   -.2784798\n                      |\n  c.agens3#c._ns_tvc2 |  -.9184194    .694715    -1.32   0.186    -2.280036     .443197\n                      |\nc.m_agens1#c._ns_tvc1 |   7.104146   8.667078     0.82   0.412    -9.883014    24.09131\n                      |\nc.m_agens1#c._ns_tvc2 |  -2.530206   3.925255    -0.64   0.519    -10.22356    5.163152\n                      |\nc.m_agens2#c._ns_tvc1 |  -4.308111   4.611764    -0.93   0.350      -13.347     4.73078\n                      |\nc.m_agens2#c._ns_tvc2 |  -1.033032   1.804592    -0.57   0.567    -4.569967    2.503903\n                      |\nc.m_agens3#c._ns_tvc1 |     .07521   1.472709     0.05   0.959    -2.811246    2.961666\n                      |\nc.m_agens3#c._ns_tvc2 |  -2.959448   1.198582    -2.47   0.014    -5.308625   -.6102702\n                      |\n                _cons |   1.835955   .1428585    12.85   0.000     1.555958    2.115953\n---------------------------------------------------------------------------------------\nIt is necessary to incorporate the interactions into the standsurv call.\n. standsurv, at1(male 1 m_agens1 = agens1 m_agens2 = agens2 m_agens3 = agens3) ///\n&gt;            at2(male 0 m_agens1 0 m_agens2 0 m_agens3 0)                      ///\n&gt;            atvar(Sm2 Sf2)                                                    ///\n&gt;            survival ci                                                       ///\n&gt;            timevar(tt)                                                       ///\n&gt;            contrast(difference)                                              ///\n&gt;            contrastvar(Sdiff2)\nThe standardized estimates are identical, but using factor variables combined with extended functions makes life much easier.\n. list Sm Sm2 Sf Sf2 Sdiff Sdiff2 in 1/21\n\n     +-----------------------------------------------------------------------+\n     |        Sm         Sm2          Sf         Sf2       Sdiff      Sdiff2 |\n     |-----------------------------------------------------------------------|\n  1. |         1           1           1           1           0           0 |\n  2. | .92529544   .92529544   .94122671   .94122671   .01593127   .01593127 |\n  3. | .84974543   .84974543   .87134444   .87134444   .02159901   .02159901 |\n  4. | .80156899   .80156899   .82310037   .82310037   .02153138   .02153138 |\n  5. | .76810437   .76810437   .78841692   .78841692   .02031255   .02031255 |\n     |-----------------------------------------------------------------------|\n  6. | .74118184   .74118184   .76034216   .76034216   .01916031   .01916031 |\n  7. |   .717297     .717297   .73561505   .73561505   .01831805   .01831805 |\n  8. | .69488055   .69488055   .71268416   .71268416   .01780361   .01780361 |\n  9. | .67372368   .67372368   .69128998   .69128998    .0175663    .0175663 |\n 10. | .65393972   .65393972   .67149719   .67149719   .01755747   .01755747 |\n     |-----------------------------------------------------------------------|\n 11. | .63554177   .63554177   .65327781   .65327781   .01773603   .01773603 |\n 12. | .61848439   .61848439   .63654471   .63654471   .01806032   .01806032 |\n 13. | .60270014   .60270014   .62119777   .62119777   .01849764   .01849764 |\n 14. | .58811278   .58811278    .6071354    .6071354   .01902262   .01902262 |\n 15. | .57464333   .57464333   .59425862   .59425862   .01961529   .01961529 |\n     |-----------------------------------------------------------------------|\n 16. | .56218743   .56218743   .58244778   .58244778   .02026035   .02026035 |\n 17. | .55060497   .55060497    .5715515    .5715515   .02094653   .02094653 |\n 18. | .53977597   .53977597   .56144057   .56144057   .02166461   .02166461 |\n 19. | .52960174   .52960174   .55200868   .55200868   .02240694   .02240694 |\n 20. | .52000042   .52000042    .5431676    .5431676   .02316718   .02316718 |\n     |-----------------------------------------------------------------------|\n 21. |  .5109036    .5109036    .5348437    .5348437    .0239401    .0239401 |\n     +-----------------------------------------------------------------------+\nThe marginal estimates can be plotted\n. line Sm Sf tt, xtitle(\"Time since diagnosis\")      ///\n&gt;                ytitle(S(t))                        ///\n&gt;                legend(order(1 \"Males\" 2 \"Females\") ///\n&gt;                       ring(0) pos(1) cols(1))      ///\n&gt;                name(Marginal, replace)\n\n. twoway (rarea Sdiff_lci Sdiff_uci tt, color(red%30)) ///\n&gt;          (line Sdiff tt, color(red)),                ///\n&gt;          xtitle(\"Time since diagnosis\")              ///\n&gt;          ytitle(Difference in marginal survival)     /// \n&gt;          legend(off)                                 ///\n&gt;          name(Marginal_diff, replace)"
  },
  {
    "objectID": "software/standsurv.html",
    "href": "software/standsurv.html",
    "title": "standsurv",
    "section": "",
    "text": "The standsurv command estimates standardized survival curves and related measures. It also allows various contrasts between the standardized functions. It is a post-estimation command and can be used after fitting a wide range of survival models. These include streg models (except generalized gamma), stpm2 models, stpm3models and strcs models.\nNote that I previously developed stpm2_standsurv, which only works with stpm2 models, but standsurv superceeds that. You can do the same things with standsurv and much, much more.\nSo some of the examples are the same as stpm2_standsurv.\nYou can install standsurv within Stata using"
  },
  {
    "objectID": "software/standsurv.html#using-standsurv",
    "href": "software/standsurv.html#using-standsurv",
    "title": "standsurv",
    "section": "Using standsurv",
    "text": "Using standsurv\n\nStandard Survival Models\n\nStandardized survival functions and contrasts.\nCentiles of the standardized survival function.\nRestricted mean survival using standardized survival functions.\nThe hazard function of the standardized survival curve.\nEstimating attributable fractions in cohort studies\nSome comments on why I am not so keen on stteffects\nWhy just not use margins?\n\n\n\nCompeting Risk Models\n\nStandardized cause-specific cumulative incidence functions.\nOther useful standardized measures in competing risks\n\n\n\nRelative/Net Survival Models\n\nStandardized Relative Survival.\n\nExternal age-standardization\nLoss in Expectation of Life\nStandardized Crude Probabilities of death."
  },
  {
    "objectID": "software/standsurv.html#releases",
    "href": "software/standsurv.html#releases",
    "title": "standsurv",
    "section": "Releases",
    "text": "Releases\nSee standsurv_releases.txt"
  },
  {
    "objectID": "software/standsurv/standardized_survival.html",
    "href": "software/standsurv/standardized_survival.html",
    "title": "Standardized survival functions using standsurv",
    "section": "",
    "text": "When we are performing data exploration on survival data we usually start with plotting Kaplan-Meier curves. In clinical trials with a survival outcome, one would nearly always expect to see a Kaplan-Meier curve plotted. They are simple to interpret (though there can be confusion when there are competing risks).\nIn observational studies, we expect that there will be confounding and we would usually adjust for these confounders in a Cox model. If you have read my other tutorials then you will know that I prefer fitting parametric models, but the choice is that not that important if all you want is an adjusted hazard ratio and that you are (i) happy with the proportional hazards assumption, (ii) believe you have included all relevant counfounders and (iii) made sensible modelling assumptions (non-linear effect, interactions etc).\nGiven we are happy with the model, an adjusted hazard ratio is reported. This is fine, but hazard ratios are more difficult to interpret and there are further problems when using hazard ratios as causal effects (Hernan 2010, Aaalen et al. 2015). Risks are much easier to interpret than rates and so quantifying the difference on the survival scale can be desirable.\nSome statistical software implements something called “adjusted” survival curves, but it is not always clear what this means. For example, in Stata stcurve gives survival curves where certain covariates can be given specific values, but those not specified are given as mean values. Thus it gives a prediction for an individual who happens to have the mean values of each covariate. This is a prediction for an individual and may not reflect the average in the population. A more appropriate way is to average over the survival curves. For example, if we have 1000 individuals in our study we can predict a survival curve for each individual and then take the average of these 1000 curves. This is essentially what standsurv does."
  },
  {
    "objectID": "software/standsurv/standardized_survival.html#background",
    "href": "software/standsurv/standardized_survival.html#background",
    "title": "Standardized survival functions using standsurv",
    "section": "",
    "text": "When we are performing data exploration on survival data we usually start with plotting Kaplan-Meier curves. In clinical trials with a survival outcome, one would nearly always expect to see a Kaplan-Meier curve plotted. They are simple to interpret (though there can be confusion when there are competing risks).\nIn observational studies, we expect that there will be confounding and we would usually adjust for these confounders in a Cox model. If you have read my other tutorials then you will know that I prefer fitting parametric models, but the choice is that not that important if all you want is an adjusted hazard ratio and that you are (i) happy with the proportional hazards assumption, (ii) believe you have included all relevant counfounders and (iii) made sensible modelling assumptions (non-linear effect, interactions etc).\nGiven we are happy with the model, an adjusted hazard ratio is reported. This is fine, but hazard ratios are more difficult to interpret and there are further problems when using hazard ratios as causal effects (Hernan 2010, Aaalen et al. 2015). Risks are much easier to interpret than rates and so quantifying the difference on the survival scale can be desirable.\nSome statistical software implements something called “adjusted” survival curves, but it is not always clear what this means. For example, in Stata stcurve gives survival curves where certain covariates can be given specific values, but those not specified are given as mean values. Thus it gives a prediction for an individual who happens to have the mean values of each covariate. This is a prediction for an individual and may not reflect the average in the population. A more appropriate way is to average over the survival curves. For example, if we have 1000 individuals in our study we can predict a survival curve for each individual and then take the average of these 1000 curves. This is essentially what standsurv does."
  },
  {
    "objectID": "software/standsurv/standardized_survival.html#example",
    "href": "software/standsurv/standardized_survival.html#example",
    "title": "Standardized survival functions using standsurv",
    "section": "Example",
    "text": "Example\nI use the Rotterdam breast cancer data and use all cause survival as the outcome. I restrict follow-up to 10 years after diagnosis using the option exit(time 10).\n. use https://www.pclambert.net/data/rott3, clear\n(Rotterdam breast cancer data (augmented with cause of death))\n\n. stset os, f(osi==1) scale(12) exit(time 120) \n\nSurvival-time data settings\n\n         Failure event: osi==1\nObserved time interval: (0, os]\n     Exit on or before: time 120\n     Time for analysis: time/12\n\n--------------------------------------------------------------------------\n      2,982  total observations\n          0  exclusions\n--------------------------------------------------------------------------\n      2,982  observations remaining, representing\n      1,171  failures in single-record/single-failure data\n 20,002.424  total analysis time at risk and under observation\n                                                At risk from t =         0\n                                     Earliest observed entry t =         0\n                                          Last observed exit t =        10\nThe scale(12) option converts the times recorded in months to years.\nI will explore differences between women who received hormonal treatment and those who did not. This is our exposure, but as this is observational study we know that any association we see may be due to confounding. But.. it is always good to start with a Kaplan-Meier plot\n. sts graph, by(hormon) risktable ///\n&gt;         legend(order(1 \"No hormonal treatment\" 2 \"Hormonal treatment\") ring(0) cols(1) pos(1)) ///\n&gt;         ylabel(0(0.2)1,angle(h) format(%3.1f)) ///\n&gt;     ytitle(\"S(t)\") xtitle(\"Time since surgery\") \n\n         Failure _d: osi==1\n   Analysis time _t: os/12\n  Exit on or before: time 120\n\nThis plot shows that those receiving hormal treatment had worse survival. If we fit a proportional hazards model with hormon as the only covariate we get the following,\n. stpm3 i.hormon, df(4) scale(lncumhazard) eform nolog    \n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(1)  =  25.19\nLog likelihood = -2930.4853                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             |     exp(b)   Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |\n        yes  |   1.540779   .1326967     5.02   0.000     1.301464    1.824099\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |  -25.45166   1.863924   -13.65   0.000    -29.10488   -21.79844\n        _ns2 |   8.063828   .9957355     8.10   0.000     6.112222    10.01543\n        _ns3 |   -.997684   .0432372   -23.07   0.000    -1.082427   -.9129407\n        _ns4 |  -.6392856   .0466345   -13.71   0.000    -.7306874   -.5478837\n       _cons |  -.5692268    .033194   -17.15   0.000    -.6342858   -.5041679\n------------------------------------------------------------------------------\nNote: Estimates are transformed only in the first equation.\nThe hazard ratio indicates that there is a 54% higher mortality rate in those receiving hormonal therapy.\nAs this is an observational study we should not stop there and conclude that hormonal therapy is bad for you. We do not know if there are differences between women taking or not taking the hormonal therapy. If those who took teh treatment tended to be older and have more severe disease then we do not have a fair comparison.\nIn fact a simple tabulation shows this to be the case,\n. tabstat age nodes, by(hormon)\n\nSummary statistics: Mean\nGroup variable: hormon (Hormonal therapy)\n\n  hormon |       age     nodes\n---------+--------------------\n      no |  54.09762  2.326523\n     yes |  62.54867  5.719764\n---------+--------------------\n   Total |  55.05835  2.712274\n------------------------------\nThose who received the hormonal therapy tended to be older and have more lymph node involvment. Thus, even if hormonal treatment did not have any effect on survival, we would expect to see a difference in such a simplistic analysis due to the type of people who receieved the treatment.\nSo, we now adjust for some covariates. To simplify things, I will assume proportional hazards and include the covariates age, nodes and progesterone receptor. Previous analyses of this data have found that transformation of the nodes variable (exp(-0.12*nodes)) and the progesterone variable (log(pr + 1)) model the non-linear effects of these variables fairly well and so I will use these transformed variables. The model is fitted below.\n. stpm3 i.hormon age enodes pr_1, scale(lncumhazard) df(4) eform nolog\n\n                                                        Number of obs =  2,982\n                                                        Wald chi2(4)  = 619.62\nLog likelihood = -2668.4925                             Prob &gt; chi2   = 0.0000\n\n------------------------------------------------------------------------------\n             |     exp(b)   Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n      hormon |\n        yes  |   .7906432   .0715077    -2.60   0.009       .66221    .9439854\n         age |   1.013244   .0024119     5.53   0.000     1.008528    1.017983\n      enodes |   .1132534   .0110135   -22.40   0.000     .0935998    .1370337\n        pr_1 |   .9064855   .0119282    -7.46   0.000     .8834055    .9301685\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |  -25.90082   1.871965   -13.84   0.000     -29.5698   -22.23184\n        _ns2 |   7.980587   1.003724     7.95   0.000     6.013324    9.947851\n        _ns3 |  -1.091126   .0461407   -23.65   0.000     -1.18156   -1.000691\n        _ns4 |    -.70103   .0504635   -13.89   0.000    -.7999366   -.6021234\n       _cons |    .801967    .161537     4.96   0.000     .4853603    1.118574\n------------------------------------------------------------------------------\nNote: Estimates are transformed only in the first equation.\nThings have now changed, the adjusted hazard ratio for hormon is 0.79 (95% CI 0.66 to 0.94) indicating a benficial effect. There is strong confounding here as we have gone from a significant harmful effect to a significant beneficial effect when adjusting for age, number of positive lymph nodes and progesterone receptor.\nWe could stop here, but would the fun be in that. Instead we will try to understand what this hazard ratio means in terms of survival. First I will replicate what stcurve does and then obtain the standardized survival functions.\nThe code below obtains the mean of the covariates age, enodes and pr_1 and puts these into a macro which can then be passed to the at options of stpm3’s predict command when predicting survival.\n. foreach var in age enodes pr_1 {\n  2.         summ `var', meanonly\n  3.         local atopt `atopt' `var' `r(mean)'\n  4. }\n\n. predict s0_covave s1_covave, surv ci timevar(0 10, step(0.1)) ///\n&gt;                              frame(f1, replace)               ///\n&gt;                              at1(hormon 0 `atopt')            ///\n&gt;                              at2(hormon 1 `atopt')\nPredictions are stored in frame - f1\nI will then plot these curves\n. frame f1 {\n.   twoway (line s0_covave tt, sort)                                        ///\n&gt;          (line s1_covave tt, sort)                                        ///\n&gt;          , legend(order(1 \"No hormonal treatment\" 2 \"Hormonal treatment\") ///\n&gt;                     ring(0) cols(1) pos(1))                               ///\n&gt;          ylabel(0(0.2)1,angle(h) format(%3.1f))                           ///\n&gt;          ytitle(\"S(t)\")                                                   ///\n&gt;          xtitle(\"Years since surgery\")\n. }\n\nThese are the survival functions for two “average” women (i.e. who had the average values of each covariate) with one receiving hormonal treatment and the other not receiving it. We can see that for such women the difference is in the way we expect, given the hazard ratio, with those on hormonal treatment having better survival. If I had categorial covariates then interpretation is awkward. For example, if we modelled sex (not appropriate for this data) then the prediction would be for someone who was part male and part female as we would be taking the average of a binary variable."
  },
  {
    "objectID": "software/standsurv/standardized_survival.html#standardized-survival-curves",
    "href": "software/standsurv/standardized_survival.html#standardized-survival-curves",
    "title": "Standardized survival functions using standsurv",
    "section": "Standardized survival curves",
    "text": "Standardized survival curves\nWe want to calculate the expected survival under two counterfactuals. One where everyone has hormonal treatment and one where everybody does not take it. See (Sjölander 2016) for a nice description of these issues and implementation in an R package, stdreg. We also want contrasts of these standardized curves, for example a difference in standardized survival curves.\n\\[\nE\\left(S(t | X=1,Z\\right) - E\\left(S(t | X=0,Z\\right)\n\\]\nIn the above, \\(X\\) is the exposure of interest and \\(Z\\) are the confounders. We are interested in the expectation over the distribution of \\(Z\\), with the key point being this distribution is forced to be the same for \\(X=0\\) and \\(X=1\\). If our model is sufficent for confounding control then the above formula gives an average causal effect.\nTo estimate the difference in the standardized curves we need to generate the two standardized survival curves. In each of these we predict as many survival curves as there are observations in the data set and then take the average of these curves. The only difference is that in one we make everyone be exposed (hormon=1) and in the other we make everybody be unexposed (hormon=0).\n\\[\\frac{1}{N}\\sum_{i=1}^{N}S(t|\\mbox{hormon=1},\\mbox{age}_i,\\mbox{enodes}_i,\\mbox{pr\\_1}_i) - \\frac{1}{N}\\sum_{i=1}^{N}S(t|\\mbox{hormon=0},\\mbox{age}_i,\\mbox{enodes}_i,\\mbox{pr\\_1}_i)\\]\nThere are 2982 observation in the dataset (and in the model). Thus for each of the two standardized curves we need to predict 2982 survival curves and then take the average of these curves. We can make some computational efficiency savings by only estimating the survival curves a small number of time points. This could be a single time point, e.g. the survival at 5 years, or over a range. We often want to plot survival curves and about 50-100 time points is usually sufficient for plotting purposes.\nTo do all this (and more) we use the standsurv command. I will run the command and the explain the syntax.\n. range tt 0 10 101\n(2,881 missing values generated)\n\n. standsurv S0 S1, surv timevar(tt) ci                     ///\n&gt;                  frame(f2, replace)                      ///\n&gt;                  at1(hormon 0) at2(hormon 1)             ///\n&gt;                  contrast(difference) contrastvar(Sdiff)\nEach of the at() options creates a standardized survival curve. Here a covariate (or covariates) can be set to take specific values. Any covariates not specified keep their observed values. Thus we are just implementing the equation above. The timevar() option gives the name of the variable that gives the survival times in which to evaluate the survival function. I have defined a variable tt above to be 101 rows ranging from 0 to 10, i.e. in steps of 0.1 years. The ci option requests that confidence intervals be calculated. Standard errors are either obtained using the delta-method or M-estimation. The default is the delta-method (for standardized survival). The frame() options saves the predictions to a new frame. The standardized estmates will be named S0 and S1. The contrast() option asks for a comparison of the two survival curves with the difference argument asking to take differences in the standardized survival curves. By default at1() is the reference, i.e. the contrast will be at2()-at1(), but this can be changed using the atref() option. The contrast will be stored in the new variable Sdiff.\nYou do not have to specify the names of the new variables and if you do not, standsurv will create new variables, _at1, _at2, _contrast2_1. However, in general it is more useful to create sensible names for these varables. As the ci option was specified there will be lower and upper for the confidence intervals (95% by deafult) for each estimate.\nBelow I list the standardized curves at 10 years, followed by their difference.\n. frame f2 {\n.   list S0* S1* if tt==10, noobs\n\n  +---------------------------------------------------------------------+\n  |        S0      S0_lci      S0_uci          S1      S1_lci    S1_uci |\n  |---------------------------------------------------------------------|\n  | .54380594   .52512603   .56315034   .60749077   .56414068   .654172 |\n  +---------------------------------------------------------------------+\n.   list Sdiff*  if tt==10, noobs \n\n  +-----------------------------------+\n  |     Sdiff   Sdiff_lci   Sdiff_uci |\n  |-----------------------------------|\n  | .06368483   .01748572   .10988394 |\n  +-----------------------------------+\n. }  \nThus the average survival at 10 years when everyone is forced to be unexposed (not on hormonal treatment) is 0.54 and when everyone is exposed it is 0.61. The difference is 0.064. We have actually evaluated each function at 101 time points and so we can plot the estimates together with 95% confidence intervals.\n. frame f2 {\n.   twoway (rarea S0_lci S0_uci tt, color(red%25))                          ///\n&gt;          (rarea S1_lci S1_uci tt, color(blue%25))                         ///\n&gt;          (line S0 tt, sort lcolor(red))                                   ///\n&gt;          (line S1  tt, sort lcolor(blue))                                 ///\n&gt;          , legend(order(1 \"No hormonal treatment\" 2 \"Hormonal treatment\") ///\n&gt;                   ring(0) cols(1) pos(1))                                 ///\n&gt;          ylabel(0.5(0.1)1,angle(h) format(%3.1f))                         ///\n&gt;          ytitle(\"S(t)\") ///\n&gt;          xtitle(\"Years from surgery\")\n. }\n\nAnd now we can plot the difference in standardized curves together with a 95% confidence interval.\n. frame f2 {\n. twoway (rarea Sdiff_lci Sdiff_uci tt, color(red%25)) ///\n&gt;        (line Sdiff tt, sort lcolor(red))             ///\n&gt;        , legend(off)                                 ///\n&gt;        ylabel(,angle(h) format(%3.2f))               ///\n&gt;        ytitle(\"Difference in S(t)\")                  ///\n&gt;        xtitle(\"Years from surgery\")\n. }\n\nThe covariate distribution we are averaging over is a combination of those on and not on hormon treatment. It may also be of interest to restrict to the covariate distribution of the exposed or the unexposed. Assuming our model has controlled for confounding this will give the average causal effect (difference) in the exposed. All we need to do is to add an if statement.\n. standsurv S0 S1 if hormon==1,  surv timevar(tt) ci                     ///\n&gt;                                frame(f3, replace)                      ///\n&gt;                                at1(hormon 0) at2(hormon 1)             ///\n&gt;                                contrast(difference) contrastvar(Sdiff)\nThe resulting standardized curves can then be plotted.\n. frame f3 {\n.   twoway (rarea S0_lci S0_uci tt, color(red%25))                          ///\n&gt;          (rarea S1_lci S1_uci tt, color(blue%25))                         ///\n&gt;          (line S0 tt, sort lcolor(red))                                   ///\n&gt;          (line S1  tt, sort lcolor(blue))                                 ///\n&gt;          , legend(order(1 \"No hormonal treatment\" 2 \"Hormonal treatment\") ///\n&gt;                   ring(0) cols(1) pos(1))                                 ///\n&gt;          ylabel(0.5(0.1)1,angle(h) format(%3.1f))                         ///\n&gt;          ytitle(\"S(t)\")                                                   ///\n&gt;          xtitle(\"Years from surgery\")\n.   }       \n\nNote that these curves give higher survival. This is because on average those who received hormonal treatment were younger and had less severe disease.\nWe can also plot the difference in these standardized curves together with a 95% confidence interval.\n. frame f3 {\n.   twoway (rarea Sdiff_lci Sdiff_uci tt, color(red%25)) ///\n&gt;          (line Sdiff tt, sort lcolor(red))           ///\n&gt;          , legend(off)                                 ///\n&gt;          ylabel(,angle(h) format(%3.2f))               ///\n&gt;          ytitle(\"Difference in S(t)\")                  ///\n&gt;          xtitle(\"Years from surgery\")\n. }"
  },
  {
    "objectID": "software/standsurv/standardized_survival.html#references",
    "href": "software/standsurv/standardized_survival.html#references",
    "title": "Standardized survival functions using standsurv",
    "section": "References",
    "text": "References\nAalen O.O., Cook R.J. Røysland K. Does Cox analysis of a randomized survival study yield a causal treatment effect? Lifetime data analysis 2015;21:579-593.\nHernán M.A. The hazards of hazard ratios. Epidemiology 2010;21:13-15\nSjölander A. Regression standardization with the R package stdReg. European Journal of Epidemiology 2016;31:563–574"
  },
  {
    "objectID": "software/standsurv/standardized_survival_centiles.html",
    "href": "software/standsurv/standardized_survival_centiles.html",
    "title": "Centiles of Standardized Survival Functions",
    "section": "",
    "text": "In a previous tutorial I used standsurv to obtain standardized survival functions. In this tutorial I show the first of a number of different measures of the standardized survival function where I obtain centiles of the standardized survival function.\nAs a reminder a centile of a survival function can be obtained by solving \\(S(t) = \\alpha\\) for \\(t\\). For example, for the median survival time we set \\(\\alpha = 0.5\\), i.e. the 50th (per)centile. For simple parametric distributions, such as the Weibull, we can solve for \\(t\\) analytically, but for more complex models the centile is obtained through iterative root finding techniques. In stpm2 I have used Brent’s root finder when evaluating centiles.\nThe centile of a standardized survival function is obtained by solving the following equation for t.\n\\[\nE\\left(S(t | X=x,Z\\right) = \\alpha\n\\]\nThis is done through root finding (using Brent’s root finder) by solving,\n\\[\n\\frac{1}{N}\\sum_{i=1}^N {S(t | X=x,Z)} - \\alpha = 0\n\\]\nVariances can be obtained using M-estimation ."
  },
  {
    "objectID": "software/standsurv/standardized_survival_centiles.html#background",
    "href": "software/standsurv/standardized_survival_centiles.html#background",
    "title": "Centiles of Standardized Survival Functions",
    "section": "",
    "text": "In a previous tutorial I used standsurv to obtain standardized survival functions. In this tutorial I show the first of a number of different measures of the standardized survival function where I obtain centiles of the standardized survival function.\nAs a reminder a centile of a survival function can be obtained by solving \\(S(t) = \\alpha\\) for \\(t\\). For example, for the median survival time we set \\(\\alpha = 0.5\\), i.e. the 50th (per)centile. For simple parametric distributions, such as the Weibull, we can solve for \\(t\\) analytically, but for more complex models the centile is obtained through iterative root finding techniques. In stpm2 I have used Brent’s root finder when evaluating centiles.\nThe centile of a standardized survival function is obtained by solving the following equation for t.\n\\[\nE\\left(S(t | X=x,Z\\right) = \\alpha\n\\]\nThis is done through root finding (using Brent’s root finder) by solving,\n\\[\n\\frac{1}{N}\\sum_{i=1}^N {S(t | X=x,Z)} - \\alpha = 0\n\\]\nVariances can be obtained using M-estimation ."
  },
  {
    "objectID": "software/standsurv/standardized_survival_centiles.html#example",
    "href": "software/standsurv/standardized_survival_centiles.html#example",
    "title": "Centiles of Standardized Survival Functions",
    "section": "Example",
    "text": "Example\nI use a colon cancer example. I first load and stset the data\n. use https://www.pclambert.net/data/colon if stage!=0, clear\n(Colon carcinoma, diagnosed 1975-94, follow-up to 1995)\n\n. stset surv_mm, f(status=1,2) scale(12) exit(time 120)\n\nSurvival-time data settings\n\n         Failure event: status==1 2\nObserved time interval: (0, surv_mm]\n     Exit on or before: time 120\n     Time for analysis: time/12\n\n--------------------------------------------------------------------------\n     13,208  total observations\n          0  exclusions\n--------------------------------------------------------------------------\n     13,208  observations remaining, representing\n      8,866  failures in single-record/single-failure data\n 43,950.667  total analysis time at risk and under observation\n                                                At risk from t =         0\n                                     Earliest observed entry t =         0\n                                          Last observed exit t =        10\nI drop those with missing stage information (stage == 0). I am investigating all cause survival (status=1,2).\nI fit a model that includes stage, sex and age (using a natural spline). I assume proportional hazards, but if I relax this assusmption the syntax for standsurv would be identical. Stage is classified as localised, regional and distant and is modelled as a factor variable with localised as the reference category.\n. gen female = sex==2\n\n. stpm3 i.stage i.female @ns(age,df(3)), scale(lncumhazard) df(4) nolog eform\n\n                                                       Number of obs =  13,208\n                                                       Wald chi2(6)  = 6155.27\nLog likelihood = -19665.932                            Prob &gt; chi2   =  0.0000\n\n------------------------------------------------------------------------------\n             |     exp(b)   Std. err.      z    P&gt;|z|     [95% conf. interval]\n-------------+----------------------------------------------------------------\nxb           |\n       stage |\n   Regional  |   1.758926   .0617187    16.09   0.000     1.642026    1.884149\n    Distant  |   5.656322   .1390555    70.48   0.000      5.39024    5.935539\n             |\n    1.female |   .8634681     .01891    -6.70   0.000     .8271894     .901338\n _ns_f1_age1 |   .0019791   .0012531    -9.83   0.000     .0005722    .0068455\n _ns_f1_age2 |   .7897475   .2383663    -0.78   0.434     .4370927    1.426931\n _ns_f1_age3 |   .1506021    .025846   -11.03   0.000     .1075845    .2108204\n-------------+----------------------------------------------------------------\ntime         |\n        _ns1 |  -14.64251   .1616785   -90.57   0.000    -14.95939   -14.32563\n        _ns2 |   3.188902   .0786506    40.55   0.000     3.034749    3.343054\n        _ns3 |   -1.66889   .0227393   -73.39   0.000    -1.713459   -1.624322\n        _ns4 |  -1.036622   .0267331   -38.78   0.000    -1.089018    -.984226\n       _cons |   1.441705   .0983651    14.66   0.000     1.248912    1.634497\n------------------------------------------------------------------------------\nNote: Estimates are transformed only in the first equation.\nExtended functions\n (1) @ns(age, df(3))\nThere is a clear effect of stage with a hazard ratio of 5.66 for distant stage versus localised stage. Remember that I am modelling all cause survival and one would expect a cause-specific hazard ratio to be higher. The all-cause mortality rate for females is 14% lower than males.\nI will now predict two standardized survival functions, one where I force all subjects to be male and one where I force everyone to be female.\n. range tt 0 10 100\n(13,108 missing values generated)\n\n. standsurv, surv timevar(tt) ci frame(surv, replace)  ///\n&gt;            at1(female 0) at2(female 1)               ///\n&gt;            atvar(ms_male ms_female)      \n\n. frame surv {           \n.   twoway (line ms_male ms_female tt, sort)           ///\n&gt;          , yline(0.5, lpattern(dash) lcolor(black))  ///\n&gt;          yline(0.5, lpattern(dash) lcolor(black))    ///\n&gt;          xtitle(\"Years since diagnosis\")             ///\n&gt;          ytitle(\"S(t)\", angle(h))                    ///\n&gt;          ylabel(0(0.2)1, format(%3.1f) angle(h))     ///\n&gt;          legend(order(1 \"Male\" 2 \"Female\") pos(1) )\n. }         \nThe graph of the two standardised survival functions can be seen below.\n\nAs expected (given the hazard ratio) females have better survival than males. I have added a horizontal reference line at \\(S(t)=0.5\\). Where this line crosses the survival curves gives the median survival time. Reading from the graph, this is just under 2 years for the males and just under 2.5 years for females. Using the centile option of standsurv will estimate these values more accurately with 95% confidence intervals. We are also interested in contrasts of the centiles, so use of the contrast option will calculate either a difference or ratio of the median survival times with a 95% confidence interval.\n. standsurv, centile(50) ci frame(median)              ///\n&gt;           at1(female 0) at2(female 1)                ///\n&gt;                       atvar(med_male med_female)                 ///\n&gt;           contrast(difference) contrastvar(med_diff)\n\n. frame median {\n.   list med_male* med_female*,  ab(15) noobs     \n\n  +----------------------------------------------------------------------------------------+\n  |  med_male   med_male_lci   med_male_uci   med_female   med_female_lci   med_female_uci |\n  |----------------------------------------------------------------------------------------|\n  | 1.9801987      1.8875488      2.0773963    2.4249751        2.3197847        2.5349353 |\n  +----------------------------------------------------------------------------------------+\n.   list med_diff* in 1, ab(18) noobs\n\n  +-----------------------------------------+\n  |  med_diff   med_diff_lci   med_diff_uci |\n  |-----------------------------------------|\n  | .44477636      .31389716      .57565556 |\n  +-----------------------------------------+\n. }\nThe median survival time is 1.98 years for males with a 95% CI (1.87 to 2.09). The median for females is 2.42 years (95% CI, 2.30 to 2.56). As I used the contrast option I also get the difference in the median of the standardised survival curves with a 95% CI. Thus the time at which 50% of females have died is 0.44 years more than the time at which 50% of males have died, 95% CI (0.30 to 0.59).\nIt is possible to predict for multiple centiles by passing a numlist to the centiles option. For example, the code below calculates centiles between 10 and 60 at 10 unit intervals.\n. standsurv, centile(10(10)60) ci frame(cenrange) centvar(centiles)   ///\n&gt;            at1(female 0) at2(female 1)                              ///\n&gt;                        atvar(cen_males cen_females)                             ///\n&gt;            contrast(difference) contrastvar(cendiff) \n\n. frame cenrange {\n.   list centiles cen_males cen_females cendiff, sep(0) noobs ab(12)\n\n  +------------------------------------------------+\n  | centiles   cen_males   cen_females     cendiff |\n  |------------------------------------------------|\n  |       10   .14919254     .16940399   .02021145 |\n  |       20   .32365079     .38459929    .0609485 |\n  |       30   .63821705     .78393263   .14571558 |\n  |       40   1.1648032     1.4192444   .25444124 |\n  |       50   1.9801987     2.4249751   .44477636 |\n  |       60   3.4239223      4.277573   .85365069 |\n  +------------------------------------------------+\n. }\nWe can then plot the difference in these various centiles.\n. frame cenrange {\n.   twoway (rarea cendiff_lci cendiff_uci centile, sort color(%30))  ///\n&gt;          (line cendiff centile, pstyle(p1line))                    ///\n&gt;              , xtitle(centile) xlabel(,format(%3.0f))                  ///\n&gt;              ytitle(\"Difference in centile\")                           ///\n&gt;          ylabel(0(0.2)1.2,format(%3.1f) angle(h))                  ///\n&gt;              legend(off)\n. }\n\nThere are probably more innovative ways of presenting such data."
  },
  {
    "objectID": "software/standsurv/standardized_survival_centiles.html#acknowledgement",
    "href": "software/standsurv/standardized_survival_centiles.html#acknowledgement",
    "title": "Centiles of Standardized Survival Functions",
    "section": "Acknowledgement",
    "text": "Acknowledgement\nI would like to acknowledge David Druker of StataCorp who I discussed these ideas with at two Nordic Stata User group meetings. David wrote a command that estimates centiles of standardized distributions using a two parameter gamma distribution which is available here."
  },
  {
    "objectID": "software/standsurv/standardized_survival_centiles.html#references",
    "href": "software/standsurv/standardized_survival_centiles.html#references",
    "title": "Centiles of Standardized Survival Functions",
    "section": "References",
    "text": "References\nStefanski, L. & Boos, D. The Calculus of M-Estimation. The American Statistician 2002;56:29-38"
  }
]